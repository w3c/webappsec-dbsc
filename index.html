<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>Device Bound Session Credentials</title>
  <meta content="ED" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-ED" rel="stylesheet">
  <meta content="Bikeshed version 3c53a5b02, updated Thu Nov 27 17:03:30 2025 +0000" name="generator">
  <link href="https://w3c.github.io/webappsec-dbsc/" rel="canonical">
  <meta content="335e90357ef2dba97f5a37075bf8a90c6cbe42dd" name="revision">
  <meta content="dark light" name="color-scheme">
  <link href="https://www.w3.org/StyleSheets/TR/2021/dark.css" media="(prefers-color-scheme: dark)" rel="stylesheet" type="text/css">
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example " counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
    --dfnpanel-target-bg: #ffc;
    --dfnpanel-target-outline: orange;
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
        --dfnpanel-target-bg: #333;
        --dfnpanel-target-outline: silver;
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel a:focus {
    outline: 5px auto Highlight;
    outline: 5px auto -webkit-focus-ring-color;
}
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: 8px;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
    transition: left 1s ease-out, bottom 1s ease-out;
}

.dfn-panel .link-item:hover {
    text-decoration: underline;
}
.dfn-panel .link-item .copy-icon {
    opacity: 0;
}
.dfn-panel .link-item:hover .copy-icon,
.dfn-panel .link-item .copy-icon:focus {
    opacity: 1;
}

.dfn-panel .copy-icon {
    display: inline-block;
    margin-right: 0.5em;
    width: 0.85em;
    height: 1em;
    border-radius: 3px;
    background-color: #ccc;
    cursor: pointer;
}

.dfn-panel .copy-icon .icon {
    width: 100%;
    height: 100%;
    background-color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.dfn-panel .copy-icon .icon::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 1px solid black;
    background-color: #ccc;
    opacity: 0.25;
    transform: translate(3px, -3px);
}

.dfn-panel .copy-icon:active .icon::before {
    opacity: 1;
}

.dfn-paneled[role="button"] { cursor: help; }

.highlighted {
    animation: target-fade 3s;
}

@keyframes target-fade {
    from {
        background-color: var(--dfnpanel-target-bg);
        outline: 5px solid var(--dfnpanel-target-outline);
    }
    to {
        color: var(--a-normal-text);
        background-color: transparent;
        outline: transparent;
    }
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-ref-hints */
:root {
    --ref-hint-bg: #ddd;
    --ref-hint-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --ref-hint-bg: #222;
        --ref-hint-text: var(--text);
    }
}

.ref-hint {
    display: inline-block;
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.5em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--ref-hint-bg);
    color: var(--ref-hint-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}

.ref-hint * { margin: 0; padding: 0; text-indent: 0; }

.ref-hint ul { padding: 0 0 0 1em; list-style: none; }
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-syntax-highlighting */
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */

@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
<style>/* Boilerplate: style-var-click-highlighting */
/*
Colors were chosen in Lab using https://nixsensor.com/free-color-converter/
D50 2deg illuminant, L in [0,100], a and b in [-128, 128]
0 = lab(85,0,85)
1 = lab(85,80,30)
2 = lab(85,-40,40)
3 = lab(85,-50,0)
4 = lab(85,5,15)
5 = lab(85,-10,-50)
6 = lab(85,35,-15)

For darkmode:
0 = oklab(50%   0%  108%)
1 = oklab(50% -51%   51%)
2 = oklab(50% -64%  -20%)
3 = oklab(50%   6%   19%)
4 = oklab(50% -12%  -64%)
5 = oklab(50%  44%  -19%)  
6 = oklab(50% 102%   38%)
*/

[data-algorithm] var { cursor: pointer; }
var[data-var-color] { background-color: var(--var-bg); box-shadow: 0 0 0 2px var(--var-bg); }

var[data-var-color] { --var-bg: #F4D200; }
var[data-var-color="1"] { --var-bg: #FF87A2; }
var[data-var-color="2"] { --var-bg: #96E885; }
var[data-var-color="3"] { --var-bg: #3EEED2; }
var[data-var-color="4"] { --var-bg: #EACFB6; }
var[data-var-color="5"] { --var-bg: #82DDFF; }
var[data-var-color="6"] { --var-vg: #FFBCF2; }

@media (prefers-color-scheme: dark) {
	var[data-var-color] { --var-bg: #bc1a00; }
	var[data-var-color="1"] { --var-bg: #007f00; }
	var[data-var-color="2"] { --var-bg: #008698; }
	var[data-var-color="3"] { --var-bg: #7f5b2b; }
	var[data-var-color="4"] { --var-bg: #004df3; }
	var[data-var-color="5"] { --var-bg: #a1248a; }
	var[data-var-color="6"] { --var-vg: #ff0000; }
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/">
    <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72">
</a>
</p>
   <h1 class="no-ref p-name" id="title">Device Bound Session Credentials</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types/#ED">Editor’s Draft</a>,
    <time class="dt-updated" datetime="2026-02-13">13 February 2026</time></p>
   <details open>
    <summary>More details about this document</summary>
    <div data-fill-with="spec-metadata">
     <dl>
      <dt>This version:
      <dd><a class="u-url" href="https://w3c.github.io/webappsec-dbsc/">https://w3c.github.io/webappsec-dbsc/</a>
      <dt>Issue Tracking:
      <dd><a href="https://github.com/w3c/webappsec-dbsc/issues/">GitHub</a>
      <dt class="editor">Editors:
      <dd class="editor h-card p-author vcard" data-editor-id="162789"><a class="email fn p-name u-email" href="mailto:drubery@google.com">Daniel Rubery</a> (<span class="org p-org">Google</span>)
      <dd class="editor h-card p-author vcard" data-editor-id="164860"><a class="email fn p-name u-email" href="mailto:thefrog@chromium.org">thefrog@chromium.org</a> (<span class="org p-org">Google</span>)
      <dt class="editor">Former Editor:
      <dd class="editor h-card p-author vcard" data-editor-id="76841"><span class="fn p-name">Kristian Monsen</span> (<span class="org p-org">Apple</span>)
     </dl>
    </div>
   </details>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/policies/#copyright">Copyright</a> © 2026 <a href="https://www.w3.org/">World Wide Web Consortium</a>. <abbr title="World Wide Web Consortium">W3C</abbr><sup>®</sup> <a href="https://www.w3.org/policies/#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/policies/#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/copyright/software-license/" rel="license" title="W3C Software and Document License">permissive document license</a> rules apply.
</p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="heading no-num no-ref no-toc settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>Device Bound Sessions Credentials (DBSC) aims to prevent hijacking via cookie theft by building a protocol and infrastructure that allows a user agent to assert possession of a securely-stored private key. DBSC is a Web API and a protocol between user agents and servers to achieve this binding.</p>
  </div>
  <h2 class="heading no-num no-ref no-toc settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p>
	This is a public copy of the editors’ draft.
	It is provided for discussion only and may change at any moment.
	Its publication here does not imply endorsement of its contents by W3C.
	Don’t cite this document other than as work in progress.

</p>
   <p>
  <strong>Changes to this document may be tracked at
  <a href="https://github.com/w3c/webappsec">https://github.com/w3c/webappsec</a>.</strong>

</p>
   <p>
	The (<a href="https://lists.w3.org/Archives/Public/public-webappsec/">archived</a>) public mailing list
	<a href="mailto:public-webappsec@w3.org?Subject=%5Bdbsc%5D%20PUT%20SUBJECT%20HERE">public-webappsec@w3.org</a>
	(see <a href="https://www.w3.org/Mail/Request">instructions</a>)
	is preferred for discussion of this specification.
	When sending e-mail,
	please put the text “dbsc” in the subject,
	preferably like this:
	“[dbsc] <em>…summary of comment…</em>”

</p>
   <p>
	This document was produced by the
  <a href="https://www.w3.org/groups/wg/webappsec">Web Application Security Working Group</a>.

</p>
   <p>
	This document was produced by a group operating under
	the <a href="https://www.w3.org/policies/patent-policy/">W3C Patent Policy</a>.
	W3C maintains a <a href="https://www.w3.org/groups/wg/webappsec/ipr" rel="disclosure">public list of any patent disclosures</a>
	made in connection with the deliverables of the group;
	that page also includes instructions for disclosing a patent.
	An individual who has actual knowledge of a patent that the individual believes contains <a href="https://www.w3.org/policies/patent-policy/#def-essential">Essential Claim(s)</a>
	must disclose the information in accordance with <a href="https://www.w3.org/policies/patent-policy/#sec-Disclosure">section 6 of the W3C Patent Policy</a>.

</p>
   <p>
  This document is governed by the <a href="https://www.w3.org/policies/process/20250818/" id="w3c_process_revision">18 August 2025 W3C Process Document</a>.

</p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-ref no-toc" id="contents">Table of Contents</h2>
   <ol class="toc">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li>
     <a href="#security-considerations"><span class="secno">2</span> <span class="content">Security Considerations</span></a>
     <ol class="toc">
      <li><a href="#non-goals"><span class="secno">2.1</span> <span class="content">Non-goals</span></a>
     </ol>
    <li>
     <a href="#privacy-considerations"><span class="secno">3</span> <span class="content">Privacy Considerations</span></a>
     <ol class="toc">
      <li><a href="#privacy-cookies"><span class="secno">3.1</span> <span class="content">Cookie considerations</span></a>
      <li><a href="#privacy-side-channel-leak"><span class="secno">3.2</span> <span class="content">Timing side channel leak</span></a>
      <li><a href="#federated-sessions"><span class="secno">3.3</span> <span class="content">Federated sessions</span></a>
     </ol>
    <li>
     <a href="#alternatives"><span class="secno">4</span> <span class="content">Alternatives considered</span></a>
     <ol class="toc">
      <li><a href="#alternatives-webauthn"><span class="secno">4.1</span> <span class="content">WebAuthn and silent mediation</span></a>
     </ol>
    <li><a href="#server-considerations"><span class="secno">5</span> <span class="content">Server considerations</span></a>
    <li><a href="#user-agent-considerations"><span class="secno">6</span> <span class="content">User agent considerations</span></a>
    <li>
     <a href="#framework"><span class="secno">7</span> <span class="content">Framework</span></a>
     <ol class="toc">
      <li><a href="#framework-session-store"><span class="secno">7.1</span> <span class="content">Session store</span></a>
      <li><a href="#framework-sessions-id"><span class="secno">7.2</span> <span class="content">Sessions by id</span></a>
      <li><a href="#framework-session"><span class="secno">7.3</span> <span class="content">Device bound session</span></a>
      <li><a href="#framework-scope"><span class="secno">7.4</span> <span class="content">Session scope</span></a>
      <li><a href="#framework-scope-specification"><span class="secno">7.5</span> <span class="content">Scope specification</span></a>
      <li><a href="#framework-session-credential"><span class="secno">7.6</span> <span class="content">Session credential</span></a>
      <li><a href="#framework-registrable-origin-label"><span class="secno">7.7</span> <span class="content">Registrable origin label</span></a>
     </ol>
    <li>
     <a href="#algorithms"><span class="secno">8</span> <span class="content">Algorithms</span></a>
     <ol class="toc">
      <li><a href="#algo-identify-session"><span class="secno">8.1</span> <span class="content">Identify session</span></a>
      <li><a href="#algo-url-in-scope"><span class="secno">8.2</span> <span class="content">Identify if a URL is in scope of a session</span></a>
      <li><a href="#algo-request-allows-refresh"><span class="secno">8.3</span> <span class="content">Identify if a request is allowed to refresh</span></a>
      <li><a href="#algo-domain-pattern-matches"><span class="secno">8.4</span> <span class="content">Identify if a host matches a pattern</span></a>
      <li><a href="#algo-identify-session-needing-refresh"><span class="secno">8.5</span> <span class="content">Identify session needing refresh</span></a>
      <li><a href="#algo-identify-if-missing-session-credential"><span class="secno">8.6</span> <span class="content">Identify if missing session credential</span></a>
      <li><a href="#algo-process-challenge"><span class="secno">8.7</span> <span class="content">Cache challenge</span></a>
      <li><a href="#algo-session-request"><span class="secno">8.8</span> <span class="content">Send request</span></a>
      <li><a href="#algo-create-session"><span class="secno">8.9</span> <span class="content">Create session</span></a>
      <li><a href="#algo-process-session-registration"><span class="secno">8.10</span> <span class="content">Process session registration</span></a>
      <li><a href="#algo-create-session-key-pair"><span class="secno">8.11</span> <span class="content">Create session key pair</span></a>
      <li><a href="#algo-add-debug-header"><span class="secno">8.12</span> <span class="content">Add debug header</span></a>
     </ol>
    <li>
     <a href="#format"><span class="secno">9</span> <span class="content">DBSC Formats</span></a>
     <ol class="toc">
      <li><a href="#header-secure-session-registration"><span class="secno">9.1</span> <span class="content">`<code><span>Secure-Session-Registration</span></code>` HTTP header field</span></a>
      <li>
       <a href="#header-secure-session-challenge"><span class="secno">9.2</span> <span class="content">`<code><span>Secure-Session-Challenge</span></code>` HTTP header field</span></a>
       <ol class="toc">
        <li><a href="#challenge-structured-header-serialization"><span class="secno">9.2.1</span> <span class="content">`<code><span>Secure-Session-Challenge</span></code>` structured header serialization</span></a>
       </ol>
      <li><a href="#header-secure-session-response"><span class="secno">9.3</span> <span class="content">`<code><span>Secure-Session-Response</span></code>` HTTP header field</span></a>
      <li><a href="#header-sec-secure-session-id"><span class="secno">9.4</span> <span class="content">`<code><span>Sec-Secure-Session-Id</span></code>` HTTP header field</span></a>
      <li><a href="#header-secure-session-skipped"><span class="secno">9.5</span> <span class="content">`<code><span>Secure-Session-Skipped</span></code>` HTTP header field</span></a>
      <li><a href="#format-session-instructions"><span class="secno">9.6</span> <span class="content">JSON Session Instruction Format</span></a>
      <li><a href="#format-session-scope-instructions"><span class="secno">9.7</span> <span class="content">JSON Session Scope Instruction Format</span></a>
      <li><a href="#format-session-scope-rule"><span class="secno">9.8</span> <span class="content">JSON Session Scope Rule Format</span></a>
      <li><a href="#format-session-credentials"><span class="secno">9.9</span> <span class="content">JSON Session Credentials Format</span></a>
      <li><a href="#format-jwt"><span class="secno">9.10</span> <span class="content">DBSC Proof JWT Syntax</span></a>
     </ol>
    <li>
     <a href="#changes-to-other-specifications"><span class="secno">10</span> <span class="content">Changes to other specifications</span></a>
     <ol class="toc">
      <li><a href="#changes-to-fetch"><span class="secno">10.1</span> <span class="content">Changes to the Fetch specification</span></a>
      <li><a href="#changes-to-clear-site-data"><span class="secno">10.2</span> <span class="content">Changes to the Clear Site Data specification</span></a>
     </ol>
    <li>
     <a href="#iana-considerations"><span class="secno">11</span> <span class="content">IANA Considerations</span></a>
     <ol class="toc">
      <li><a href="#iana-ses-session-challenge"><span class="secno">11.1</span> <span class="content">Secure-Session-Challenge</span></a>
      <li><a href="#iana-sec-secure-session-id"><span class="secno">11.2</span> <span class="content">Sec-Secure-Session-Id</span></a>
      <li><a href="#iana-secure-session-registration"><span class="secno">11.3</span> <span class="content">Secure-Session-Registration</span></a>
      <li><a href="#iana-secure-session-response"><span class="secno">11.4</span> <span class="content">Secure-Session-Response</span></a>
      <li><a href="#iana-secure-session-skipped"><span class="secno">11.5</span> <span class="content">Secure-Session-Skipped</span></a>
      <li><a href="#well-known"><span class="secno">11.6</span> <span class="content">device-bound-sessions Well Known</span></a>
     </ol>
    <li><a href="#changelog"><span class="secno">12</span> <span class="content">Changelog</span></a>
    <li><a href="#acknowledgements"><span class="secno">13</span> <span class="content">Acknowledgements</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
     </ol>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p><em>This section is not normative.</em><br>
<em>Note this is a very early drafting for writing collaboration only</em></p>
   <p>The web is built on a stateless protocol. To maintain state for certain
functionality, web applications store data locally on a user’s device. This
storage can last for a long time, and is used for security sensitive data such
as for credentials for logged-in user sessions.</p>
   <p>In general, user agents do not have a way of storing this kind of data on common
operating systems that is secure against software that has equal privilege to
the user agent itself. At the same time, actions authenticated by this data may
have serious consequences, such as transferring money from a bank account. A
common scalable threat to this model is malware that exfiltrates such
credentials and carries out abuse elsewhere, thus evading detection.</p>
   <p>This document defines a new API, Device Bound Sessions Credentials (DBSC), that
enables a server to verify that a session credential has not been exported from
a device. These credentials are private keys, so user agents can use facilities
such as TPMs, or similar APIs, to protect them from exfiltration even by equally
privileged malware.</p>
   <p>The goal is to provide users with a safe and secure experience, while offering
the use cases users are already used to. At the same time, we want to ensure
that user privacy is respected, with no new privacy identifiers being leaked by
this protocol. The API takes special care to integrate easily with existing
server-side auth stacks, providing an incremental path to such protections that
does not require rewriting large parts of the web software stack.</p>
   <h2 class="heading settled" data-level="2" id="security-considerations"><span class="secno">2. </span><span class="content">Security Considerations</span><a class="self-link" href="#security-considerations"></a></h2>
   
The goals of DBSC are to reduce session theft by offering an alternative to
long-lived cookie bearer tokens and to allow session authentication to be
based on private keys that can be better protected against exfiltration.
This makes the internet safer for users in that it is less likely their
identity is abused, as malware is forced to act locally and thus becomes
easier to detect and mitigate.


   <p>User agent implementations are responsible for selecting the best way to protect
such private keys from exfiltration, taking into account types of malware threats
that exist on different platforms, and the protection mechanisms that exist. That 
includes, but is not limited to, secure hardware such as TPMs or secure elements,
OS provided APIs for secure key generation and management, or process isolation
mechanisms that provide reasonable protection against locally running malware.</p>
   <p>As long as the session is valid and was registered to an uncompromised device, a
host can thus know with cryptographic certainty that the session key is protected
against malicious exfiltration to a different device.</p>
   <h3 class="heading settled" data-level="2.1" id="non-goals"><span class="secno">2.1. </span><span class="content">Non-goals</span><a class="self-link" href="#non-goals"></a></h3>
   
DBSC will not prevent temporary access to the browser session while the attacker
is resident on the user’s device. The private key should be stored as safely as
modern operating systems allow, preventing exfiltration of the session private
key, but the signing capability will likely still be available for any program
running as the user on the user’s device.


   <p>DBSC will also not prevent an attack if the attacker is replacing or injecting
into the user agent at the time of session registration, as the attacker can bind
the session either to keys that are not TPM bound, or to a TPM that the attacker
controls permanently.</p>
   <p>DBSC is not designed to give hosts any sort of guarantee about the
specific device a session is registered to, or the state of this device.</p>
   <h2 class="heading settled" data-level="3" id="privacy-considerations"><span class="secno">3. </span><span class="content">Privacy Considerations</span><a class="self-link" href="#privacy-considerations"></a></h2>
   
The privacy goal of the DBSC protocol is to introduce no additional surface for user
tracking: implementing this API (for a browser) or enabling it (for a website)
should not entail any significant user privacy tradeoffs.


   <p>Some of the considerations taken to ensure this:</p>
   <ul>
    <li data-md>
     <p>Lifetime of a session/key material: This should provide no additional client
data storage (i.e., a pseudo-cookie). As such, we require that browsers MUST
clear sessions and keys when clearing other site data (like cookies).</p>
    <li data-md>
     <p>Implementing this API should not meaningfully increase the entropy of
heuristic device fingerprinting signals. In particular, DBSC
should not leak any stable device identifiers.</p>
    <li data-md>
     <p>As this API MAY allow background "pings" for performance, this must not enable
long-term tracking of a user when they have navigated away from the connected
site.</p>
    <li data-md>
     <p>Each session has a separate new key created, and it should not be possible to
detect that different sessions are from the same device.</p>
   </ul>
   <h3 class="heading settled" data-level="3.1" id="privacy-cookies"><span class="secno">3.1. </span><span class="content">Cookie considerations</span><a class="self-link" href="#privacy-cookies"></a></h3>
   
It should be impossible for a site to use this API to circumvent the same origin
policy, 3P cookie policies, etc. Due to the complexity of current and changing
cookie behavior and the tight integration between DBSC and cookies, the current
solution is that each user agent should use the same policy for DBSC as it uses
for cookies. If the DBSC cookie credential would not apply to a network request
based on user settings, applied policies, or user agent implementation details,
neither would any of the additional DBSC behavior. This ensures no new privacy
behavior due to implementing DBSC.


   <h3 class="heading settled" data-level="3.2" id="privacy-side-channel-leak"><span class="secno">3.2. </span><span class="content">Timing side channel leak</span><a class="self-link" href="#privacy-side-channel-leak"></a></h3>
   
If third party cookies are enabled, it is possible for an attacker to determine
whether or not a user is authenticated by measuring how long the request takes.
This is because the refresh may be quite slow, in particular if it depends on slow
underlying facilities for key protection (e.g. TPMs).


   <p>This is mitigated by the <code>allowed_refresh_initiators</code> key in session
configuration, which can be used to strictly limit the sites that can trigger
DBSC refreshes. This cannot be replaced by existing solutions
(e.g. X-Frame-Options) because the existing solutions only apply after the
request has completed, and DBSC must choose whether to refresh before the
request has started.</p>
   <h3 class="heading settled" data-level="3.3" id="federated-sessions"><span class="secno">3.3. </span><span class="content">Federated sessions</span><a class="self-link" href="#federated-sessions"></a></h3>
   <p>Many sites use a federated login mechanism with no browser involvement,
frequently depending on link decoration (e.g. OIDC). In order to achieve DBSC’s
goal of easy adoptability, we want these sites to be able to protect themselves
from cookie theft without a full rewrite of their authentication flows. Ideally,
Relying Parties (RPs) could simply establish a DBSC session independently of the
Identity Provider (IdP). Unfortunately, most IdPs do not require a password if
the user is already logged in. If user interaction isn’t required, malware can
use its temporary access to the user’s machine to mimic the login flow and
establish a DBSC session with a new private key the malware created and can
exfiltrate. This violates the security goals of DBSC.</p>
   <p>Since DBSC is not inherently tied to login or identity, Identity Provider is not
the most accurate term. Instead we use the term Session Provider (SP), although
in the target use case we expect the SP and IdP to be the same party.</p>
   <p>In order to protect the RP’s sessions, we need to link the RP and SP session in
some way. The simplest way to do this is for the SP and RP to use the same
session key pair. Since we assume the SP’s session was established before the
malware compromised the device, we trust that the private key is stored
securely. But sharing keys across sites has complex privacy properties. In order
to mitigate the privacy risks of sharing a high-entropy identifier, we require
that the RP already know the public key and session identifier for the SP’s
session. The RP will include the SP URL, session identifier, and base64url-encoded
JWK thumbprint (see <a data-link-type="biblio" href="#biblio-rfc4648" title="The Base16, Base32, and Base64 Data Encodings">[RFC4648]</a> and <a data-link-type="biblio" href="#biblio-rfc7638" title="JSON Web Key (JWK) Thumbprint">[RFC7638]</a>) in the
`<code><a data-link-type="http-header" href="#secure-session-registration-header" id="ref-for-secure-session-registration-header">Secure-Session-Registration</a></code>` header. If the key is correct, the user agent
will create a session on the RP with the same key as the SP.</p>
   <p>There is also a potential risk of malicious RPs and SPs collaborating to try to
identify users in cases where the RP and SP can’t already share information
(e.g. when there are protections against fingerprinting or link decoration). The
RPs could simply try to guess many public keys until they found a match, giving
them a unique identifier for the user. This would allow a collaborating RP and
SP to share a user’s identity across sites, outside of the intended mechanisms
for cross-site identity linking. To prevent this, user agents should include
significant backoff or quotas on registration attempts (this is also recommended
to avoid denial of service on the TPM). Note that the security properties of
DBSC rely on a cryptographic assumption that it is hard to get two users with
the same key pair, so querying whether a user has a specific DBSC public key on
the SP is much less than a one bit of entropy.</p>
   <p>In order to further limit the value of successfully unmasking a user, we also
require opt-in from the SP through a <code>.well-known</code>. Browsers should limit the
number of RP origins in that list. We also need to prevent an RP from using
multiple SPs and aggregating identities that way. To do that, we require RPs
declare their SP in the <code>.well-known</code> as well. Together, these will ensure that
large groups of sites cannot collaborate to unmask a single high-value user as
they browse the web.</p>
   <div class="example" id="federated-sessions-example">
    <a class="self-link" href="#federated-sessions-example"></a>
Suppose the owners of <code>example.com</code> also run <code>example.co.uk</code>. Login always
happens on <code>example.com</code> and is propagated to <code>example.co.uk</code> through link
decoration. In order to protect both sites with a DBSC session, <code>example.com</code>
should continue to use its existing `<code><a data-link-type="http-header" href="#secure-session-registration-header" id="ref-for-secure-session-registration-header①">Secure-Session-Registration</a></code>` header:


<pre>Secure-Session-Registration: (ES256);path="/register";challenge="challenge"
</pre>
    <p>When extending the DBSC session to <code>example.com.uk</code>, the site should append new
parameters to the `<code><a data-link-type="http-header" href="#secure-session-registration-header" id="ref-for-secure-session-registration-header②">Secure-Session-Registration</a></code>` header:</p>
<pre>Secure-Session-Registration: (ES256);path="/register";challenge="challenge";provider_key="abc";provider_session_id="example.com id";provider_url="https://example.com"
</pre>
    <p>Assuming <code>example.com</code> and <code>example.co.uk</code> have the appropriate .well-known
entries, this will cause <code>example.co.uk</code> to register a new DBSC session using
the same key as the session on <code>example.com</code>. This allows DBSC to protect
<code>example.co.uk</code> without requiring users to reauthenticate on <code>example.com</code> at
login.</p>
   </div>
   <h2 class="heading settled" data-level="4" id="alternatives"><span class="secno">4. </span><span class="content">Alternatives considered</span><a class="self-link" href="#alternatives"></a></h2>
   <h3 class="heading settled" data-level="4.1" id="alternatives-webauthn"><span class="secno">4.1. </span><span class="content">WebAuthn and silent mediation</span><a class="self-link" href="#alternatives-webauthn"></a></h3>
   <p>WebAuthn provides sites with certain key management capabilities, so it may be
possible to extend it to meet the same goals as DBSC. We do not take this
approach because WebAuthn’s focus on interactive user sign-in leads to several
properties for its API that are contrary to the goals of a feature like
DBSC. For example, WebAuthn credentials are not tied to specific sessions. They
are meant to be long-lived and are not cleared along with site data. This does
not line up well with the necessary privacy properties for session
keys. Similarly, WebAuthn credentials are designed for use with explicit user
intent. Extending WebAuthn to subsume the functionality that DBSC provides would
require WebAuthn to establish a different kind of key that can be used
silently. This introduces extra complexity for both WebAuthn and DBSC. Instead,
we take the position that WebAuthn aims to provide secure sign-in and DBSC is
complementary, protecting users after sign-in.</p>
   <h2 class="heading settled" data-level="5" id="server-considerations"><span class="secno">5. </span><span class="content">Server considerations</span><a class="self-link" href="#server-considerations"></a></h2>
   <p>In order to use DBSC, site owners need to establish two new endpoints:
the registration endpoint and the refresh endpoint.</p>
   <p>The registration endpoint is contacted asynchronously after the browser receives
the `<code><a data-link-type="http-header" href="#secure-session-registration-header" id="ref-for-secure-session-registration-header③">Secure-Session-Registration</a></code>` header. This endpoint should:</p>
   <ul>
    <li data-md>
     <p>Serve the session config, including a new session identifier.</p>
    <li data-md>
     <p>Persist and associate the request’s public key with the session identifier.</p>
   </ul>
   <p>The refresh endpoint is much more sensitive. This endpoint is contacted every
time a request is made with an expired bound cookie, and its response blocks
the original request. Failure to respond or restore the bound cookie may
cause browser agents to begin denial-of-service prevention mechanisms, or even
terminate the session. Both could lead to future requests without bound
cookies. The expected behavior of this endpoint is:</p>
   <ul>
    <li data-md>
     <p>Look up the public key and recent challenges for the session by identifier.</p>
    <li data-md>
     <p>Validate the `<code><a data-link-type="http-header" href="#secure-session-response-header" id="ref-for-secure-session-response-header">Secure-Session-Response</a></code>` header has signed a recent challenge with
the correct key. Note that due to network latency and race conditions, it’s
possible to receive a signature for an old challenge after issuing a new
challenge.</p>
    <li data-md>
     <p>Issue new bound cookies.</p>
    <li data-md>
     <p>Optionally update the current session config.</p>
   </ul>
   <p>Browsers may choose to refresh sessions proactively to attempt to minimize the
latency cost of sites adopting DBSC. Sites should not assume that a refresh will
only happen when a bound cookie is expired.</p>
   <p>The refresh endpoint is likely to directly leak login state via a timing side
channel if cross-site fetches are allowed. Servers can check for a valid
`<code><a data-link-type="http-header" href="#sec-secure-session-id-header" id="ref-for-sec-secure-session-id-header">Sec-Secure-Session-Id</a></code>` header to ensure that incoming requests are initiated
by the user agent and not a cross-site request. It’s also recommended to set a
narrow CORS policy on this endpoint and not allow cross-site origins to make
requests with credentials. The CORS integration for DBSC has been designed to
make this possible by implicitly including credentials when the deferred
request does. For similar reasons, it’s also recommended that the refresh
endpoint refuse to be embedded via the <code>X-Frame-Options</code> or
<code>Cross-Origin-Resource-Policy</code> headers.</p>
   <div class="example" id="timing-leak-cors">
    <a class="self-link" href="#timing-leak-cors"></a>
Suppose <code>example.com</code> has two endpoints:

    <ul>
     <li data-md>
      <p><code>/authenticated</code> will return <code>Access-Control-Allow-Credentials</code> for any
requesting origin.</p>
     <li data-md>
      <p><code>/refresh</code> is the DBSC refresh endpoint.</p>
    </ul>
    <p>The site wants DBSC to protect cross-site requests to <code>/authenticated</code> and
believes that the risks from timing side channels on this one endpoint are
minimal. If we did not implicitly allow credentials for the refresh request
triggered by the user agent, then <code>/refresh</code> would be required to return
<code>Access-Control-Allow-Credentials</code> for any requesting origin. Then attackers
could leak login state by fetching <code>/refresh</code> directly.</p>
    <p>Since DBSC’s call into <code>/refresh</code> implicitly allows credentials, the <code>/refresh</code>
endpoint can refuse to ever return <code>Access-Control-Allow-Credentials</code>. It will
still receive credentialled requests in the context of a DBSC refresh. Other
sites will be unable to directly fetch the endpoint with credentials,
preventing an easy cross-site leak of login state.</p>
    <p>Sites wishing to do a point-in-time challenge on a particular request can
accomplish this by triggering a redirect that also expires a bound cookie. This
results in a refresh followed by retrying the original request. For example,
returning an HTTP 307 to the same endpoint with a Set-Cookie header expiring the
cookie will force a DBSC refresh before the redirect completes.</p>
   </div>
   <p>Sites using federated login with DBSC (see <a href="#federated-sessions">§ 3.3 Federated sessions</a>) should
ensure that only sessions with the federated key are accepted. Security of
federated sessions relies on the machine being uncompromised at Session
Provider (SP) login, since malware can use temporary access to the machine to
register a session on the Relying Party (RP) with new keys. Therefore RPs should
only accept sessions registered with the appropriate public keys they received
from the SP.</p>
   <p>New challenges issued should have a short lifetime. The server should reject
signed responses that use a stale challenge.</p>
   <h2 class="heading settled" data-level="6" id="user-agent-considerations"><span class="secno">6. </span><span class="content">User agent considerations</span><a class="self-link" href="#user-agent-considerations"></a></h2>
   <p>DBSC provides a lot of flexibility for browsers to schedule cookie
refreshes. This can mitigate the latency of DBSC and lower the load on
TPMs and servers. We recommend that user agents schedule cookie
refreshes in the following way:</p>
   <ul>
    <li data-md>
     <p>If a session already has a pending DBSC refresh, do not start another
one. This reduces TPM load and allows for simpler server
implementations</p>
    <li data-md>
     <p>If a session credential will expire soon, and an in-scope document is
active, the user agent can refresh proactively to eliminate latency on
an upcoming request.</p>
   </ul>
   <h2 class="heading settled" data-level="7" id="framework"><span class="secno">7. </span><span class="content">Framework</span><a class="self-link" href="#framework"></a></h2>
   
This document uses ABNF grammar to specify syntax, as defined in <a data-link-type="biblio" href="#biblio-rfc5234" title="Augmented BNF for Syntax Specifications: ABNF">[RFC5234]</a>
and updated in <a data-link-type="biblio" href="#biblio-rfc7405" title="Case-Sensitive String Support in ABNF">[RFC7405]</a>, along with the <code>#rule</code> extension defined in
<a href="https://tools.ietf.org/html/rfc7230#section-7">Section 7</a> of
<a data-link-type="biblio" href="#biblio-rfc9112" title="HTTP/1.1">[RFC9112]</a>, and the <code>quoted-string</code> rule defined in
<a href="https://tools.ietf.org/html/rfc7230#section-3.2.6">Section 3.2.6</a>
of the same document.


   <p>This document depends on the Infra Standard for a number of foundational
concepts used in its algorithms and prose <a data-link-type="biblio" href="#biblio-infra" title="Infra Standard">[INFRA]</a>.</p>
   <h3 class="heading settled" data-level="7.1" id="framework-session-store"><span class="secno">7.1. </span><span class="content">Session store</span><a class="self-link" href="#framework-session-store"></a></h3>
   
The user agent maintains a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="session-store">session store</dfn>. It is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map">ordered map</a>
from <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain">registrable domain</a> to <a data-link-type="dfn" href="#sessions-by-id-map" id="ref-for-sessions-by-id-map">sessions by id map</a>. Sessions should persist
across user agent restarts.


   <h3 class="heading settled" data-level="7.2" id="framework-sessions-id"><span class="secno">7.2. </span><span class="content">Sessions by id</span><a class="self-link" href="#framework-sessions-id"></a></h3>
   
A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="sessions-by-id-map">sessions by id map</dfn> is an <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#ordered-map" id="ref-for-ordered-map①">ordered map</a> from
<a data-link-type="dfn" href="#device-bound-session-session-identifier" id="ref-for-device-bound-session-session-identifier">session identifier</a> to <a data-link-type="dfn" href="#device-bound-session" id="ref-for-device-bound-session">device bound session</a> for a
given <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain①">registrable domain</a>.


   <h3 class="heading settled" data-level="7.3" id="framework-session"><span class="secno">7.3. </span><span class="content">Device bound session</span><a class="self-link" href="#framework-session"></a></h3>
   
A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="device-bound-session">device bound session</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct">struct</a> with the following
<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct-item" id="ref-for-struct-item">items</a>:

   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="device bound session" data-dfn-type="dfn" data-noexport id="device-bound-session-session-identifier">session identifier</dfn>
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string">string</a> that is a unique identifier of a session on a
<a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain②">registrable domain</a></p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="device bound session" data-dfn-type="dfn" data-noexport id="device-bound-session-refresh-url">refresh URL</dfn>
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string①">string</a> that is representing the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url">URL</a> to be used to refresh the
session</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="device bound session" data-dfn-type="dfn" data-noexport id="device-bound-session-cached-challenge">cached challenge</dfn>
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string②">string</a> or null that is to be used as the next challenge for this session</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="device bound session" data-dfn-type="dfn" data-noexport id="device-bound-session-session-scope">session scope</dfn>
    <dd data-md>
     <p>a <a data-link-type="dfn" href="#session-scope" id="ref-for-session-scope">session scope</a> defining which <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url①">URLs</a> are in scope for this session</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="device bound session" data-dfn-type="dfn" data-noexport id="device-bound-session-session-credentials">session credentials</dfn>
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list">list</a> of <a data-link-type="dfn" href="#session-credential" id="ref-for-session-credential">session credentials</a> used by the session, derived from
<a data-link-type="dfn" href="#json-session-credential" id="ref-for-json-session-credential">JSON session credentials</a></p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="device bound session" data-dfn-type="dfn" data-noexport id="device-bound-session-expiration-timestamp">expiration timestamp</dfn>
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://w3c.github.io/hr-time/#dfn-moment" id="ref-for-dfn-moment">moment</a> when this session should be removed</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="device bound session" data-dfn-type="dfn" data-noexport id="device-bound-session-session-key-pair">session key pair</dfn>
    <dd data-md>
     <p>an optional key pair used by the session. The private key should be stored
in a secure manner (see <a href="#security-considerations">§ 2 Security Considerations</a>). This may be null if
the site requests signing algorithm "none".</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="device bound session" data-dfn-type="dfn" data-noexport id="device-bound-session-allowed-refresh-initiators">allowed refresh initiators</dfn>
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①">list</a> of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string③">strings</a> describing which hosts are allowed to initiate
DBSC refreshes. See <a href="#algo-request-allows-refresh">§ 8.3 Identify if a request is allowed to refresh</a> for details.</p>
   </dl>
   <h3 class="heading settled" data-level="7.4" id="framework-scope"><span class="secno">7.4. </span><span class="content">Session scope</span><a class="self-link" href="#framework-scope"></a></h3>
   
A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="session-scope">session scope</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct①">struct</a> with the following
<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct-item" id="ref-for-struct-item①">items</a>:

   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="session scope" data-dfn-type="dfn" data-noexport id="session-scope-origin">origin</dfn>
    <dd data-md>
     <p>the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin">origin</a> this session was registered for</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="session scope" data-dfn-type="dfn" data-noexport id="session-scope-include-site">include site</dfn>
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#boolean" id="ref-for-boolean">boolean</a> indicating if the session applies to an entire site or just an origin</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="session scope" data-dfn-type="dfn" data-noexport id="session-scope-scope-specifications">scope specifications</dfn>
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list②">list</a> of <a data-link-type="dfn" href="#scope-specification" id="ref-for-scope-specification">scope specifications</a> used by the session</p>
   </dl>
   <h3 class="heading settled" data-level="7.5" id="framework-scope-specification"><span class="secno">7.5. </span><span class="content">Scope specification</span><a class="self-link" href="#framework-scope-specification"></a></h3>
   
A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="scope-specification">scope specification</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct②">struct</a> with the following
<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct-item" id="ref-for-struct-item②">items</a>:

   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="scope specification" data-dfn-type="dfn" data-noexport id="scope-specification-type">type</dfn>
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string④">string</a> to be either "include" or "exclude", defining if the item
defined in this struct should be added or removed from the scope</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="scope specification" data-dfn-type="dfn" data-noexport id="scope-specification-domain">domain</dfn>
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string⑤">string</a> defining the domain or domain pattern that must match for this scope specification to apply</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="scope specification" data-dfn-type="dfn" data-noexport id="scope-specification-path">path</dfn>
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string⑥">string</a> that defines the path part of this scope specification</p>
   </dl>
   <h3 class="heading settled" data-level="7.6" id="framework-session-credential"><span class="secno">7.6. </span><span class="content">Session credential</span><a class="self-link" href="#framework-session-credential"></a></h3>
   
A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="session-credential">session credential</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct" id="ref-for-struct③">struct</a> with the following
<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#struct-item" id="ref-for-struct-item③">items</a>:

   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="session credential" data-dfn-type="dfn" data-noexport id="session-credential-name">name</dfn>
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string⑦">string</a> that defines the name of the credential cookie</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="session credential" data-dfn-type="dfn" data-noexport id="session-credential-attributes">attributes</dfn>
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string⑧">string</a> that defines the other attributes of the credential cookie.
User agents should supply the same defaults here as they would for cookies.</p>
   </dl>
   <h3 class="heading settled" data-level="7.7" id="framework-registrable-origin-label"><span class="secno">7.7. </span><span class="content">Registrable origin label</span><a class="self-link" href="#framework-registrable-origin-label"></a></h3>
   
The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="registrable-origin-label">registrable origin label</dfn> of a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-domain" id="ref-for-concept-domain">domain</a> is the first
<a data-link-type="dfn" href="https://url.spec.whatwg.org/#domain-label" id="ref-for-domain-label">domain label</a> of the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain③">registrable domain</a> of a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-domain" id="ref-for-concept-domain①">domain</a>, or null
if the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain④">registrable domain</a> is null. For example, if both <code>co.uk</code> and
<code>de</code> are <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-public-suffix" id="ref-for-host-public-suffix">public suffixes</a>, then the <a data-link-type="dfn" href="#registrable-origin-label" id="ref-for-registrable-origin-label">registrable origin label</a> of
both <code>example.co.uk</code> and <code>www.example.de</code> is <code>example</code>.


   <h2 class="heading settled" data-level="8" id="algorithms"><span class="secno">8. </span><span class="content">Algorithms</span><a class="self-link" href="#algorithms"></a></h2>
   <h3 class="heading settled" data-level="8.1" id="algo-identify-session"><span class="secno">8.1. </span><span class="content">Identify session</span><a class="self-link" href="#algo-identify-session"></a></h3>
   <div class="algorithm" data-algorithm="identify a session" data-algorithm-for="algorithms">
    
  This algorithm describes how to
  <dfn class="dfn-paneled" data-dfn-for="algorithms" data-dfn-type="dfn" data-export id="algorithms-identify-a-session">identify a session</dfn> out of all the
  sessions that exist on a user agent. The
  <a data-link-type="dfn" href="#device-bound-session-session-identifier" id="ref-for-device-bound-session-session-identifier①">session identifier</a> is unique within a
  <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain⑤">registrable domain</a>.


    <p>Given a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url②">URL</a> (<var>url</var>) and <a data-link-type="dfn" href="#device-bound-session-session-identifier" id="ref-for-device-bound-session-session-identifier②">session identifier</a>
  (<var>session identifier</var>), this algorithm returns a <a data-link-type="dfn" href="#device-bound-session" id="ref-for-device-bound-session①">device bound session</a> or
  null if no such session exists.</p>
    <ol>
     <li data-md>
      <p>Let <var>domain</var> be the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain⑥">registrable domain</a> of <var>url</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-host" id="ref-for-concept-url-host">host</a>.</p>
     <li data-md>
      <p>If the user agent’s <a data-link-type="dfn" href="#session-store" id="ref-for-session-store">session store</a> does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists">contain</a> <var>domain</var>,
 return null.</p>
     <li data-md>
      <p>Let <var>domain sessions</var> be the user agent’s <a data-link-type="dfn" href="#session-store" id="ref-for-session-store①">session store</a>[<var>domain</var>] as a
 <a data-link-type="dfn" href="#sessions-by-id-map" id="ref-for-sessions-by-id-map①">sessions by id map</a>.</p>
     <li data-md>
      <p>Return <var>domain sessions</var>[<var>session identifier</var>] <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-with-default" id="ref-for-map-with-default">with default</a> null.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="8.2" id="algo-url-in-scope"><span class="secno">8.2. </span><span class="content">Identify if a URL is in scope of a session</span><a class="self-link" href="#algo-url-in-scope"></a></h3>
   <div class="algorithm" data-algorithm="determine if a URL is in scope" data-algorithm-for="algorithms">
    
  This algorithm describes how to <dfn class="dfn-paneled" data-dfn-for="algorithms" data-dfn-type="dfn" data-export data-lt="determine if a URL is in scope" id="algorithms-determine-if-a-url-is-in-scope">determine if a
  URL is in scope</dfn> of a device bound session. Given a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url③">URL</a> (<var>URL</var>) and
  <a data-link-type="dfn" href="#device-bound-session" id="ref-for-device-bound-session②">device bound session</a> (<var>session</var>), returns "include" if <var>URL</var> is in scope,
  and "exclude" otherwise.


    <p>Note that specifications are checked from last to
  first. Specifications are expected to be nested, and this allows site
  developers to specify from most applicable to least applicable.</p>
    <ol>
     <li data-md>
      <p>Let <var>scope</var> be <var>session</var>’s <a data-link-type="dfn" href="#device-bound-session-session-scope" id="ref-for-device-bound-session-session-scope">session scope</a>.</p>
     <li data-md>
      <p>If <var>scope</var>’s <a data-link-type="dfn" href="#session-scope-include-site" id="ref-for-session-scope-include-site">include site</a> is true, return "exclude" if <var>URL</var>’s
 <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin①">origin</a> is not <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-site" id="ref-for-same-site">same site</a> with <var>scope</var>’s <a data-link-type="dfn" href="#session-scope-origin" id="ref-for-session-scope-origin">origin</a>.</p>
     <li data-md>
      <p>If <var>scope</var>’s <a data-link-type="dfn" href="#session-scope-include-site" id="ref-for-session-scope-include-site①">include site</a> is false, return "exclude" if <var>URL</var>’s
 <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin②">origin</a> is not <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-origin" id="ref-for-same-origin">same origin</a> with <var>scope</var>’s <a data-link-type="dfn" href="#session-scope-origin" id="ref-for-session-scope-origin①">origin</a>.</p>
     <li data-md>
      <p>If <var>URL</var> matches <var>session</var>’s <a data-link-type="dfn" href="#device-bound-session-refresh-url" id="ref-for-device-bound-session-refresh-url">refresh URL</a>, return "exclude".</p>
     <li data-md>
      <p>Let <var>specifications</var> be the reverse of <var>scope</var>’s <a data-link-type="dfn" href="#session-scope-scope-specifications" id="ref-for-session-scope-scope-specifications">scope specifications</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate">For each</a> <var>scope specification</var> in <var>specifications</var>.</p>
      <ol>
       <li data-md>
        <p>Let <var>domain pattern</var> be <var>scope specification</var>’s <a data-link-type="dfn" href="#scope-specification-domain" id="ref-for-scope-specification-domain">domain</a>, and <var>path pattern</var> be <var>scope
 specification</var>’s <a data-link-type="dfn" href="#scope-specification-path" id="ref-for-scope-specification-path">path</a>.</p>
       <li data-md>
        <p>If running <a href="#algo-domain-pattern-matches">§ 8.4 Identify if a host matches a pattern</a> on <var>URL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-host" id="ref-for-concept-url-host①">host</a>
 and <var>domain pattern</var> returns false, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue">continue</a>.</p>
       <li data-md>
        <p>If any of the following hold, return <var>scope specification</var>’s <a data-link-type="dfn" href="#scope-specification-type" id="ref-for-scope-specification-type">type</a>:</p>
        <ol>
         <li data-md>
          <p><var>URL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-path" id="ref-for-concept-url-path">path</a> is exactly <var>path pattern</var>.</p>
         <li data-md>
          <p><var>path pattern</var> ends in '/' and <var>URL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-path" id="ref-for-concept-url-path①">path</a> starts with <var>path pattern</var>.</p>
         <li data-md>
          <p><var>URL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-path" id="ref-for-concept-url-path②">path</a> starts with <var>path pattern</var> followed by a '/'.</p>
        </ol>
      </ol>
     <li data-md>
      <p>Return "include".</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="8.3" id="algo-request-allows-refresh"><span class="secno">8.3. </span><span class="content">Identify if a request is allowed to refresh</span><a class="self-link" href="#algo-request-allows-refresh"></a></h3>
   <div class="algorithm" data-algorithm="determine if a request is allowed to trigger refresh" data-algorithm-for="algorithms">
    
  This algorithm describes how to <dfn class="dfn-paneled" data-dfn-for="algorithms" data-dfn-type="dfn" data-export data-lt="determine if a request is allowed to trigger refresh" id="algorithms-determine-if-a-request-is-allowed-to-trigger-refresh">determine if
  a request is allowed to trigger refresh</dfn> for a device bound
  session. Given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request">request</a> (<var>request</var>) and <a data-link-type="dfn" href="#device-bound-session" id="ref-for-device-bound-session③">device bound session</a>
  (<var>session</var>), returns "allowed" if <var>request</var> can trigger a refresh, and
  "disallowed" otherwise.


    <ol>
     <li data-md>
      <p>If <var>session</var>’s <a data-link-type="dfn" href="#device-bound-session-session-scope" id="ref-for-device-bound-session-session-scope①">session scope</a>’s <a data-link-type="dfn" href="#session-scope-include-site" id="ref-for-session-scope-include-site②">include site</a> is true, and <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-origin" id="ref-for-concept-request-origin">origin</a> is <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-site" id="ref-for-same-site①">same site</a> with <var>session</var>’s <a data-link-type="dfn" href="#device-bound-session-session-scope" id="ref-for-device-bound-session-session-scope②">session scope</a>
 <a data-link-type="dfn" href="#session-scope-origin" id="ref-for-session-scope-origin②">origin</a>, return "allowed".</p>
     <li data-md>
      <p>If <var>session</var>’s <a data-link-type="dfn" href="#device-bound-session-session-scope" id="ref-for-device-bound-session-session-scope③">session scope</a>’s <a data-link-type="dfn" href="#session-scope-include-site" id="ref-for-session-scope-include-site③">include site</a> is false, and <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-origin" id="ref-for-concept-request-origin①">origin</a> is <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-origin" id="ref-for-same-origin①">same origin</a> with <var>session</var>’s <a data-link-type="dfn" href="#device-bound-session-session-scope" id="ref-for-device-bound-session-session-scope④">session scope</a>
 <a data-link-type="dfn" href="#session-scope-origin" id="ref-for-session-scope-origin③">origin</a>, return "allowed".</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate①">For each</a> <var>initiator pattern</var> in <var>session</var>’s
 <a data-link-type="dfn" href="#device-bound-session-allowed-refresh-initiators" id="ref-for-device-bound-session-allowed-refresh-initiators">allowed refresh initiators</a>:</p>
      <ol>
       <li data-md>
        <p>If running <a href="#algo-domain-pattern-matches">§ 8.4 Identify if a host matches a pattern</a> on <var>request</var>’s
 <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-origin" id="ref-for-concept-request-origin②">origin</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-host" id="ref-for-concept-origin-host">host</a> and <var>initiator pattern</var>
 returns true, return "allowed".</p>
      </ol>
     <li data-md>
      <p>Return "disallowed".</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="8.4" id="algo-domain-pattern-matches"><span class="secno">8.4. </span><span class="content">Identify if a host matches a pattern</span><a class="self-link" href="#algo-domain-pattern-matches"></a></h3>
   <div class="algorithm" data-algorithm="determine if a host matches a pattern" data-algorithm-for="algorithms">
    
  This algorithm describes how to <dfn class="dfn-paneled" data-dfn-for="algorithms" data-dfn-type="dfn" data-export data-lt="determine if a host matches a pattern" id="algorithms-determine-if-a-host-matches-a-pattern">determine if
  a host matches a pattern</dfn>. It takes as input a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-host" id="ref-for-concept-url-host②">host</a> (<var>host</var>) and
  a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string⑨">string</a> (<var>pattern</var>). It returns true if <var>pattern</var> covers <var>host</var>.


    <ol>
     <li data-md>
      <p>If <var>pattern</var> equals '*', return true.</p>
     <li data-md>
      <p>Let <var>host string</var> be the serialized <var>host</var>.</p>
     <li data-md>
      <p>If <var>pattern</var> starts with '*' and <var>host</var> is a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-domain" id="ref-for-concept-domain②">domain</a>:</p>
      <ol>
       <li data-md>
        <p>If <var>pattern</var> does not start with '*.', return false.</p>
       <li data-md>
        <p>Return true if <var>host string</var> ends with all but the first character
 of <var>pattern</var>.</p>
      </ol>
     <li data-md>
      <p>Return true if <var>host string</var> is equal to <var>pattern</var>.</p>
    </ol>
    <div class="example" id="host-pattern-matches-example">
     <a class="self-link" href="#host-pattern-matches-example"></a>
  Some examples of pattern matches:

     <ul>
      <li data-md>
       <p><code>example.com</code> matches <code>*</code></p>
      <li data-md>
       <p><code>example.com</code> matches <code>example.com</code></p>
      <li data-md>
       <p><code>example.com</code> does not match <code>*.example.com</code></p>
      <li data-md>
       <p><code>subdomain.example.com</code> matches <code>*.example.com</code></p>
     </ul>
    </div>
   </div>
   <h3 class="heading settled" data-level="8.5" id="algo-identify-session-needing-refresh"><span class="secno">8.5. </span><span class="content">Identify session needing refresh</span><a class="self-link" href="#algo-identify-session-needing-refresh"></a></h3>
   <div class="algorithm" data-algorithm="identify a session needing refresh" data-algorithm-for="algorithms">
    
  Given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request①">request</a> (<var>request</var>), this algorithm describes how to <dfn class="dfn-paneled" data-dfn-for="algorithms" data-dfn-type="dfn" data-export id="algorithms-identify-a-session-needing-refresh">identify a session needing refresh</dfn>. If any such
  session exists, it should block <var>request</var> from proceeding.


    <ol>
     <li data-md>
      <p>Let <var>domain</var> be the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain⑦">registrable domain</a> of <var>request</var>’s
 <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url">url</a>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-host" id="ref-for-concept-url-host③">host</a>.</p>
     <li data-md>
      <p>If the user agent’s <a data-link-type="dfn" href="#session-store" id="ref-for-session-store②">session store</a> does not <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#map-exists" id="ref-for-map-exists①">contain</a> <var>domain</var>,
 return null.</p>
     <li data-md>
      <p>Let <var>domain sessions</var> be the user agent’s <a data-link-type="dfn" href="#session-store" id="ref-for-session-store③">session store</a>[<var>domain</var>] as a
 <a data-link-type="dfn" href="#sessions-by-id-map" id="ref-for-sessions-by-id-map②">sessions by id map</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate②">For each</a> <var>session</var> in <var>domain sessions</var>:</p>
      <ol>
       <li data-md>
        <p>If <var>session</var>’s <a data-link-type="dfn" href="#device-bound-session-expiration-timestamp" id="ref-for-device-bound-session-expiration-timestamp">expiration timestamp</a> is before the present, remove
<var>session</var> from <var>domain sessions</var> and <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue①">continue</a>.</p>
       <li data-md>
        <p>Let <var>id</var> be <var>session</var>’s <a data-link-type="dfn" href="#device-bound-session-session-identifier" id="ref-for-device-bound-session-session-identifier③">session identifier</a>.</p>
       <li data-md>
        <p>If the <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#tuple" id="ref-for-tuple">tuple</a> (<var>domain</var>, <var>id</var>) is in <var>request</var>’s
<a data-link-type="dfn" href="#request-deferred-device-bound-session-ids" id="ref-for-request-deferred-device-bound-session-ids">deferred device bound session ids</a>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue②">continue</a>.</p>
       <li data-md>
        <p>Run the steps in <a href="#algo-url-in-scope">§ 8.2 Identify if a URL is in scope of a session</a> on <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url①">URL</a>
 and <var>session</var>. If the result is not "include", <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue③">continue</a>.</p>
       <li data-md>
        <p>Run the steps in <a href="#algo-request-allows-refresh">§ 8.3 Identify if a request is allowed to refresh</a> on <var>request</var> and
<var>session</var>. If the result is not "allowed", <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue④">continue</a>.</p>
       <li data-md>
        <p>Run the steps in <a href="#algo-identify-if-missing-session-credential">§ 8.6 Identify if missing session credential</a> on
<var>request</var> and <var>session</var>’s <a data-link-type="dfn" href="#device-bound-session-session-credentials" id="ref-for-device-bound-session-session-credentials">session credentials</a>.
If the result is false, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue⑤">continue</a>.</p>
       <li data-md>
        <p>Add (<var>domain</var>, <var>id</var>) to <var>request</var>’s <a data-link-type="dfn" href="#request-deferred-device-bound-session-ids" id="ref-for-request-deferred-device-bound-session-ids①">deferred device bound session ids</a>.</p>
       <li data-md>
        <p>Set <var>session</var>’s <a data-link-type="dfn" href="#device-bound-session-expiration-timestamp" id="ref-for-device-bound-session-expiration-timestamp①">expiration timestamp</a> set to a future timestamp. The
 exact choice of expiration timestamp is left up to the user agent. It is
 recommended to align with the maximum cookie lifetime.</p>
       <li data-md>
        <p>Return <var>session</var>.</p>
      </ol>
     <li data-md>
      <p>Return null.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="8.6" id="algo-identify-if-missing-session-credential"><span class="secno">8.6. </span><span class="content">Identify if missing session credential</span><a class="self-link" href="#algo-identify-if-missing-session-credential"></a></h3>
   <div class="algorithm" data-algorithm="identify if a request is missing a session credential" data-algorithm-for="algorithms">
    
  This algorithm describes how to <dfn class="dfn-paneled" data-dfn-for="algorithms" data-dfn-type="dfn" data-export data-lt="identify if a request is missing a session credential" id="algorithms-identify-if-a-request-is-missing-a-session-credential">identify if a
  request is missing a session credential</dfn>. Given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request②">request</a> (<var>request</var>)
  and a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list③">list</a> of <a data-link-type="dfn" href="#session-credential" id="ref-for-session-credential①">session credentials</a> (<var>credentials</var>), returns a
  <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#boolean" id="ref-for-boolean①">boolean</a> indicating whether any <var>credential</var> in <var>credentials</var> is missing on
  <var>request</var>.
  

    <ol>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate③">For each</a> <var>credential</var> in <var>credentials</var>:</p>
      <ol>
       <li data-md>
        <p>If a cookie with <var>credential</var>’s <a data-link-type="dfn" href="#session-credential-attributes" id="ref-for-session-credential-attributes">attributes</a> would
 not be attached to <var>request</var> (see <a href="https://httpwg.org/specs/rfc6265.html#cookie">section 5.4</a> of
 <a data-link-type="biblio" href="#biblio-cookies" title="HTTP State Management Mechanism">[COOKIES]</a>), <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue⑥">continue</a>.</p>
       <li data-md>
        <p>If <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list" id="ref-for-concept-request-header-list">header list</a> contains a <var>cookie</var> that
 satisfies all of the following conditions, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue⑦">continue</a>:</p>
        <ol>
         <li data-md>
          <p><var>cookie</var>’s name matches <var>credential</var>’s <a data-link-type="dfn" href="#session-credential-name" id="ref-for-session-credential-name">name</a>.</p>
         <li data-md>
          <p>All of the following attributes of <var>cookie</var> match those in
 <var>credential</var>’s <a data-link-type="dfn" href="#session-credential-attributes" id="ref-for-session-credential-attributes①">attributes</a>: Domain, Path,
 Secure, HttpOnly, SameSite.</p>
        </ol>
       <li data-md>
        <p>Return true.</p>
      </ol>
     <li data-md>
      <p>Return false.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="8.7" id="algo-process-challenge"><span class="secno">8.7. </span><span class="content">Cache challenge</span><a class="self-link" href="#algo-process-challenge"></a></h3>
   <div class="algorithm" data-algorithm="process a challenge" data-algorithm-for="algorithms">
    
  This algorithm describes how to
  <dfn class="dfn-paneled" data-dfn-for="algorithms" data-dfn-type="dfn" data-export id="algorithms-process-a-challenge">process a challenge</dfn> received in an HTTP
  header.


    <p>Given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response">response</a> (<var>response</var>), this algorithm updates the <a data-link-type="dfn" href="#device-bound-session-cached-challenge" id="ref-for-device-bound-session-cached-challenge">cached challenge</a> for a <a data-link-type="dfn" href="#device-bound-session" id="ref-for-device-bound-session④">device bound session</a>.</p>
    <ol>
     <li data-md>
      <p>Let <var>header name</var> be "<code>Secure-Session-Challenge</code>".</p>
     <li data-md>
      <p>Let <var>challenge list</var> be the result of executing <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header" id="ref-for-concept-header-list-get-structured-header">get a structured
field value</a> given <var>header name</var> and "list" from <var>response</var>’s
<a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list" id="ref-for-concept-response-header-list">header list</a>.</p>
     <li data-md>
      <p>If <var>challenge list</var> is null, return.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate④">For each</a> (<var>challenge</var>, <var>params</var>) in <var>challenge list</var>:</p>
      <ol>
       <li data-md>
        <p>If the type of <var>challenge</var> is not an <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#string" id="ref-for-string①⓪">sf-string</a>,
<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue⑧">continue</a>.</p>
       <li data-md>
        <p>Let <var>session id</var> be null.</p>
       <li data-md>
        <p>If <var>params</var>["id"] exists and is an <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#string" id="ref-for-string①①">sf-string</a>, set <var>session id</var> to
<var>params</var>["id"].</p>
       <li data-md>
        <p>If <var>session id</var> is null, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue⑨">continue</a>.</p>
       <li data-md>
        <p>Let <var>session</var> be the result of running <a href="#algo-identify-session">§ 8.1 Identify session</a> given
<var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-url" id="ref-for-concept-response-url">URL</a> and <var>session id</var>.</p>
       <li data-md>
        <p>If <var>session</var> is null, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue①⓪">continue</a>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate⑤">For each</a> <var>credential</var> in <var>session</var>’s <a data-link-type="dfn" href="#device-bound-session-session-credentials" id="ref-for-device-bound-session-session-credentials①">session credentials</a>:</p>
        <ol>
         <li data-md>
          <p>If a cookie with <var>credential</var>’s <a data-link-type="dfn" href="#session-credential-attributes" id="ref-for-session-credential-attributes②">attributes</a> could
  not be set by <var>response</var> (see <a href="https://httpwg.org/specs/rfc6265.html#storage-model">section 5.3</a> of
  <a data-link-type="biblio" href="#biblio-cookies" title="HTTP State Management Mechanism">[COOKIES]</a>), <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue①①">continue</a>.</p>
         <li data-md>
          <p>Store <var>challenge</var> as <var>session</var>’s <a data-link-type="dfn" href="#device-bound-session-cached-challenge" id="ref-for-device-bound-session-cached-challenge①">cached challenge</a> to be used next
 time a <a data-link-type="dfn" href="#dbsc-proof" id="ref-for-dbsc-proof">DBSC proof</a> is to be sent from this <a data-link-type="dfn" href="#device-bound-session" id="ref-for-device-bound-session⑤">device bound session</a>.</p>
         <li data-md>
          <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-break" id="ref-for-iteration-break">Break</a>.</p>
        </ol>
      </ol>
    </ol>
   </div>
   <h3 class="heading settled" data-level="8.8" id="algo-session-request"><span class="secno">8.8. </span><span class="content">Send request</span><a class="self-link" href="#algo-session-request"></a></h3>
   <div class="algorithm" data-algorithm="send a request" data-algorithm-for="algorithms">
    
  This algorithm describes how to <dfn class="dfn-paneled" data-dfn-for="algorithms" data-dfn-type="dfn" data-export data-lt="send a request" id="algorithms-send-a-request">send a
  request</dfn> for a device bound session registration or refresh. It takes as
  input a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request③">request</a> (<var>originating request</var>), an optional <var>key pair</var>, <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url④">URL</a>
  (<var>destination</var>), and optional <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string①②">strings</a> <var>session id</var>, <var>challenge</var>, and
  <var>authorization</var>.


    <p>User agents will perform these steps whenever a bound credential is missing,
  but MAY do this at any time. Sending a request proactively before the bound
  credential expires can minimize the latency costs of DBSC.</p>
    <ol>
     <li data-md>
      <p>The user agent MAY skip this request in order to prevent denial of service for
 the user or site. For example, this might happen if this session is
 requesting excessive TPM operations (harming the user) or the refresh
 endpoint has recently been unreachable (denial of service risk for the
 site). If the user agent chooses to do this, it should perform the steps of
 <a href="#algo-add-debug-header">§ 8.12 Add debug header</a> with <var>originating request</var>, an appropriate token (see
 options in <a href="#header-secure-session-skipped">§ 9.5 `Secure-Session-Skipped` HTTP header field</a>), and <var>session id</var>
 to indicate this to the site.</p>
     <li data-md>
      <p>Let <var>terminate the session</var> be an algorithm with the following steps:</p>
      <ol>
       <li data-md>
        <p>If <var>session id</var> is null, return.</p>
       <li data-md>
        <p>Remove the session with domain <var>destination</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-host" id="ref-for-concept-url-host④">host</a>’s
 <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain⑧">registrable domain</a> and identifier <var>session id</var> from the
 user agent’s <a data-link-type="dfn" href="#session-store" id="ref-for-session-store④">session store</a>, if such a session if found.</p>
      </ol>
     <li data-md>
      <p>If <var>originating request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url②">URL</a>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin③">origin</a> is not <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-site" id="ref-for-same-site②">same site</a> with
 <var>destination</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin④">origin</a>, return.</p>
     <li data-md>
      <p>Let <var>session response</var> be null. If <var>challenge</var> or <var>authorization</var> is
 non-null, let <var>session response</var> be the result of creating a <a data-link-type="dfn" href="#dbsc-proof" id="ref-for-dbsc-proof①">DBSC proof</a>
 for <var>challenge</var> and <var>authorization</var>.</p>
     <li data-md>
      <p>If <var>key pair</var> and <var>session response</var> are non-null, sign <var>session response</var>
 with <var>key pair</var>. The user agent MAY reuse cached results from a previous signing
 if all inputs are the same instead of resigning.</p>
     <li data-md>
      <p>Create a <var>request</var> for use in <a href="https://fetch.spec.whatwg.org/#http-fetch">HTTP fetch</a>.</p>
     <li data-md>
      <p>Set <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-method" id="ref-for-concept-request-method">method</a> to "POST".</p>
     <li data-md>
      <p>Set <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url③">URL</a> to <var>destination</var>.</p>
     <li data-md>
      <p>Set <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-redirect-mode" id="ref-for-concept-request-redirect-mode">redirect mode</a> to "follow".</p>
     <li data-md>
      <p>If <var>session response</var> is non-null, <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-append" id="ref-for-concept-header-list-append">append</a> the header
 ("Secure-Session-Response", <var>session response</var>) to <var>request</var>’s
 <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list" id="ref-for-concept-request-header-list①">header list</a>.</p>
     <li data-md>
      <p>If <var>session id</var> is non-null, <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-append" id="ref-for-concept-header-list-append①">append</a> the header
 ("Sec-Secure-Session-Id", <var>session id</var>) to <var>request</var>’s
 <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list" id="ref-for-concept-request-header-list②">header list</a>.</p>
     <li data-md>
      <p>If <var>authorization</var> is non-null, <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-append" id="ref-for-concept-header-list-append②">append</a> the header
 ("Authorization", <var>authorization</var>) to <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list" id="ref-for-concept-request-header-list③">header list</a>.</p>
     <li data-md>
      <p>Set <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-initiator" id="ref-for-concept-request-initiator">initiator</a> to <var>originating request</var>’s
 <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-initiator" id="ref-for-concept-request-initiator①">initiator</a>.</p>
     <li data-md>
      <p>Set <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-origin" id="ref-for-concept-request-origin③">origin</a> to <var>originating request</var>’s
 <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-origin" id="ref-for-concept-request-origin④">origin</a>.</p>
     <li data-md>
      <p>Let <var>response</var> be the result of running <a href="https://fetch.spec.whatwg.org/#http-fetch">HTTP fetch</a> for <var>request</var>.</p>
     <li data-md>
      <p>If <var>response</var> is a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-network-error" id="ref-for-concept-network-error">network error</a>, or <var>response</var>’s
 <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-status" id="ref-for-concept-response-status">status</a> is 407 or 429, return.</p>
     <li data-md>
      <p>If <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-status" id="ref-for-concept-response-status①">status</a> is at least 300 and below 400, then
 return.</p>
     <li data-md>
      <p>If <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-status" id="ref-for-concept-response-status②">status</a> is 403:</p>
      <ol>
       <li data-md>
        <p>If <var>session id</var> is null, return.</p>
       <li data-md>
        <p>Let <var>session</var> be the result of running the steps of
 <a href="#algo-identify-session">§ 8.1 Identify session</a> on <var>destination</var> and <var>session id</var>.</p>
       <li data-md>
        <p>If <var>session</var> is null, return.</p>
       <li data-md>
        <p>Otherwise, restart this algorithm with the original inputs, except
 replacing <var>challenge</var> with <var>session</var>’s <a data-link-type="dfn" href="#device-bound-session-cached-challenge" id="ref-for-device-bound-session-cached-challenge②">cached challenge</a>.</p>
      </ol>
     <li data-md>
      <p>If <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-status" id="ref-for-concept-response-status③">status</a> is at least 400 and below 500,
 then <var>terminate the session</var> and return.</p>
     <li data-md>
      <p>If <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-status" id="ref-for-concept-response-status④">status</a> is at least 500, then
 return. User agents may choose to trigger a backoff mechanism on
 subsequent refresh requests on this session, to limit the harm of a
 temporary outage on the refresh endpoint.</p>
     <li data-md>
      <p>If <var>session id</var> is non-null, and <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body">body</a> is
 empty, return.</p>
     <li data-md>
      <p>Call <a href="#algo-create-session">§ 8.9 Create session</a> on <var>response</var>, <var>destination</var>,
 <var>session id</var>, and <var>key pair</var>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="8.9" id="algo-create-session"><span class="secno">8.9. </span><span class="content">Create session</span><a class="self-link" href="#algo-create-session"></a></h3>
   <div class="algorithm" data-algorithm="create a session">
    
To <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="create-session">create a session</dfn> due to the <var>response</var>
(a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response①">response</a>) to a registration request to <var>destination</var> (a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url⑤">URL</a>) for
<var>session id</var> (a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string①③">string</a> or null) with an optional <var>key pair</var>, perform the
following steps:

    <ol>
     <li data-md>
      <p>Let <var>terminate the session</var> be an algorithm with the following steps:</p>
      <ol>
       <li data-md>
        <p>If <var>session id</var> is null, return.</p>
       <li data-md>
        <p>Remove the session with domain <var>destination</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-host" id="ref-for-concept-url-host⑤">host</a>’s
 <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain⑨">registrable domain</a> and identifier <var>session id</var> from the
 user agent’s <a data-link-type="dfn" href="#session-store" id="ref-for-session-store⑤">session store</a>, if such a session if found.</p>
      </ol>
     <li data-md>
      <p>Let <var>JSON session</var> be the result of parsing <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body①">body</a>
 as a <a data-link-type="dfn" href="#json-session-instructions" id="ref-for-json-session-instructions">JSON session instructions</a>. If parsing fails, <var>terminate the
 session</var> and return. This includes validating all required keys are
 present.</p>
     <li data-md>
      <p>If <var>JSON session</var>’s <a data-link-type="dfn" href="#json-session-instructions-continue" id="ref-for-json-session-instructions-continue">continue</a> is false,
 <var>terminate the session</var> and return.</p>
     <li data-md>
      <p>Let <var>session identifier</var> be <var>JSON session</var>’s <a data-link-type="dfn" href="#json-session-instructions-session_identifier" id="ref-for-json-session-instructions-session_identifier">session_identifier</a>.</p>
     <li data-md>
      <p>Let <var>JSON scope</var> be <var>JSON session</var>’s <a data-link-type="dfn" href="#json-session-instructions-scope" id="ref-for-json-session-instructions-scope">scope</a>.</p>
     <li data-md>
      <p>Let <var>origin</var> be an <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin⑤">origin</a> constructed from <var>JSON scope</var>’s <a data-link-type="dfn" href="#json-session-scope-origin" id="ref-for-json-session-scope-origin">origin</a>, if present, or the origin of <var>destination</var> if not.</p>
     <li data-md>
      <p>If <var>JSON session</var>’s <a data-link-type="dfn" href="#json-session-instructions-refresh_url" id="ref-for-json-session-instructions-refresh_url">refresh_url</a> does
 not have a value, let <var>refresh URL</var> be <var>destination</var>.</p>
     <li data-md>
      <p>Otherwise, let <var>refresh URL</var> be the result of resolving <var>destination</var> with
 the value of <var>JSON session</var>’s <a data-link-type="dfn" href="#json-session-instructions-refresh_url" id="ref-for-json-session-instructions-refresh_url①">refresh_url</a>.</p>
     <li data-md>
      <p>Perform the following validations. If any fail,
 <var>terminate the session</var> and return.</p>
      <ol>
       <li data-md>
        <p>If <var>session id</var> is non-null, it must match <var>session identifier</var>.</p>
       <li data-md>
        <p><var>origin</var> must be a valid non-opaque origin.</p>
       <li data-md>
        <p><var>origin</var> must be <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-site" id="ref-for-same-site③">same site</a> with <var>destination</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin⑥">origin</a>.</p>
       <li data-md>
        <p><var>refresh URL</var> must have scheme HTTPS or be localhost.</p>
       <li data-md>
        <p><var>refresh URL</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin⑦">origin</a> must be <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-site" id="ref-for-same-site④">same site</a> with <var>destination</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" id="ref-for-concept-origin⑧">origin</a>.</p>
       <li data-md>
        <p>All of the <a data-link-type="dfn" href="#json-session-credential" id="ref-for-json-session-credential①">JSON session credentials</a> must not have the attribute "Partitioned".</p>
      </ol>
     <li data-md>
      <p>Let <var>destination domain</var> be the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain①⓪">registrable domain</a> of <var>destination</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-host" id="ref-for-concept-url-host⑥">host</a>.</p>
     <li data-md>
      <p>If the <var>JSON scope</var>’s <a data-link-type="dfn" href="#json-session-scope-include_site" id="ref-for-json-session-scope-include_site">include_site</a> is true, perform
 the following validations. If any fail, <var>terminate the session</var> and return.</p>
      <ol>
       <li data-md>
        <p><var>origin</var>’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-host" id="ref-for-concept-origin-host①">host</a> must be equal to <var>destination domain</var>.</p>
       <li data-md>
        <p>If <var>destination domain</var> is equal to the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-host" id="ref-for-concept-url-host⑦">host</a> of
  <var>destination</var>, skip all remaining validations within this step.</p>
       <li data-md>
        <p>If <var>session id</var> is non-null, skip all remaining validations within this
 step.</p>
       <li data-md>
        <p>Otherwise, let <var>well known URL</var> be a copy of <var>destination</var>, with the
 <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-host" id="ref-for-concept-url-host⑧">host</a> replaced with <var>destination domain</var>, and the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-path" id="ref-for-concept-url-path③">path</a>
 replaced with "/.well-known/device-bound-sessions".</p>
       <li data-md>
        <p>Let <var>well known response</var> be the result of fetching <var>well known URL</var> with
 <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-credentials-mode" id="ref-for-concept-request-credentials-mode">credentials mode</a> set to <code>omit</code>.</p>
       <li data-md>
        <p><var>well known response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-status" id="ref-for-concept-response-status⑤">status</a> must be 200.</p>
       <li data-md>
        <p><var>well known response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body②">body</a> must be a JSON-encoded
 dictionary.</p>
       <li data-md>
        <p><var>well known response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body③">body</a> must include the key "registering_origins".</p>
       <li data-md>
        <p>The value of the key "registering_origins" must include the origin of
 <var>destination</var>.</p>
      </ol>
     <li data-md>
      <p>Let <var>session</var> be a new session.</p>
     <li data-md>
      <p>Set <var>session</var>’s <a data-link-type="dfn" href="#device-bound-session-session-identifier" id="ref-for-device-bound-session-session-identifier④">session identifier</a> to <var>session
 identifier</var>.</p>
     <li data-md>
      <p>Set <var>session</var>’s <a data-link-type="dfn" href="#device-bound-session-refresh-url" id="ref-for-device-bound-session-refresh-url①">refresh URL</a> to <var>refresh URL</var>.</p>
     <li data-md>
      <p>Set <var>session</var>’s <a data-link-type="dfn" href="#device-bound-session-session-scope" id="ref-for-device-bound-session-session-scope⑤">session scope</a> to a new scope with
 <a data-link-type="dfn" href="#session-scope-origin" id="ref-for-session-scope-origin④">origin</a> <var>origin</var>, and <a data-link-type="dfn" href="#session-scope-include-site" id="ref-for-session-scope-include-site④">include site</a> the value of <var>JSON
 scope</var>’s <a data-link-type="dfn" href="#json-session-scope-include_site" id="ref-for-json-session-scope-include_site①">include_site</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate⑥">For each</a> <var>JSON scope rule</var> in <var>JSON scope</var>’s <a data-link-type="dfn" href="#json-session-scope-scope_specification" id="ref-for-json-session-scope-scope_specification">scope_specification</a>:</p>
      <ol>
       <li data-md>
        <p>Let <var>scope rule</var> be a new <a data-link-type="dfn" href="#scope-specification" id="ref-for-scope-specification①">scope specification</a>.</p>
       <li data-md>
        <p>Set <var>scope rule</var>’s <a data-link-type="dfn" href="#scope-specification-type" id="ref-for-scope-specification-type①">type</a> to <var>JSON scope rule</var>’s
  <a data-link-type="dfn" href="#json-session-scope-rule-type" id="ref-for-json-session-scope-rule-type">type</a>.</p>
       <li data-md>
        <p>Set <var>scope rule</var>’s <a data-link-type="dfn" href="#scope-specification-domain" id="ref-for-scope-specification-domain①">domain</a> to <var>JSON scope rule</var>’s
  <a data-link-type="dfn" href="#json-session-scope-rule-domain" id="ref-for-json-session-scope-rule-domain">domain</a>.</p>
       <li data-md>
        <p>Set <var>scope rule</var>’s <a data-link-type="dfn" href="#scope-specification-path" id="ref-for-scope-specification-path①">path</a> to <var>JSON scope rule</var>’s
  <a data-link-type="dfn" href="#json-session-scope-rule-path" id="ref-for-json-session-scope-rule-path">path</a>.</p>
       <li data-md>
        <p>Append <var>scope rule</var> to <var>session</var>’s <a data-link-type="dfn" href="#device-bound-session-session-scope" id="ref-for-device-bound-session-session-scope⑥">session scope</a>’s <a data-link-type="dfn" href="#session-scope-scope-specifications" id="ref-for-session-scope-scope-specifications①">scope specifications</a>.</p>
      </ol>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate⑦">For each</a> <var>JSON session credential</var> in <var>JSON session</var>’s <a data-link-type="dfn" href="#json-session-instructions-credentials" id="ref-for-json-session-instructions-credentials">credentials</a>:</p>
      <ol>
       <li data-md>
        <p>Let <var>session credential</var> be a new <a data-link-type="dfn" href="#session-credential" id="ref-for-session-credential②">session credential</a>.</p>
       <li data-md>
        <p>If <var>JSON session credential</var>’s <a data-link-type="dfn" href="#json-session-credential-type" id="ref-for-json-session-credential-type">type</a> is not
  "cookie", <var>terminate the session</var> and return.</p>
       <li data-md>
        <p>Set <var>session credential</var>’s <a data-link-type="dfn" href="#session-credential-name" id="ref-for-session-credential-name①">name</a> be <var>JSON session
  credential</var>’s <a data-link-type="dfn" href="#json-session-credential-name" id="ref-for-json-session-credential-name">name</a>.</p>
       <li data-md>
        <p>Set <var>session credential</var>’s <a data-link-type="dfn" href="#session-credential-attributes" id="ref-for-session-credential-attributes③">attributes</a> be <var>JSON
  session credential</var>’s <a data-link-type="dfn" href="#json-session-credential-attributes" id="ref-for-json-session-credential-attributes">attributes</a>.</p>
       <li data-md>
        <p>Append <var>session credential</var> to <var>session</var>’s <a data-link-type="dfn" href="#device-bound-session-session-credentials" id="ref-for-device-bound-session-session-credentials②">session credentials</a>.</p>
      </ol>
     <li data-md>
      <p>Set <var>session</var>’s <a data-link-type="dfn" href="#device-bound-session-session-key-pair" id="ref-for-device-bound-session-session-key-pair">session key pair</a> to <var>key pair</var>.</p>
     <li data-md>
      <p>Set <var>session</var>’s <a data-link-type="dfn" href="#device-bound-session-allowed-refresh-initiators" id="ref-for-device-bound-session-allowed-refresh-initiators①">allowed refresh initiators</a> to <var>JSON session</var>’s <a data-link-type="dfn" href="#json-session-instructions-allowed_refresh_initiators" id="ref-for-json-session-instructions-allowed_refresh_initiators">allowed_refresh_initiators</a>.</p>
     <li data-md>
      <p>Set <var>session</var>’s <a data-link-type="dfn" href="#device-bound-session-expiration-timestamp" id="ref-for-device-bound-session-expiration-timestamp②">expiration timestamp</a> to a future timestamp. The
 exact choice of expiration timestamp is left up to the user agent. It is
 recommended to align with the maximum cookie lifetime.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate⑧">For each</a> <var>credential</var> in <var>session</var>’s <a data-link-type="dfn" href="#device-bound-session-session-credentials" id="ref-for-device-bound-session-session-credentials③">session credentials</a>:</p>
      <ol>
       <li data-md>
        <p>If a cookie with <var>credential</var>’s <a data-link-type="dfn" href="#session-credential-attributes" id="ref-for-session-credential-attributes④">attributes</a> could
 not be set by <var>response</var> (see <a href="https://httpwg.org/specs/rfc6265.html#storage-model">section 5.3</a> of
 <a data-link-type="biblio" href="#biblio-cookies" title="HTTP State Management Mechanism">[COOKIES]</a>), <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue①②">continue</a>.</p>
       <li data-md>
        <p>Call <var>terminate the session</var> to remove the existing session.</p>
       <li data-md>
        <p>Set the user agent’s <a data-link-type="dfn" href="#session-store" id="ref-for-session-store⑥">session store</a>[<var>destination
 domain</var>][<var>session identifier</var>] to <var>session</var>.</p>
       <li data-md>
        <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-break" id="ref-for-iteration-break①">Break</a>.</p>
      </ol>
     <li data-md>
      <p>Run <a href="#algo-process-challenge">§ 8.7 Cache challenge</a> on <var>response</var>.</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="8.10" id="algo-process-session-registration"><span class="secno">8.10. </span><span class="content">Process session registration</span><a class="self-link" href="#algo-process-session-registration"></a></h3>
   <div class="algorithm" data-algorithm="process a session registration">
    
To <dfn class="dfn-paneled" data-dfn-type="dfn" data-export data-lt="process a session registration" id="process-session-registration">process a session
registration</dfn> due to the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response②">response</a> (<var>response</var>) to a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request④">request</a>
(<var>request</var>), do the following steps:

    <ol>
     <li data-md>
      <p>Let <var>header name</var> be "<code>Secure-Session-Registration</code>".</p>
     <li data-md>
      <p>Let <var>registration list</var> be the result of executing <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header" id="ref-for-concept-header-list-get-structured-header①">get a structured
field value</a> given <var>header name</var> and "list" from <var>response</var>’s
<a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-header-list" id="ref-for-concept-response-header-list①">header list</a>.</p>
     <li data-md>
      <p>If <var>registration list</var> is null, return.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate⑨">For each</a> (<var>registration entry</var>, <var>params</var>) in <var>registration list</var>:</p>
      <ol>
       <li data-md>
        <p>If <var>registration entry</var> is not an <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#inner-list" id="ref-for-inner-list">sf-inner-list</a>,
<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue①③">continue</a>.</p>
       <li data-md>
        <p>If <var>params</var>["path"] does not exist, or is not of type <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#string" id="ref-for-string①④">sf-string</a>,
<a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue①④">continue</a>.</p>
       <li data-md>
        <p>Let <var>path</var> be <var>params</var>["path"].</p>
       <li data-md>
        <p>Let <var>challenge</var> be null, and let <var>authorization</var> be null.</p>
       <li data-md>
        <p>If either of <var>params</var>["challenge"] or <var>params</var>["authorization"] exist but
 are not of type <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#string" id="ref-for-string①⑤">sf-string</a>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue①⑤">continue</a>.</p>
       <li data-md>
        <p>If <var>params</var>["challenge"] exists, set <var>challenge</var> to
 <var>params</var>["challenge"].</p>
       <li data-md>
        <p>If <var>params</var>["authorization"] exists, set <var>authorization</var> to
 <var>params</var>["authorization"].</p>
       <li data-md>
        <p>Let <var>endpoint</var> be the result of resolving <var>path</var> relative to
 <var>response</var>’s URL.</p>
       <li data-md>
        <p>Let <var>key pair</var> be the result of running
 <a href="#algo-create-session-key-pair">§ 8.11 Create session key pair</a> on <var>registration entry</var>,
 <var>params</var>, and <var>endpoint</var>.</p>
       <li data-md>
        <p>If <var>key pair</var> is "failure", return.</p>
       <li data-md>
        <p>Call <a href="#algo-session-request">§ 8.8 Send request</a> with <var>request</var>, <var>key pair</var>, <var>endpoint</var>,
 session identifier as null, <var>challenge</var>, and <var>authorization</var>.</p>
      </ol>
    </ol>
   </div>
   <h3 class="heading settled" data-level="8.11" id="algo-create-session-key-pair"><span class="secno">8.11. </span><span class="content">Create session key pair</span><a class="self-link" href="#algo-create-session-key-pair"></a></h3>
   <div class="algorithm" data-algorithm="create a session key pair">
    <p>This algorithm describes how to <dfn class="dfn-paneled" data-dfn-type="dfn" data-export data-lt="create a session key pair" id="create-session-key-pair">create
a session key pair</dfn>, including key sharing between a Relying Party and
Session Provider. It takes as inputs the <var>registration entry</var> and <var>params</var> of a
`<code><a data-link-type="http-header" href="#secure-session-registration-header" id="ref-for-secure-session-registration-header④">Secure-Session-Registration</a></code>` header and the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url⑥">URL</a> (<var>registration URL</var>) of
the registration endpoint. It returns a key pair for use in the session, null to
indicate that no key is needed, or the string "failure" to indicate that key
pair creation failed.</p>
    <ol>
     <li data-md>
      <p>Let <var>algorithm list</var> be an empty <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list④">list</a>.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-iterate" id="ref-for-list-iterate①⓪">For each</a> <var>algorithm</var> in <var>registration entry</var>:</p>
      <ol>
       <li data-md>
        <p>If <var>algorithm</var> is not an <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#token" id="ref-for-token">sf-token</a>, <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#iteration-continue" id="ref-for-iteration-continue①⑥">continue</a>.</p>
       <li data-md>
        <p>If <var>algorithm</var> represents a crypto algorithm supported in
 `<code><a data-link-type="http-header" href="#secure-session-registration-header" id="ref-for-secure-session-registration-header⑤">Secure-Session-Registration</a></code>` and is supported on this client,
 add <var>algorithm</var> to <var>algorithm list</var>.</p>
      </ol>
     <li data-md>
      <p>If <var>algorithm list</var> is empty, return "failure".</p>
     <li data-md>
      <p>If any of <var>params</var>["provider_key"], <var>params</var>["provider_session_id"], or
 <var>params</var>["provider_url"] exists:</p>
      <ol>
       <li data-md>
        <p>If any of the three keys is missing, return "failure".</p>
       <li data-md>
        <p>Let <var>permission</var> be the result of performing <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-request-permission-to-use" id="ref-for-dfn-request-permission-to-use">request permission to use</a> for "device-bound-session-key-sharing".</p>
       <li data-md>
        <p>If <var>permission</var> is <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/permissions/#dom-permissionstate-denied" id="ref-for-dom-permissionstate-denied">"denied"</a></code>, return "failure".</p>
       <li data-md>
        <p>Let <var>provider URL</var> be a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url⑦">URL</a> constructed from
 <var>params</var>["provider_url"].</p>
       <li data-md>
        <p>Let <var>provider origin</var> be the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin">origin</a> of <var>provider URL</var>.</p>
       <li data-md>
        <p>If <var>provider origin</var> is opaque, return "failure".</p>
       <li data-md>
        <p>Let <var>provider domain</var> be the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain①①">registrable domain</a> of
 <var>provider URL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-host" id="ref-for-concept-url-host⑨">host</a>.</p>
       <li data-md>
        <p>Let <var>provider session identifier</var> be <var>params</var>["provider_session_id"].</p>
       <li data-md>
        <p>Let <var>provider session</var> be the session in the user agent’s
 <a data-link-type="dfn" href="#session-store" id="ref-for-session-store⑦">session store</a>[<var>provider domain</var>][<var>provider session identifier</var>].</p>
       <li data-md>
        <p>If <var>provider session</var> is null, return "failure".</p>
       <li data-md>
        <p>If <var>provider session</var>’s <a data-link-type="dfn" href="#device-bound-session-session-scope" id="ref-for-device-bound-session-session-scope⑦">session scope</a>
 <a data-link-type="dfn" href="#session-scope-origin" id="ref-for-session-scope-origin⑤">origin</a> is not <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#same-origin" id="ref-for-same-origin②">same origin</a> with <var>provider
 origin</var>, return "failure".</p>
       <li data-md>
        <p>If <var>provider session</var>’s <a data-link-type="dfn" href="#device-bound-session-session-key-pair" id="ref-for-device-bound-session-session-key-pair①">session key pair</a> is null, or <var>provider
 session</var>’s <a data-link-type="dfn" href="#device-bound-session-session-key-pair" id="ref-for-device-bound-session-session-key-pair②">session key pair</a>’s JWK thumbprint (see <a data-link-type="biblio" href="#biblio-rfc7638" title="JSON Web Key (JWK) Thumbprint">[RFC7638]</a>) does
 not match <var>params</var>["provider_key"] when encoded in base64url (see
 <a data-link-type="biblio" href="#biblio-rfc4648" title="The Base16, Base32, and Base64 Data Encodings">[RFC4648]</a>) without padding, return "failure".</p>
       <li data-md>
        <p>Let <var>provider well known URL</var> be a copy of <var>provider URL</var>, with the
 <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-path" id="ref-for-concept-url-path④">path</a> replaced with "/.well-known/device-bound-sessions".</p>
       <li data-md>
        <p>Let <var>provider well known response</var> be the result of fetching <var>provider
 well known URL</var> with <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-credentials-mode" id="ref-for-concept-request-credentials-mode①">credentials mode</a> set to <code>omit</code>. If any
 of the following hold, return "failure":</p>
        <ol>
         <li data-md>
          <p><var>provider well known response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-status" id="ref-for-concept-response-status⑥">status</a> is not 200.</p>
         <li data-md>
          <p><var>provider well known response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body④">body</a> is not a JSON-encoded
 dictionary.</p>
         <li data-md>
          <p><var>provider well known response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body⑤">body</a> contains the key
 "provider_origin".</p>
         <li data-md>
          <p><var>provider well known response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body⑥">body</a> does not include the
 key "relying_origins".</p>
         <li data-md>
          <p>The value of the key "relying_origins" does not include the
 <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin①">origin</a> of <var>registration URL</var>.</p>
        </ol>
       <li data-md>
        <p>User agents SHOULD place an upper limit on the number of
 <a data-link-type="dfn" href="#registrable-origin-label" id="ref-for-registrable-origin-label①">registrable origin labels</a> in "relying_origins" to prevent
 abuse.</p>
       <li data-md>
        <p>Let <var>relying well known URL</var> be a copy of <var>registration URL</var>, with the
 <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-path" id="ref-for-concept-url-path⑤">path</a> replaced with "/.well-known/device-bound-sessions" with
 <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-credentials-mode" id="ref-for-concept-request-credentials-mode②">credentials mode</a> set to <code>omit</code>.</p>
       <li data-md>
        <p>Let <var>relying well known response</var> be the result of fetching <var>relying well
 known URL</var>. If any of the following hold, return "failure":</p>
        <ol>
         <li data-md>
          <p><var>relying well known response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-status" id="ref-for-concept-response-status⑦">status</a> is not 200.</p>
         <li data-md>
          <p><var>relying well known response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body⑦">body</a> is not a JSON-encoded
 dictionary.</p>
         <li data-md>
          <p><var>relying well known response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body⑧">body</a> contains the key
 "relying_origins".</p>
         <li data-md>
          <p><var>relying well known response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-body" id="ref-for-concept-response-body⑨">body</a> does not include the
 key "provider_origin".</p>
         <li data-md>
          <p>The value of the key "provider_origin" is not the
 <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin②">origin</a> of <var>provider URL</var>.</p>
        </ol>
       <li data-md>
        <p>Return <var>provider session</var>’s <a data-link-type="dfn" href="#device-bound-session-session-key-pair" id="ref-for-device-bound-session-session-key-pair③">session key pair</a>.</p>
      </ol>
     <li data-md>
      <p>Return a new key pair created for <var>algorithm list</var>, using null if the
 selected algorithm is "none".</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="8.12" id="algo-add-debug-header"><span class="secno">8.12. </span><span class="content">Add debug header</span><a class="self-link" href="#algo-add-debug-header"></a></h3>
   <div class="algorithm" data-algorithm="add the debug header">
    
In order for sites to understand when the user agent chooses not to
apply a session, user agents should <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="add-debug-header">add the debug header</dfn> to a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request⑤">request</a>
(<var>request</var>) with an <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#token" id="ref-for-token①">sf-token</a> (<var>token</var>) and <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string①⑥">string</a> (<var>session id</var>).

    <ol>
     <li data-md>
      <p>Let <var>value</var> be an <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#token" id="ref-for-token②">sf-token</a> with value <var>token</var>.</p>
     <li data-md>
      <p>Set the <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#name-parameters" id="ref-for-name-parameters">sf-parameter</a> "session_identifier" on <var>value</var> to <var>session id</var>.</p>
     <li data-md>
      <p>Let <var>skipped header value</var> be the result of running the steps of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header" id="ref-for-concept-header-list-get-structured-header②">get a structured field value</a> with <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#header-name" id="ref-for-header-name">header name</a>
 "Secure-Session-Skipped", type "list", and <var>request</var>’s
 <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list" id="ref-for-concept-request-header-list④">header list</a>.</p>
     <li data-md>
      <p>If <var>skipped header value</var> is null, set it to an empty <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#list" id="ref-for-list⑤">sf-list</a>.</p>
     <li data-md>
      <p>Append <var>value</var> to <var>skipped header value</var>.</p>
     <li data-md>
      <p>Run the steps of <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-set-structured-header" id="ref-for-concept-header-list-set-structured-header">set a structured field value</a> given
("Secure-Session-Skipped", <var>skipped header value</var>) on <var>request</var>’s
<a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list" id="ref-for-concept-request-header-list⑤">header list</a>.</p>
    </ol>
   </div>
   <h2 class="heading settled" data-level="9" id="format"><span class="secno">9. </span><span class="content">DBSC Formats</span><a class="self-link" href="#format"></a></h2>
   <h3 class="heading settled" data-level="9.1" id="header-secure-session-registration"><span class="secno">9.1. </span><span class="content">`<code><a data-link-type="http-header" href="#secure-session-registration-header" id="ref-for-secure-session-registration-header⑥">Secure-Session-Registration</a></code>` HTTP header field</span><a class="self-link" href="#header-secure-session-registration"></a></h3>
   
The <dfn class="dfn-paneled" data-dfn-type="http-header" data-export data-lt="Secure-Session-Registration" id="secure-session-registration-header">
<code>Secure-Session-Registration</code></dfn> header field can be used in a
<a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response③">response</a> by the server to start a new <a data-link-type="dfn" href="#device-bound-session" id="ref-for-device-bound-session⑥">device bound session</a> on the
client.


   <p>`<code><a data-link-type="http-header" href="#secure-session-registration-header" id="ref-for-secure-session-registration-header⑦">Secure-Session-Registration</a></code>` is a List Structured Header <a data-link-type="biblio" href="#biblio-rfc9651" title="Structured Field Values for HTTP">[RFC9651]</a>. Its ABNF
is:</p>
<pre class="abnf">SecureSessionRegistration = <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#list" id="ref-for-list⑥">sf-list</a></pre>
   <p>Each item in the list must be an inner list, and each item in the inner list
MUST be an <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#token" id="ref-for-token③">sf-token</a> representing a supported algorithm (ES256, RS256,
none). Only these three values are currently supported.</p>
   <p>The following <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#name-parameters" id="ref-for-name-parameters①">sf-parameter</a>s are defined:</p>
   <ul>
    <li data-md>
     <p>An <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#name-parameters" id="ref-for-name-parameters②">sf-parameter</a> whose key is "path", and whose value is an
<a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#string" id="ref-for-string①⑦">sf-string</a>, conveying the path to the registration endpoint. This may be
relative to the current <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url⑧">URL</a>, or it may be a full <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url⑨">URL</a>. Entries without
this parameter will be ignored in <a href="#algo-process-session-registration">§ 8.10 Process session registration</a>.</p>
    <li data-md>
     <p>An <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#name-parameters" id="ref-for-name-parameters③">sf-parameter</a> whose key is "challenge", and whose value is an
<a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#string" id="ref-for-string①⑧">sf-string</a>, conveying the challenge to be used in the session
registration.</p>
    <li data-md>
     <p>An <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#name-parameters" id="ref-for-name-parameters④">sf-parameter</a> whose key is "authorization", and whose value is an
<a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#string" id="ref-for-string①⑨">sf-string</a>. This <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#name-parameters" id="ref-for-name-parameters⑤">sf-parameter</a> will be copied into the
registration JWT.</p>
    <li data-md>
     <p>An <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#name-parameters" id="ref-for-name-parameters⑥">sf-parameter</a> whose key is "provider_key", and whose value is
an <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#string" id="ref-for-string②⓪">sf-string</a>, conveying that this session should share keys
with a session with the given public key.</p>
    <li data-md>
     <p>An <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#name-parameters" id="ref-for-name-parameters⑦">sf-parameter</a> whose key is "provider_session_id", and whose value is
an <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#string" id="ref-for-string②①">sf-string</a>, conveying that this session should share keys
with a session with the given session identifier.</p>
    <li data-md>
     <p>An <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#name-parameters" id="ref-for-name-parameters⑧">sf-parameter</a> whose key is "provider_url", and whose value
is an <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#string" id="ref-for-string②②">sf-string</a>, conveying that this session should share keys
with a session on the corresponding site.</p>
   </ul>
   <div class="example" id="secure-session-registration-example">
    <a class="self-link" href="#secure-session-registration-example"></a>
  Some examples of `<code><a data-link-type="http-header" href="#secure-session-registration-header" id="ref-for-secure-session-registration-header⑧">Secure-Session-Registration</a></code>` from
  https://example.com/login.html:

  
<pre class="highlight language-html">HTTP/1.1 200 OK
Secure-Session-Registration: (ES256);path="reg";challenge="cv";authorization="ac"
</pre>
<pre class="highlight language-html">HTTP/1.1 200 OK
Secure-Session-Registration: (ES256 RS256);path="reg";challenge="cv"
</pre>
<pre class="highlight language-html">HTTP/1.1 200 OK
Secure-Session-Registration: (ES256);path="reg1";challenge="cv1";authorization="a"
Secure-Session-Registration: (RS256);path="reg2";challenge="cv2";authorization="b"
</pre>
<pre class="highlight language-html">HTTP/1.1 200 OK
Secure-Session-Registration: (ES256);path="reg1";challenge="cv1";authorization="a", (RS256);path="reg2";challenge="cv2";authorization="b"
</pre>
<pre class="highlight language-html">HTTP/1.1 200 OK
Secure-Session-Registration: (ES256);path="reg1";challenge="cv1";provider_key="abc";provider_session_id="idp_id";provider_url="https://id_origin.example.com"
</pre>
   </div>
   <h3 class="heading settled" data-level="9.2" id="header-secure-session-challenge"><span class="secno">9.2. </span><span class="content">`<code><a data-link-type="http-header" href="#secure-session-challenge-header" id="ref-for-secure-session-challenge-header">Secure-Session-Challenge</a></code>` HTTP header field</span><a class="self-link" href="#header-secure-session-challenge"></a></h3>
   
The <dfn class="dfn-paneled" data-dfn-type="http-header" data-export data-lt="Secure-Session-Challenge" id="secure-session-challenge-header">
<code>Secure-Session-Challenge</code></dfn> header field can be used in a
<a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response④">response</a> by the server to send a challenge to the client that it expects to
be used in future `<code><a data-link-type="http-header" href="#secure-session-response-header" id="ref-for-secure-session-response-header①">Secure-Session-Response</a></code>` headers inside the <a data-link-type="dfn" href="#dbsc-proof" id="ref-for-dbsc-proof②">DBSC proof</a>,
or to request a newly signed <a data-link-type="dfn" href="#dbsc-proof" id="ref-for-dbsc-proof③">DBSC proof</a> immediately during a cookie refresh
if the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-status" id="ref-for-concept-response-status⑧">status</a> is 403.


   <p>`<code><a data-link-type="http-header" href="#secure-session-challenge-header" id="ref-for-secure-session-challenge-header①">Secure-Session-Challenge</a></code>` is a structured header. Its value must be a string.
Its ABNF is: </p>
<pre class="abnf">SecureSessionChallenge = <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#string" id="ref-for-string②③">sf-string</a></pre>
   
The semantics of the item are defined in
<a href="#challenge-structured-header-serialization">§ 9.2.1 `Secure-Session-Challenge` structured header serialization</a>.
   <p></p>
   <p>The processing steps are defined in <a href="#algo-process-challenge">§ 8.7 Cache challenge</a>.</p>
   <h4 class="heading settled" data-level="9.2.1" id="challenge-structured-header-serialization"><span class="secno">9.2.1. </span><span class="content">`<code><a data-link-type="http-header" href="#secure-session-challenge-header" id="ref-for-secure-session-challenge-header②">Secure-Session-Challenge</a></code>` structured header serialization</span><a class="self-link" href="#challenge-structured-header-serialization"></a></h4>
   
The `<code><a data-link-type="http-header" href="#secure-session-challenge-header" id="ref-for-secure-session-challenge-header③">Secure-Session-Challenge</a></code>` is represented as a Structured Field.<a data-link-type="biblio" href="#biblio-rfc9651" title="Structured Field Values for HTTP">[RFC9651]</a>


   <p>In this representation, a challenge is represented by a string.</p>
   <p>Challenges MUST have an <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#name-parameters" id="ref-for-name-parameters⑨">sf-parameter</a> named <code>"id"</code>, whose value MUST be a string
representing a <a data-link-type="dfn" href="#device-bound-session-session-identifier" id="ref-for-device-bound-session-session-identifier⑤">session identifier</a>. Any other
<a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#name-parameters" id="ref-for-name-parameters①⓪">sf-parameter</a>s SHOULD be ignored.</p>
   <div class="example" id="secure-session-challenge-example">
    <a class="self-link" href="#secure-session-challenge-example"></a>
  Some examples of `<code><a data-link-type="http-header" href="#secure-session-challenge-header" id="ref-for-secure-session-challenge-header④">Secure-Session-Challenge</a></code>` from
  https://example.com/login.html:

  
<pre class="highlight language-html">HTTP/1.1 403 Forbidden
Secure-Session-Challenge: "new challenge";id="my session"
</pre>
<pre class="highlight language-html">HTTP/1.1 200 OK
Secure-Session-Challenge: "new challenge";id="my session"
</pre>
<pre class="highlight language-html">HTTP/1.1 200 OK
Secure-Session-Challenge: "new challenge";id="my session 1"
Secure-Session-Challenge: "another challenge";id="my session 2"
</pre>
<pre class="highlight language-html">HTTP/1.1 200 OK
Secure-Session-Challenge: "c1";id="session 1", "c2";id="session 2"
</pre>
   </div>
   <h3 class="heading settled" data-level="9.3" id="header-secure-session-response"><span class="secno">9.3. </span><span class="content">`<code><a data-link-type="http-header" href="#secure-session-response-header" id="ref-for-secure-session-response-header②">Secure-Session-Response</a></code>` HTTP header field</span><a class="self-link" href="#header-secure-session-response"></a></h3>
   
The <dfn class="dfn-paneled" data-dfn-type="http-header" data-export data-lt="Secure-Session-Response" id="secure-session-response-header">
<code>Secure-Session-Response</code></dfn> header field can be used in the
<a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request⑥">request</a> by the user agent to send a <a data-link-type="dfn" href="#dbsc-proof" id="ref-for-dbsc-proof④">DBSC proof</a> to the server to prove
that the client is still in possession of the private key of the session key
pair.


   <p><a data-link-type="http-header" href="#secure-session-response-header" id="ref-for-secure-session-response-header③"><code>Secure-Session-Response</code></a> is a structured
header. Its value must be a string. Its ABNF is:</p>
<pre class="abnf">SecureSessionResponse = <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#string" id="ref-for-string②④">sf-string</a></pre>
   <p>This string MUST only contain the <a data-link-type="dfn" href="#dbsc-proof" id="ref-for-dbsc-proof⑤">DBSC proof</a> JWT. Any <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#name-parameters" id="ref-for-name-parameters①①">sf-parameter</a>s SHOULD be
ignored.</p>
   <div class="example" id="secure-session-response-example">
    <a class="self-link" href="#secure-session-response-example"></a>
  
<pre class="highlight language-html">POST example.com/refresh
Secure-Session-Response: "eyJhbGciOiJFUzI1NiIsInR5cCI6ImRic2Mrand0In0.eyJhdWQiOiJodHRwczovL2V4YW1wbGUuY29tL3JlZyIsImp0aSI6ImN2IiwiaWF0IjoiMTcyNTU3OTA1NSIsImp3ayI6eyJrdHkiOiJFQyIsImNydiI6IlAtMjU2IiwieCI6IjZfR0Iydm9RMHFyb01oNk9sREZDRlNfU0pyaVFpMVBUdnZCT2hHWjNiSEkiLCJ5IjoiSWVnT0pVTHlFN1N4SF9DZDFLQ0VSN2xXQnZHRkhRLWgweHlqelVqRUlXRSJ9LCJhdXRob3JpemF0aW9uIjoiYWMifQ.6Fb_vVBDmfNghQiBmIGe8o7tBfYPbPCywhQruP0vIhxgmcJmuNTaMHeVn_M8ZnOm1_bzIitbZqCWEn-1Qzmtyw"
</pre>
   </div>
   <h3 class="heading settled" data-level="9.4" id="header-sec-secure-session-id"><span class="secno">9.4. </span><span class="content">`<code><a data-link-type="http-header" href="#sec-secure-session-id-header" id="ref-for-sec-secure-session-id-header①">Sec-Secure-Session-Id</a></code>` HTTP header field</span><a class="self-link" href="#header-sec-secure-session-id"></a></h3>
   
The <dfn class="dfn-paneled" data-dfn-type="http-header" data-export data-lt="Sec-Secure-Session-Id" id="sec-secure-session-id-header">
<code>Sec-Secure-Session-Id</code></dfn> header field can be used in the
<a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request⑦">request</a> by the user agent to request the current session be refreshed,
with the current session identifier as a string argument.


   <p>`<code><a data-link-type="http-header" href="#sec-secure-session-id-header" id="ref-for-sec-secure-session-id-header②">Sec-Secure-Session-Id</a></code>` is a structured header.
Its value must be a string. Its ABNF is:</p>
<pre class="abnf">SecSecureSessionId = <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#string" id="ref-for-string②⑤">sf-string</a></pre>
   <p>This string MUST only contain the session identifier. Any parameters SHOULD be
ignored.</p>
   <div class="example" id="sec-secure-session-id-example">
    <a class="self-link" href="#sec-secure-session-id-example"></a>
  
<pre class="highlight language-html">POST example.com/refresh
Sec-Secure-Session-Id: "session-id"
</pre>
   </div>
   <h3 class="heading settled" data-level="9.5" id="header-secure-session-skipped"><span class="secno">9.5. </span><span class="content">`<code><a data-link-type="http-header" href="#secure-session-skipped-header" id="ref-for-secure-session-skipped-header">Secure-Session-Skipped</a></code>` HTTP header field</span><a class="self-link" href="#header-secure-session-skipped"></a></h3>
   
The <dfn class="dfn-paneled" data-dfn-type="http-header" data-export data-lt="Secure-Session-Skipped" id="secure-session-skipped-header">
<code>Secure-Session-Skipped</code></dfn> header field can be used in a
<a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request⑧">request</a> to indicate that the request is intentionally missing bound
credentials due to user agent policy.


   <p>`<code><a data-link-type="http-header" href="#secure-session-skipped-header" id="ref-for-secure-session-skipped-header①">Secure-Session-Skipped</a></code>` is a List Structured Header <a data-link-type="biblio" href="#biblio-rfc9651" title="Structured Field Values for HTTP">[RFC9651]</a>. Its ABNF
is:</p>
<pre class="abnf">SecureSessionSkipped = <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#list" id="ref-for-list⑦">sf-list</a></pre>
   <p>Each item in the list MUST be an <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#token" id="ref-for-token④">sf-token</a> representing a
coarse-grained reason for skipping cookie refresh. The only supported
values are: "unreachable", "server_error", and "quota_exceeded". These
tokens should be used in the following situations:</p>
   <ul>
    <li data-md>
     <p>"server_error" indicates that the session refresh failed due to the
response from the server (e.g. a 500 status code).</p>
    <li data-md>
     <p>"unreachable" indicates that the session refresh failed due to an
inability to reach the server.</p>
    <li data-md>
     <p>"quota_exceeded" covers all places where the user agent chooses not to
refresh (e.g. excessive recent TPM operations).</p>
   </ul>
   <p>One <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#name-parameters" id="ref-for-name-parameters①②">sf-parameter</a> is defined:</p>
   <ul>
    <li data-md>
     <p>An <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#name-parameters" id="ref-for-name-parameters①③">sf-parameter</a> whose key is "session_identifier", and whose value is an
<a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#string" id="ref-for-string②⑥">sf-string</a>, conveying the identifier of the skipped session.</p>
   </ul>
   <div class="example" id="secure-session-skipped-example">
    <a class="self-link" href="#secure-session-skipped-example"></a>
  
<pre class="highlight language-html">GET example.com/requires_bound_cookie
Secure-Session-Skipped: unreachable;session_identifier="123", quota_exceeded;session_identifier="456"
</pre>
   </div>
   <h3 class="heading settled" data-level="9.6" id="format-session-instructions"><span class="secno">9.6. </span><span class="content">JSON Session Instruction Format</span><a class="self-link" href="#format-session-instructions"></a></h3>
   
The server sends <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="json-session-instructions">JSON session instructions</dfn> during session
registration and optionally during session refresh. If the response
contains session instructions, it MUST be in JSON format.


   <p>At the root of the JSON object, the following keys can exist:</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="JSON session instructions" data-dfn-type="dfn" data-noexport id="json-session-instructions-session_identifier">session_identifier</dfn>
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string②⑦">string</a> representing a <a data-link-type="dfn" href="#device-bound-session-session-identifier" id="ref-for-device-bound-session-session-identifier⑥">session identifier</a>.
During registration, this is the identifier for the newly created
session. This key MUST be present, except when the value of the <a data-link-type="dfn" href="#json-session-instructions-continue" id="ref-for-json-session-instructions-continue①">continue</a>
key is false.  During refresh, this MUST be the identifier for the current
session. See <a href="#algo-create-session">§ 8.9 Create session</a>.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="JSON session instructions" data-dfn-type="dfn" data-noexport id="json-session-instructions-refresh_url">refresh_url</dfn>
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string②⑧">string</a> representing the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url①⓪">URL</a> used for future refresh requests.
This can be a full <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url①①">URL</a>, or it can be relative to the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request⑨">request</a> serving
these instructions. This key is OPTIONAL; if not present, the <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request①⓪">request</a>
<a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url④">url</a> will be used for future refresh requests.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="JSON session instructions" data-dfn-type="dfn" data-noexport id="json-session-instructions-continue">continue</dfn>
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#boolean" id="ref-for-boolean②">boolean</a> indicating if the session should continue to apply.
Registration and refresh endpoints can set this to false to terminate a session.
This key is OPTIONAL; if not present, the default value will be true.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="JSON session instructions" data-dfn-type="dfn" data-noexport id="json-session-instructions-scope">scope</dfn>
    <dd data-md>
     <p>a <a data-link-type="dfn" href="#json-session-scope" id="ref-for-json-session-scope">JSON session scope</a> describing the resources covered by the
session. This key MUST be present, except when the value of the <a data-link-type="dfn" href="#json-session-instructions-continue" id="ref-for-json-session-instructions-continue②">continue</a>
key is false.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="JSON session instructions" data-dfn-type="dfn" data-noexport id="json-session-instructions-credentials">credentials</dfn>
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑧">list</a> of <a data-link-type="dfn" href="#json-session-credential" id="ref-for-json-session-credential②">JSON session credentials</a> describing the cookies protected
by this session. This key MUST be present, except when the value of the
<a data-link-type="dfn" href="#json-session-instructions-continue" id="ref-for-json-session-instructions-continue③">continue</a> key is false.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="JSON session instructions" data-dfn-type="dfn" data-noexport id="json-session-instructions-allowed_refresh_initiators">allowed_refresh_initiators</dfn>
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list⑨">list</a> of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string②⑨">strings</a> describing which out-of-scope hosts are allowed
to initiate DBSC refreshes. Out-of-scope is defined based on the scope’s
origin and include_site values. See <a href="#algo-request-allows-refresh">§ 8.3 Identify if a request is allowed to refresh</a> for
details. This key is OPTIONAL; if not present, the default value will be an
empty list.</p>
   </dl>
   <div class="example" id="secure-session-instruction-example">
    <a class="self-link" href="#secure-session-instruction-example"></a>
  
<pre class="highlight language-json"><c- p>{</c->
  <c- f>"session_identifier"</c-><c- p>:</c-> <c- u>"session_id"</c-><c- p>,</c->
  <c- f>"refresh_url"</c-><c- p>:</c-> <c- u>"/RefreshEndpoint"</c-><c- p>,</c->

  <c- f>"continue"</c-><c- p>:</c-> <c- kc>false</c-><c- p>,</c->

  <c- f>"scope"</c-><c- p>:</c-> <c- p>{</c->
    <c- c1>// Origin-scoped by default (i.e. https://example.com)</c->
    <c- f>"origin"</c-><c- p>:</c-> <c- u>"https://example.com"</c-><c- p>,</c->
    <c- c1>// Specifies to include https://*.example.com except excluded subdomains.</c->
    <c- c1>// This can only be true if the origin's host is the root eTLD+1.</c->
    <c- f>"include_site"</c-><c- p>:</c-> <c- kc>true</c-><c- p>,</c->

    <c- f>"scope_specification"</c-> <c- p>:</c-> <c- p>[</c->
      <c- p>{</c-> <c- f>"type"</c-><c- p>:</c-> <c- u>"include"</c-><c- p>,</c-> <c- f>"domain"</c-><c- p>:</c-> <c- u>"trusted.example.com"</c-><c- p>,</c-> <c- f>"path"</c-><c- p>:</c-> <c- u>"/only_trusted_path"</c-> <c- p>},</c->
      <c- p>{</c-> <c- f>"type"</c-><c- p>:</c-> <c- u>"exclude"</c-><c- p>,</c-> <c- f>"domain"</c-><c- p>:</c-> <c- u>"untrusted.example.com"</c-><c- p>,</c-> <c- f>"path"</c-><c- p>:</c-> <c- u>"/"</c-> <c- p>},</c->
      <c- p>{</c-> <c- f>"type"</c-><c- p>:</c-> <c- u>"exclude"</c-><c- p>,</c-> <c- f>"domain"</c-><c- p>:</c-> <c- u>"*.example.com"</c-><c- p>,</c-> <c- f>"path"</c-><c- p>:</c-> <c- u>"/static"</c-> <c- p>}</c->
    <c- p>]</c->
  <c- p>},</c->

  <c- f>"credentials"</c-><c- p>:</c-> <c- p>[{</c->
    <c- f>"type"</c-><c- p>:</c-> <c- u>"cookie"</c-><c- p>,</c->
    <c- c1>// This specifies the exact cookie that this config applies to. Attributes</c->
    <c- c1>// match the cookie attributes in RFC 6265bis and are parsed similarly to</c->
    <c- c1>// a normal Set-Cookie line, using the same default values.</c->
    <c- f>"name"</c-><c- p>:</c-> <c- u>"auth_cookie"</c-><c- p>,</c->
    <c- f>"attributes"</c-><c- p>:</c-> <c- u>"Domain=example.com; Path=/; Secure; HttpOnly; SameSite=None"</c->
    <c- c1>// Attributes Max-Age and Expires will not contribute to whether a request</c->
    <c- c1>// cookie satisfies this credential.</c->
  <c- p>}],</c->
    
  <c- f>"allowed_refresh_initiators"</c-><c- p>:</c-> <c- p>[</c->
    <c- u>"example.com"</c-><c- p>,</c-> 
    <c- u>"*.example.com"</c-><c- p>,</c->
    <c- u>"site-embedding-example.com"</c->
  <c- p>]</c->
<c- p>}</c->
</pre>
   </div>
   <h3 class="heading settled" data-level="9.7" id="format-session-scope-instructions"><span class="secno">9.7. </span><span class="content">JSON Session Scope Instruction Format</span><a class="self-link" href="#format-session-scope-instructions"></a></h3>
   
The server sends a <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="json-session-scope">JSON session scope</dfn> in the <a data-link-type="dfn" href="#json-session-instructions" id="ref-for-json-session-instructions①">JSON session instructions</a> during registration and optionally during session refresh.


   <p>At the root of the JSON object, the following keys can exist:</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="JSON session scope" data-dfn-type="dfn" data-noexport id="json-session-scope-origin">origin</dfn>
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string③⓪">string</a> indicating the origin or site that the session applies to.
This key is OPTIONAL; if not present, the origin of the URL serving the
instructions will be used. This is the registration URL during registration
and the refresh URL during refresh.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="JSON session scope" data-dfn-type="dfn" data-noexport id="json-session-scope-include_site">include_site</dfn>
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#boolean" id="ref-for-boolean③">boolean</a> indicating if the session is origin-scoped (false) or
site-scoped (true). This key MUST be present. Note that this takes precedence
over any <a data-link-type="dfn" href="#json-session-scope-rule" id="ref-for-json-session-scope-rule">JSON session scope rules</a> in the "scope_specification" (see
<a href="#algo-url-in-scope">§ 8.2 Identify if a URL is in scope of a session</a>).</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="JSON session scope" data-dfn-type="dfn" data-noexport id="json-session-scope-scope_specification">scope_specification</dfn>
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①⓪">list</a> of <a data-link-type="dfn" href="#json-session-scope-rule" id="ref-for-json-session-scope-rule①">JSON session scope rules</a> describing modifications to the
default scope (the entire origin or site). This key is OPTIONAL; if not
present, an empty list will be used.</p>
   </dl>
   <h3 class="heading settled" data-level="9.8" id="format-session-scope-rule"><span class="secno">9.8. </span><span class="content">JSON Session Scope Rule Format</span><a class="self-link" href="#format-session-scope-rule"></a></h3>
   
The server sends a list of <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="json-session-scope-rule">JSON session scope rule</dfn> objects in the
<a data-link-type="dfn" href="#json-session-scope" id="ref-for-json-session-scope①">JSON session scope</a> during registration and optionally during session
refresh.


   <p>At the root of each <a data-link-type="dfn" href="#json-session-scope-rule" id="ref-for-json-session-scope-rule②">JSON session scope rule</a>, the following keys can exist:</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="JSON session scope rule" data-dfn-type="dfn" data-noexport id="json-session-scope-rule-type">type</dfn>
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string③①">string</a> indicating whether the rule includes or excludes destinations.
This key MUST be present, and the value MUST be "include" or "exclude".</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="JSON session scope rule" data-dfn-type="dfn" data-noexport id="json-session-scope-rule-domain">domain</dfn>
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string③②">string</a> indicating the domains that should match the rule. This can
include wildcards (see <a href="#algo-url-in-scope">§ 8.2 Identify if a URL is in scope of a session</a>). This key is OPTIONAL; if
not present, it will be '*', matching all domains.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="JSON session scope rule" data-dfn-type="dfn" data-noexport id="json-session-scope-rule-path">path</dfn>
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string③③">string</a> indicating the path-prefixes that should match the rule. This
key is OPTIONAL; if not present, it will be '/', matching all paths. See
<a href="#algo-url-in-scope">§ 8.2 Identify if a URL is in scope of a session</a> for the detailed semantics.</p>
   </dl>
   <h3 class="heading settled" data-level="9.9" id="format-session-credentials"><span class="secno">9.9. </span><span class="content">JSON Session Credentials Format</span><a class="self-link" href="#format-session-credentials"></a></h3>
   
The server sends a list of <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="json-session-credential">JSON session credential</dfn> objects in the
<a data-link-type="dfn" href="#json-session-instructions" id="ref-for-json-session-instructions②">JSON session instructions</a> during registration and optionally during session
refresh.


   <p>At the root of the JSON object, the following keys can exist:</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="JSON session credential" data-dfn-type="dfn" data-noexport id="json-session-credential-type">type</dfn>
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string③④">string</a> indicating the kind of credential protected by this session.
This key MUST be present, and the value MUST be "cookie".</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="JSON session credential" data-dfn-type="dfn" data-noexport id="json-session-credential-name">name</dfn>
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string③⑤">string</a> indicating the name of the bound cookie. This key MUST be
present, and the value MUST be nonempty.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-for="JSON session credential" data-dfn-type="dfn" data-noexport id="json-session-credential-attributes">attributes</dfn>
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string③⑥">string</a> containing the expected attributes of the protected cookie.
See <a href="#algo-identify-if-missing-session-credential">§ 8.6 Identify if missing session credential</a> for details on how this
is used. This key is OPTIONAL; if not present, it will be the empty string.</p>
   </dl>
   <h3 class="heading settled" data-level="9.10" id="format-jwt"><span class="secno">9.10. </span><span class="content">DBSC Proof JWT Syntax</span><a class="self-link" href="#format-jwt"></a></h3>
   
A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="dbsc-proof">DBSC proof</dfn> proof is a JWT that is signed (using JSON Web Signature
(JWS)), with a private key chosen by the client.


   <p>The header of a <a data-link-type="dfn" href="#dbsc-proof" id="ref-for-dbsc-proof⑥">DBSC proof</a> MUST contain at least the following <a data-link-type="dfn" href="https://datatracker.ietf.org/doc/html/rfc9651#name-parameters" id="ref-for-name-parameters①④">sf-parameter</a>s:</p>
   <dl>
    <dt data-md>typ
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string③⑦">string</a>. This MUST be "dbsc+jwt".</p>
    <dt data-md>alg
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string③⑧">string</a> defining the algorithm used to sign this JWT. It MUST be
"RS256", "ES256", or "none" from [IANA.JOSE.ALGS].</p>
    <dt data-md>jwk
    <dd data-md>
     <p>a JWK as specified in <a data-link-type="biblio" href="#biblio-rfc7517" title="JSON Web Key (JWK)">[RFC7517]</a>. This MUST be present for
registration requests, and MUST not be present for refresh requests.</p>
   </dl>
   <p>The payload of <a data-link-type="dfn" href="#dbsc-proof" id="ref-for-dbsc-proof⑦">DBSC proof</a> MUST contain at least the following claims:</p>
   <dl>
    <dt data-md>jti
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string③⑨">string</a>. This is a copy of the challenge value sent in the registration
header.</p>
   </dl>
   <p>In addition, the following claim MUST be present if present in the
`<code><a data-link-type="http-header" href="#secure-session-registration-header" id="ref-for-secure-session-registration-header⑨">Secure-Session-Registration</a></code>` header field:</p>
   <dl>
    <dt data-md>authorization
    <dd data-md>
     <p>a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string④⓪">string</a>. This is a direct copy of the string from the
`<code><a data-link-type="http-header" href="#secure-session-registration-header" id="ref-for-secure-session-registration-header①⓪">Secure-Session-Registration</a></code>` header field if set there. Note that this
string is OPTIONAL to include in the header, but if it is present, the
client MUST add it to the claim in the <a data-link-type="dfn" href="#dbsc-proof" id="ref-for-dbsc-proof⑧">DBSC proof</a>.</p>
   </dl>
   <div class="example" id="dbsc-proof-example">
    <a class="self-link" href="#dbsc-proof-example"></a>
  An example <a data-link-type="dfn" href="#dbsc-proof" id="ref-for-dbsc-proof⑨">DBSC proof</a> sent to https://example.com/reg:

  
<pre class="highlight language-json"><c- c1>// Header</c->
<c- p>{</c->
  <c- f>"alg"</c-><c- p>:</c-> <c- u>"ES256"</c-><c- p>,</c->
  <c- f>"typ"</c-><c- p>:</c-> <c- u>"dbsc+jwt"</c-><c- p>,</c->
  <c- f>"jwk"</c-><c- p>:</c-> <c- p>{</c->
    <c- f>"kty"</c-><c- p>:</c-> <c- u>"EC"</c-><c- p>,</c->
    <c- f>"crv"</c-><c- p>:</c-> <c- u>"P-256"</c-><c- p>,</c->
    <c- f>"x"</c-><c- p>:</c-> <c- u>"6_GB2voQ0qroMh6OlDFCFS_SJriQi1PTvvBOhGZ3bHI"</c-><c- p>,</c->
    <c- f>"y"</c-><c- p>:</c-> <c- u>"IegOJULyE7SxH_Cd1KCER7lWBvGFHQ-h0xyjzUjEIWE"</c->
  <c- p>}</c->
<c- p>}</c->
<c- c1>// Payload</c->
<c- p>{</c->
  <c- f>"jti"</c-><c- p>:</c-> <c- u>"cv"</c-><c- p>,</c->
  <c- f>"authorization"</c-><c- p>:</c-> <c- u>"ac"</c->
<c- p>}</c->
</pre>
    <p>Based on a response to <code>http://example.com/page.html</code> having this
  response header from the server:</p>
<pre class="highlight language-html">HTTP/1.1 200 OK
Secure-Session-Registration: (ES256);path="reg";challenge="cv";authorization="ac"
</pre>
   </div>
   <h2 class="heading settled" data-level="10" id="changes-to-other-specifications"><span class="secno">10. </span><span class="content">Changes to other specifications</span><a class="self-link" href="#changes-to-other-specifications"></a></h2>
   <h3 class="heading settled" data-level="10.1" id="changes-to-fetch"><span class="secno">10.1. </span><span class="content">Changes to the Fetch specification</span><a class="self-link" href="#changes-to-fetch"></a></h3>
   <p>This specification requires an update to the <a href="https://fetch.spec.whatwg.org/#http-network-or-cache-fetch">HTTP-network-or-cache
fetch</a> algorithm. A <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request①①">request</a> has a <dfn class="dfn-paneled" data-dfn-for="request" data-dfn-type="dfn" data-lt="deferred device bound session ids" data-noexport id="request-deferred-device-bound-session-ids">deferred device
bound session ids</dfn>, a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list①①">list</a> of <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#tuple" id="ref-for-tuple①">tuples</a> consisting of:</p>
   <ul>
    <li data-md>
     <p>a domain (a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#host-registrable-domain" id="ref-for-host-registrable-domain①②">registrable domain</a>).</p>
    <li data-md>
     <p>a session identifier (a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#string" id="ref-for-string④①">string</a>).</p>
   </ul>
   This list is initially empty.


   <p>After computing cookies in step 8.21, run
<a href="#algo-identify-session-needing-refresh">§ 8.5 Identify session needing refresh</a>. If the resulting
<var>session</var> is non-null:</p>
   <ol>
    <li data-md>
     <p>Run <a href="#algo-session-request">§ 8.8 Send request</a> with <var>httpRequest</var>, the
returned <var>session</var>’s <a data-link-type="dfn" href="#device-bound-session-session-key-pair" id="ref-for-device-bound-session-session-key-pair④">session key pair</a>, <a data-link-type="dfn" href="#device-bound-session-refresh-url" id="ref-for-device-bound-session-refresh-url②">refresh URL</a>, <a data-link-type="dfn" href="#device-bound-session-session-identifier" id="ref-for-device-bound-session-session-identifier⑦">session identifier</a>, <a data-link-type="dfn" href="#device-bound-session-cached-challenge" id="ref-for-device-bound-session-cached-challenge③">cached challenge</a>, and an empty
authorization.</p>
    <li data-md>
     <p>Restart <a href="https://fetch.spec.whatwg.org/#http-network-or-cache-fetch">HTTP-network-or-cache
fetch</a> with the original inputs.</p>
   </ol>
   <p>This specification also requires two new calls to process the new
headers. After step 14 in the current <a href="https://fetch.spec.whatwg.org/#http-network-fetch">HTTP-network 
fetch</a>, execute the following step:</p>
   <ol start="15">
    <li data-md>
     <p>Run <a href="#algo-process-session-registration">§ 8.10 Process session registration</a> and <a href="#algo-process-challenge">§ 8.7 Cache challenge</a>.</p>
   </ol>
   <h3 class="heading settled" data-level="10.2" id="changes-to-clear-site-data"><span class="secno">10.2. </span><span class="content">Changes to the Clear Site Data specification</span><a class="self-link" href="#changes-to-clear-site-data"></a></h3>
   <p>This specification requires that the Clear Site Data specification section 4.2.5
<a href="https://www.w3.org/TR/clear-site-data/#clear-dom">Clear DOM-accessible
storage for origin</a> clear all device bound sessions whose scope matches
origin. It also requires an update to <a href="https://www.w3.org/TR/clear-site-data/#clear-cookies">section 4.2.4</a> to
clear device bound sessions for the site matching the registered domain.</p>
   <h2 class="heading settled" data-level="11" id="iana-considerations"><span class="secno">11. </span><span class="content">IANA Considerations</span><a class="self-link" href="#iana-considerations"></a></h2>
   <p>The permanent message header field registry should be updated with the following
registrations: <a data-link-type="biblio" href="#biblio-rfc3864" title="Registration Procedures for Message Header Fields">[RFC3864]</a></p>
   <h3 class="heading settled" data-level="11.1" id="iana-ses-session-challenge"><span class="secno">11.1. </span><span class="content">Secure-Session-Challenge</span><a class="self-link" href="#iana-ses-session-challenge"></a></h3>
   <dl>
    <dt>Header field name
    <dd>Secure-Session-Challenge
    <dt>Applicable protocol
    <dd>http
    <dt>Status
    <dd>draft
    <dt>Author/Change controller
    <dd>W3C
    <dt>Specification document
    <dd>This specification (See <a href="#header-secure-session-challenge">§ 9.2 `Secure-Session-Challenge` HTTP header field</a>)
   </dl>
   <h3 class="heading settled" data-level="11.2" id="iana-sec-secure-session-id"><span class="secno">11.2. </span><span class="content">Sec-Secure-Session-Id</span><a class="self-link" href="#iana-sec-secure-session-id"></a></h3>
   <dl>
    <dt>Header field name
    <dd>Sec-Secure-Session-Id
    <dt>Applicable protocol
    <dd>http
    <dt>Status
    <dd>draft
    <dt>Author/Change controller
    <dd>W3C
    <dt>Specification document
    <dd>This specification (See <a href="#header-sec-secure-session-id">§ 9.4 `Sec-Secure-Session-Id` HTTP header field</a>)
   </dl>
   <h3 class="heading settled" data-level="11.3" id="iana-secure-session-registration"><span class="secno">11.3. </span><span class="content">Secure-Session-Registration</span><a class="self-link" href="#iana-secure-session-registration"></a></h3>
   <dl>
    <dt>Header field name
    <dd>Secure-Session-Registration
    <dt>Applicable protocol
    <dd>http
    <dt>Status
    <dd>draft
    <dt>Author/Change controller
    <dd>W3C
    <dt>Specification document
    <dd>This specification (See <a href="#header-secure-session-registration">§ 9.1 `Secure-Session-Registration` HTTP header field</a>)
   </dl>
   <h3 class="heading settled" data-level="11.4" id="iana-secure-session-response"><span class="secno">11.4. </span><span class="content">Secure-Session-Response</span><a class="self-link" href="#iana-secure-session-response"></a></h3>
   <dl>
    <dt>Header field name
    <dd>Secure-Session-Response
    <dt>Applicable protocol
    <dd>http
    <dt>Status
    <dd>draft
    <dt>Author/Change controller
    <dd>W3C
    <dt>Specification document
    <dd>This specification (See <a href="#header-secure-session-response">§ 9.3 `Secure-Session-Response` HTTP header field</a>)
   </dl>
   <h3 class="heading settled" data-level="11.5" id="iana-secure-session-skipped"><span class="secno">11.5. </span><span class="content">Secure-Session-Skipped</span><a class="self-link" href="#iana-secure-session-skipped"></a></h3>
   <dl>
    <dt>Header field name
    <dd>Secure-Session-Skipped
    <dt>Applicable protocol
    <dd>http
    <dt>Status
    <dd>draft
    <dt>Author/Change controller
    <dd>W3C
    <dt>Specification document
    <dd>This specification (See <a href="#header-secure-session-skipped">§ 9.5 `Secure-Session-Skipped` HTTP header field</a>)
   </dl>
   <h3 class="heading settled" data-level="11.6" id="well-known"><span class="secno">11.6. </span><span class="content">device-bound-sessions Well Known</span><a class="self-link" href="#well-known"></a></h3>
   <p>The Well-Known URI registry should be updated to include
/.well-known/device-bound-sessions.</p>
   <p>This endpoint must serve a JSON-encoded dictionary. Three keys are defined:</p>
   <ul>
    <li data-md>
     <p>"registering_origins" is a list of strings. It contains origins that
are allowed to register sessions for an entire site.</p>
    <li data-md>
     <p>"relying_origins" is a list of strings. It contains origins that are
allowed to be the Relying Party (RP) when sharing keys with this
site’s sessions.</p>
    <li data-md>
     <p>"provider_origin" is an optional string. It contains the origin of the Session
Provider when this origin is being used as a Relying Party.</p>
   </ul>
   <div class="example" id="example-1b5d4b91">
    <a class="self-link" href="#example-1b5d4b91"></a>
  If <code>https://example.com/.well-known/device-bound-sessions</code> serves
  
<pre class="highlight language-json"><c- p>{</c->
  <c- f>"registering_origins"</c-><c- p>:</c-> <c- p>[</c->
    <c- u>"https://subdomain.example.com"</c-><c- p>,</c->
    <c- u>"https://subdomain.example.com:8000"</c-><c- p>,</c->
  <c- p>],</c->
  <c- f>"relying_origins"</c-><c- p>:</c-> <c- p>[</c->
    <c- u>"https://example.co.uk"</c-><c- p>,</c->
    <c- u>"https://example-partner.com"</c-><c- p>,</c->
  <c- p>],</c->
<c- p>}</c->
</pre>
    <p>Then registration requests can define a site-scoped session only if
  one of the following is true:</p>
    <ul>
     <li data-md>
      <p>The registration endpoint has host <code>example.com</code></p>
     <li data-md>
      <p>The registration endpoint has origin <code>https://subdomain.example.com</code></p>
     <li data-md>
      <p>The registration endpoint has origin <code>https://subdomain.example.com:8000</code></p>
    </ul>
    <p>In addition, <code>https://example.co.uk</code> and <code>https://example-partner.com</code>
  are allowed to share keys with sessions on <code>https://example.com</code>,
  enabling those sites to achieve both federated login and DBSC
  protection. To do this, both sites must serve the following entry in their
  <code>.well-known</code> files:</p>
<pre class="highlight language-json"><c- p>{</c->
  <c- f>"provider_origin"</c-><c- p>:</c-> <c- u>"https://example.com/"</c->
<c- p>}</c->
</pre>
   </div>
   <h2 class="heading settled" data-level="12" id="changelog"><span class="secno">12. </span><span class="content">Changelog</span><a class="self-link" href="#changelog"></a></h2>
   
This is an early draft of the spec.


   <h2 class="heading settled" data-level="13" id="acknowledgements"><span class="secno">13. </span><span class="content">Acknowledgements</span><a class="self-link" href="#acknowledgements"></a></h2>
  </main>
  <div data-fill-with="conformance">
   <h2 class="heading no-num no-ref settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="heading no-num no-ref settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification.

    </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a>

    </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this:

    </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a>
        
    <p>This is an example of an informative example.
    </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this:

    </p>
   <p class="note" role="note">Note, this is an informative note.</p>
   <section>
    <h3 class="heading no-num no-ref settled" id="w3c-conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
    <p>Requirements phrased in the imperative as part of algorithms
    (such as "strip any leading space characters"
    or "return false and abort these steps")
    are to be interpreted with the meaning of the key word
    ("must", "should", "may", etc)
    used in introducing the algorithm.

    </p>
    <p>Conformance requirements phrased as algorithms or specific steps
    can be implemented in any manner,
    so long as the end result is equivalent.
    In particular, the algorithms defined in this specification
    are intended to be easy to understand
    and are not intended to be performant.
    Implementers are encouraged to optimize.
</p>
   </section>
  </div>
  <script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="heading no-num no-ref settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="heading no-num no-ref settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#add-debug-header">add the debug header</a><span>, in § 8.12</span>
   <li><a href="#device-bound-session-allowed-refresh-initiators">allowed refresh initiators</a><span>, in § 7.3</span>
   <li><a href="#json-session-instructions-allowed_refresh_initiators">allowed_refresh_initiators</a><span>, in § 9.6</span>
   <li>
    attributes
    <ul>
     <li><a href="#json-session-credential-attributes">dfn for JSON session credential</a><span>, in § 9.9</span>
     <li><a href="#session-credential-attributes">dfn for session credential</a><span>, in § 7.6</span>
    </ul>
   <li><a href="#device-bound-session-cached-challenge">cached challenge</a><span>, in § 7.3</span>
   <li><a href="#json-session-instructions-continue">continue</a><span>, in § 9.6</span>
   <li><a href="#create-session">create a session</a><span>, in § 8.9</span>
   <li><a href="#create-session-key-pair">create a session key pair</a><span>, in § 8.11</span>
   <li><a href="#json-session-instructions-credentials">credentials</a><span>, in § 9.6</span>
   <li><a href="#dbsc-proof">DBSC proof</a><span>, in § 9.10</span>
   <li><a href="#request-deferred-device-bound-session-ids">deferred device bound session ids</a><span>, in § 10.1</span>
   <li><a href="#algorithms-determine-if-a-host-matches-a-pattern">determine if a host matches a pattern</a><span>, in § 8.4</span>
   <li><a href="#algorithms-determine-if-a-request-is-allowed-to-trigger-refresh">determine if a request is allowed to trigger refresh</a><span>, in § 8.3</span>
   <li><a href="#algorithms-determine-if-a-url-is-in-scope">determine if a URL is in scope</a><span>, in § 8.2</span>
   <li><a href="#device-bound-session">device bound session</a><span>, in § 7.3</span>
   <li>
    domain
    <ul>
     <li><a href="#json-session-scope-rule-domain">dfn for JSON session scope rule</a><span>, in § 9.8</span>
     <li><a href="#scope-specification-domain">dfn for scope specification</a><span>, in § 7.5</span>
    </ul>
   <li><a href="#device-bound-session-expiration-timestamp">expiration timestamp</a><span>, in § 7.3</span>
   <li><a href="#algorithms-identify-a-session">identify a session</a><span>, in § 8.1</span>
   <li><a href="#algorithms-identify-a-session-needing-refresh">identify a session needing refresh</a><span>, in § 8.5</span>
   <li><a href="#algorithms-identify-if-a-request-is-missing-a-session-credential">identify if a request is missing a session credential</a><span>, in § 8.6</span>
   <li><a href="#session-scope-include-site">include site</a><span>, in § 7.4</span>
   <li><a href="#json-session-scope-include_site">include_site</a><span>, in § 9.7</span>
   <li><a href="#json-session-credential">JSON session credential</a><span>, in § 9.9</span>
   <li><a href="#json-session-instructions">JSON session instructions</a><span>, in § 9.6</span>
   <li><a href="#json-session-scope">JSON session scope</a><span>, in § 9.7</span>
   <li><a href="#json-session-scope-rule">JSON session scope rule</a><span>, in § 9.8</span>
   <li>
    name
    <ul>
     <li><a href="#json-session-credential-name">dfn for JSON session credential</a><span>, in § 9.9</span>
     <li><a href="#session-credential-name">dfn for session credential</a><span>, in § 7.6</span>
    </ul>
   <li>
    origin
    <ul>
     <li><a href="#json-session-scope-origin">dfn for JSON session scope</a><span>, in § 9.7</span>
     <li><a href="#session-scope-origin">dfn for session scope</a><span>, in § 7.4</span>
    </ul>
   <li>
    path
    <ul>
     <li><a href="#json-session-scope-rule-path">dfn for JSON session scope rule</a><span>, in § 9.8</span>
     <li><a href="#scope-specification-path">dfn for scope specification</a><span>, in § 7.5</span>
    </ul>
   <li><a href="#algorithms-process-a-challenge">process a challenge</a><span>, in § 8.7</span>
   <li><a href="#process-session-registration">process a session registration</a><span>, in § 8.10</span>
   <li><a href="#device-bound-session-refresh-url">refresh URL</a><span>, in § 7.3</span>
   <li><a href="#json-session-instructions-refresh_url">refresh_url</a><span>, in § 9.6</span>
   <li><a href="#registrable-origin-label">registrable origin label</a><span>, in § 7.7</span>
   <li><a href="#json-session-instructions-scope">scope</a><span>, in § 9.6</span>
   <li><a href="#scope-specification">scope specification</a><span>, in § 7.5</span>
   <li><a href="#json-session-scope-scope_specification">scope_specification</a><span>, in § 9.7</span>
   <li><a href="#session-scope-scope-specifications">scope specifications</a><span>, in § 7.4</span>
   <li><a href="#sec-secure-session-id-header">Sec-Secure-Session-Id</a><span>, in § 9.4</span>
   <li><a href="#secure-session-challenge-header">Secure-Session-Challenge</a><span>, in § 9.2</span>
   <li><a href="#secure-session-registration-header">Secure-Session-Registration</a><span>, in § 9.1</span>
   <li><a href="#secure-session-response-header">Secure-Session-Response</a><span>, in § 9.3</span>
   <li><a href="#secure-session-skipped-header">Secure-Session-Skipped</a><span>, in § 9.5</span>
   <li><a href="#algorithms-send-a-request">send a request</a><span>, in § 8.8</span>
   <li><a href="#session-credential">session credential</a><span>, in § 7.6</span>
   <li><a href="#device-bound-session-session-credentials">session credentials</a><span>, in § 7.3</span>
   <li><a href="#device-bound-session-session-identifier">session identifier</a><span>, in § 7.3</span>
   <li><a href="#json-session-instructions-session_identifier">session_identifier</a><span>, in § 9.6</span>
   <li><a href="#device-bound-session-session-key-pair">session key pair</a><span>, in § 7.3</span>
   <li><a href="#sessions-by-id-map">sessions by id map</a><span>, in § 7.2</span>
   <li>
    session scope
    <ul>
     <li><a href="#session-scope">definition of</a><span>, in § 7.4</span>
     <li><a href="#device-bound-session-session-scope">dfn for device bound session</a><span>, in § 7.3</span>
    </ul>
   <li><a href="#session-store">session store</a><span>, in § 7.1</span>
   <li>
    type
    <ul>
     <li><a href="#json-session-credential-type">dfn for JSON session credential</a><span>, in § 9.9</span>
     <li><a href="#json-session-scope-rule-type">dfn for JSON session scope rule</a><span>, in § 9.8</span>
     <li><a href="#scope-specification-type">dfn for scope specification</a><span>, in § 7.5</span>
    </ul>
  </ul>
  <h3 class="heading no-num no-ref settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a6a8ec88">append</span>
     <li><span class="dfn-paneled" id="81a76425">body</span>
     <li><span class="dfn-paneled" id="902380f7">credentials mode</span>
     <li><span class="dfn-paneled" id="5c66de35">get a structured field value</span>
     <li><span class="dfn-paneled" id="6ee0eab1">header list <small>(for request)</small></span>
     <li><span class="dfn-paneled" id="f7b00a8b">header list <small>(for response)</small></span>
     <li><span class="dfn-paneled" id="1534f1eb">header name</span>
     <li><span class="dfn-paneled" id="fa4ea124">initiator</span>
     <li><span class="dfn-paneled" id="50b05fad">method</span>
     <li><span class="dfn-paneled" id="eb1b1af3">network error</span>
     <li><span class="dfn-paneled" id="f78d5b5c">origin</span>
     <li><span class="dfn-paneled" id="64b62ea0">redirect mode</span>
     <li><span class="dfn-paneled" id="55213b5b">request</span>
     <li><span class="dfn-paneled" id="ee7bba09">response</span>
     <li><span class="dfn-paneled" id="35b98f13">set a structured field value</span>
     <li><span class="dfn-paneled" id="a1d47575">status</span>
     <li><span class="dfn-paneled" id="dc1cd39b">URL <small>(for request)</small></span>
     <li><span class="dfn-paneled" id="3268a8eb">URL <small>(for response)</small></span>
    </ul>
   <li>
    <a data-link-type="biblio">[HR-TIME-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="1e2edd5b">moment</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="77a2ee6e">host</span>
     <li><span class="dfn-paneled" id="086e3aff">origin</span>
     <li><span class="dfn-paneled" id="7393da89">same origin</span>
     <li><span class="dfn-paneled" id="feac4ab3">same site</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="36858240">boolean</span>
     <li><span class="dfn-paneled" id="7b0d918d">break</span>
     <li><span class="dfn-paneled" id="a326add7">contain</span>
     <li><span class="dfn-paneled" id="f937b7b6">continue</span>
     <li><span class="dfn-paneled" id="16d07e10">for each</span>
     <li><span class="dfn-paneled" id="c88f3887">item</span>
     <li><span class="dfn-paneled" id="649608b9">list</span>
     <li><span class="dfn-paneled" id="84b454ff">ordered map</span>
     <li><span class="dfn-paneled" id="0698d556">string</span>
     <li><span class="dfn-paneled" id="984221ca">struct</span>
     <li><span class="dfn-paneled" id="0e8de730">tuple</span>
     <li><span class="dfn-paneled" id="ee469dff">with default</span>
    </ul>
   <li>
    <a data-link-type="biblio">[PERMISSIONS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="2cb28cb0">denied</span>
     <li><span class="dfn-paneled" id="bcc085e3">request permission to use</span>
    </ul>
   <li>
    <a data-link-type="biblio">[RFC9651]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="b6374348">sf-inner-list</span>
     <li><span class="dfn-paneled" id="37e40809">sf-list</span>
     <li><span class="dfn-paneled" id="e25b5dcb">sf-parameter</span>
     <li><span class="dfn-paneled" id="36d8cca0">sf-string</span>
     <li><span class="dfn-paneled" id="86e83811">sf-token</span>
    </ul>
   <li>
    <a data-link-type="biblio">[URL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="22477314">domain</span>
     <li><span class="dfn-paneled" id="eea18c0d">domain label</span>
     <li><span class="dfn-paneled" id="b85ee3be">host</span>
     <li><span class="dfn-paneled" id="959ad97b">origin</span>
     <li><span class="dfn-paneled" id="c0868016">path</span>
     <li><span class="dfn-paneled" id="bd6b32a4">public suffix</span>
     <li><span class="dfn-paneled" id="bc9d7803">registrable domain</span>
     <li><span class="dfn-paneled" id="dcffbccd">URL</span>
    </ul>
  </ul>
  <h2 class="heading no-num no-ref settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="heading no-num no-ref settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-cookies">[COOKIES]
   <dd>A. Barth. <a href="https://httpwg.org/specs/rfc6265.html"><cite>HTTP State Management Mechanism</cite></a>. April 2011. Proposed Standard. URL: <a href="https://httpwg.org/specs/rfc6265.html">https://httpwg.org/specs/rfc6265.html</a>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/"><cite>Fetch Standard</cite></a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-hr-time-3">[HR-TIME-3]
   <dd>Yoav Weiss. <a href="https://w3c.github.io/hr-time/"><cite>High Resolution Time</cite></a>. URL: <a href="https://w3c.github.io/hr-time/">https://w3c.github.io/hr-time/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-permissions">[PERMISSIONS]
   <dd>Marcos Caceres; Mike Taylor. <a href="https://w3c.github.io/permissions/"><cite>Permissions</cite></a>. URL: <a href="https://w3c.github.io/permissions/">https://w3c.github.io/permissions/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-rfc3864">[RFC3864]
   <dd>G. Klyne; M. Nottingham; J. Mogul. <a href="https://www.rfc-editor.org/rfc/rfc3864"><cite>Registration Procedures for Message Header Fields</cite></a>. September 2004. Best Current Practice. URL: <a href="https://www.rfc-editor.org/rfc/rfc3864">https://www.rfc-editor.org/rfc/rfc3864</a>
   <dt id="biblio-rfc4648">[RFC4648]
   <dd>S. Josefsson. <a href="https://www.rfc-editor.org/rfc/rfc4648"><cite>The Base16, Base32, and Base64 Data Encodings</cite></a>. October 2006. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc4648">https://www.rfc-editor.org/rfc/rfc4648</a>
   <dt id="biblio-rfc5234">[RFC5234]
   <dd>D. Crocker, Ed.; P. Overell. <a href="https://www.rfc-editor.org/rfc/rfc5234"><cite>Augmented BNF for Syntax Specifications: ABNF</cite></a>. January 2008. Internet Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc5234">https://www.rfc-editor.org/rfc/rfc5234</a>
   <dt id="biblio-rfc7405">[RFC7405]
   <dd>P. Kyzivat. <a href="https://www.rfc-editor.org/rfc/rfc7405"><cite>Case-Sensitive String Support in ABNF</cite></a>. December 2014. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc7405">https://www.rfc-editor.org/rfc/rfc7405</a>
   <dt id="biblio-rfc7517">[RFC7517]
   <dd>M. Jones. <a href="https://www.rfc-editor.org/rfc/rfc7517"><cite>JSON Web Key (JWK)</cite></a>. May 2015. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc7517">https://www.rfc-editor.org/rfc/rfc7517</a>
   <dt id="biblio-rfc7638">[RFC7638]
   <dd>M. Jones; N. Sakimura. <a href="https://www.rfc-editor.org/rfc/rfc7638"><cite>JSON Web Key (JWK) Thumbprint</cite></a>. September 2015. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc7638">https://www.rfc-editor.org/rfc/rfc7638</a>
   <dt id="biblio-rfc9112">[RFC9112]
   <dd>R. Fielding, Ed.; M. Nottingham, Ed.; J. Reschke, Ed.. <a href="https://httpwg.org/specs/rfc9112.html"><cite>HTTP/1.1</cite></a>. June 2022. Internet Standard. URL: <a href="https://httpwg.org/specs/rfc9112.html">https://httpwg.org/specs/rfc9112.html</a>
   <dt id="biblio-rfc9651">[RFC9651]
   <dd>M. Nottingham; P-H. Kamp. <a href="https://www.rfc-editor.org/rfc/rfc9651"><cite>Structured Field Values for HTTP</cite></a>. September 2024. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc9651">https://www.rfc-editor.org/rfc/rfc9651</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/"><cite>URL Standard</cite></a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
  </dl>
<script>/* Boilerplate: script-dom-helper */
"use strict";
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
let dfnPanelData = {
"0698d556": {"dfnID":"0698d556","dfnText":"string","external":true,"refSections":[{"refs":[{"id":"ref-for-string"},{"id":"ref-for-string\u2460"},{"id":"ref-for-string\u2461"},{"id":"ref-for-string\u2462"}],"title":"7.3. Device bound session"},{"refs":[{"id":"ref-for-string\u2463"},{"id":"ref-for-string\u2464"},{"id":"ref-for-string\u2465"}],"title":"7.5. Scope specification"},{"refs":[{"id":"ref-for-string\u2466"},{"id":"ref-for-string\u2467"}],"title":"7.6. Session credential"},{"refs":[{"id":"ref-for-string\u2468"}],"title":"8.4. Identify if a host matches a pattern"},{"refs":[{"id":"ref-for-string\u2460\u2461"}],"title":"8.8. Send request"},{"refs":[{"id":"ref-for-string\u2460\u2462"}],"title":"8.9. Create session"},{"refs":[{"id":"ref-for-string\u2460\u2465"}],"title":"8.12. Add debug header"},{"refs":[{"id":"ref-for-string\u2461\u2466"},{"id":"ref-for-string\u2461\u2467"},{"id":"ref-for-string\u2461\u2468"}],"title":"9.6. JSON Session Instruction Format"},{"refs":[{"id":"ref-for-string\u2462\u24ea"}],"title":"9.7. JSON Session Scope Instruction Format"},{"refs":[{"id":"ref-for-string\u2462\u2460"},{"id":"ref-for-string\u2462\u2461"},{"id":"ref-for-string\u2462\u2462"}],"title":"9.8. JSON Session Scope Rule Format"},{"refs":[{"id":"ref-for-string\u2462\u2463"},{"id":"ref-for-string\u2462\u2464"},{"id":"ref-for-string\u2462\u2465"}],"title":"9.9. JSON Session Credentials Format"},{"refs":[{"id":"ref-for-string\u2462\u2466"},{"id":"ref-for-string\u2462\u2467"},{"id":"ref-for-string\u2462\u2468"},{"id":"ref-for-string\u2463\u24ea"}],"title":"9.10. DBSC Proof JWT Syntax"},{"refs":[{"id":"ref-for-string\u2463\u2460"}],"title":"10.1. Changes to the Fetch specification"}],"url":"https://infra.spec.whatwg.org/#string"},
"086e3aff": {"dfnID":"086e3aff","dfnText":"origin","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-origin"}],"title":"7.4. Session scope"},{"refs":[{"id":"ref-for-concept-origin\u2460"},{"id":"ref-for-concept-origin\u2461"}],"title":"8.2. Identify if a URL is in scope of a session"},{"refs":[{"id":"ref-for-concept-origin\u2462"},{"id":"ref-for-concept-origin\u2463"}],"title":"8.8. Send request"},{"refs":[{"id":"ref-for-concept-origin\u2464"},{"id":"ref-for-concept-origin\u2465"},{"id":"ref-for-concept-origin\u2466"},{"id":"ref-for-concept-origin\u2467"}],"title":"8.9. Create session"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin"},
"0e8de730": {"dfnID":"0e8de730","dfnText":"tuple","external":true,"refSections":[{"refs":[{"id":"ref-for-tuple"}],"title":"8.5. Identify session needing refresh"},{"refs":[{"id":"ref-for-tuple\u2460"}],"title":"10.1. Changes to the Fetch specification"}],"url":"https://infra.spec.whatwg.org/#tuple"},
"1534f1eb": {"dfnID":"1534f1eb","dfnText":"header name","external":true,"refSections":[{"refs":[{"id":"ref-for-header-name"}],"title":"8.12. Add debug header"}],"url":"https://fetch.spec.whatwg.org/#header-name"},
"16d07e10": {"dfnID":"16d07e10","dfnText":"for each","external":true,"refSections":[{"refs":[{"id":"ref-for-list-iterate"}],"title":"8.2. Identify if a URL is in scope of a session"},{"refs":[{"id":"ref-for-list-iterate\u2460"}],"title":"8.3. Identify if a request is allowed to refresh"},{"refs":[{"id":"ref-for-list-iterate\u2461"}],"title":"8.5. Identify session needing refresh"},{"refs":[{"id":"ref-for-list-iterate\u2462"}],"title":"8.6. Identify if missing session credential"},{"refs":[{"id":"ref-for-list-iterate\u2463"},{"id":"ref-for-list-iterate\u2464"}],"title":"8.7. Cache challenge"},{"refs":[{"id":"ref-for-list-iterate\u2465"},{"id":"ref-for-list-iterate\u2466"},{"id":"ref-for-list-iterate\u2467"}],"title":"8.9. Create session"},{"refs":[{"id":"ref-for-list-iterate\u2468"}],"title":"8.10. Process session registration"},{"refs":[{"id":"ref-for-list-iterate\u2460\u24ea"}],"title":"8.11. Create session key pair"}],"url":"https://infra.spec.whatwg.org/#list-iterate"},
"1e2edd5b": {"dfnID":"1e2edd5b","dfnText":"moment","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-moment"}],"title":"7.3. Device bound session"}],"url":"https://w3c.github.io/hr-time/#dfn-moment"},
"22477314": {"dfnID":"22477314","dfnText":"domain","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-domain"},{"id":"ref-for-concept-domain\u2460"}],"title":"7.7. Registrable origin label"},{"refs":[{"id":"ref-for-concept-domain\u2461"}],"title":"8.4. Identify if a host matches a pattern"}],"url":"https://url.spec.whatwg.org/#concept-domain"},
"2cb28cb0": {"dfnID":"2cb28cb0","dfnText":"denied","external":true,"refSections":[{"refs":[{"id":"ref-for-dom-permissionstate-denied"}],"title":"8.11. Create session key pair"}],"url":"https://w3c.github.io/permissions/#dom-permissionstate-denied"},
"3268a8eb": {"dfnID":"3268a8eb","dfnText":"URL (for response)","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-response-url"}],"title":"8.7. Cache challenge"}],"url":"https://fetch.spec.whatwg.org/#concept-response-url"},
"35b98f13": {"dfnID":"35b98f13","dfnText":"set a structured field value","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-header-list-set-structured-header"}],"title":"8.12. Add debug header"}],"url":"https://fetch.spec.whatwg.org/#concept-header-list-set-structured-header"},
"36858240": {"dfnID":"36858240","dfnText":"boolean","external":true,"refSections":[{"refs":[{"id":"ref-for-boolean"}],"title":"7.4. Session scope"},{"refs":[{"id":"ref-for-boolean\u2460"}],"title":"8.6. Identify if missing session credential"},{"refs":[{"id":"ref-for-boolean\u2461"}],"title":"9.6. JSON Session Instruction Format"},{"refs":[{"id":"ref-for-boolean\u2462"}],"title":"9.7. JSON Session Scope Instruction Format"}],"url":"https://infra.spec.whatwg.org/#boolean"},
"36d8cca0": {"dfnID":"36d8cca0","dfnText":"sf-string","external":true,"refSections":[{"refs":[{"id":"ref-for-string\u2460\u24ea"},{"id":"ref-for-string\u2460\u2460"}],"title":"8.7. Cache challenge"},{"refs":[{"id":"ref-for-string\u2460\u2463"},{"id":"ref-for-string\u2460\u2464"}],"title":"8.10. Process session registration"},{"refs":[{"id":"ref-for-string\u2460\u2466"},{"id":"ref-for-string\u2460\u2467"},{"id":"ref-for-string\u2460\u2468"},{"id":"ref-for-string\u2461\u24ea"},{"id":"ref-for-string\u2461\u2460"},{"id":"ref-for-string\u2461\u2461"}],"title":"9.1. `Secure-Session-Registration` HTTP header field"},{"refs":[{"id":"ref-for-string\u2461\u2462"}],"title":"9.2. `Secure-Session-Challenge` HTTP header field"},{"refs":[{"id":"ref-for-string\u2461\u2463"}],"title":"9.3. `Secure-Session-Response` HTTP header field"},{"refs":[{"id":"ref-for-string\u2461\u2464"}],"title":"9.4. `Sec-Secure-Session-Id` HTTP header field"},{"refs":[{"id":"ref-for-string\u2461\u2465"}],"title":"9.5. `Secure-Session-Skipped` HTTP header field"}],"url":"https://datatracker.ietf.org/doc/html/rfc9651#string"},
"37e40809": {"dfnID":"37e40809","dfnText":"sf-list","external":true,"refSections":[{"refs":[{"id":"ref-for-list\u2464"}],"title":"8.12. Add debug header"},{"refs":[{"id":"ref-for-list\u2465"}],"title":"9.1. `Secure-Session-Registration` HTTP header field"},{"refs":[{"id":"ref-for-list\u2466"}],"title":"9.5. `Secure-Session-Skipped` HTTP header field"}],"url":"https://datatracker.ietf.org/doc/html/rfc9651#list"},
"50b05fad": {"dfnID":"50b05fad","dfnText":"method","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-method"}],"title":"8.8. Send request"}],"url":"https://fetch.spec.whatwg.org/#concept-request-method"},
"55213b5b": {"dfnID":"55213b5b","dfnText":"request","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request"}],"title":"8.3. Identify if a request is allowed to refresh"},{"refs":[{"id":"ref-for-concept-request\u2460"}],"title":"8.5. Identify session needing refresh"},{"refs":[{"id":"ref-for-concept-request\u2461"}],"title":"8.6. Identify if missing session credential"},{"refs":[{"id":"ref-for-concept-request\u2462"}],"title":"8.8. Send request"},{"refs":[{"id":"ref-for-concept-request\u2463"}],"title":"8.10. Process session registration"},{"refs":[{"id":"ref-for-concept-request\u2464"}],"title":"8.12. Add debug header"},{"refs":[{"id":"ref-for-concept-request\u2465"}],"title":"9.3. `Secure-Session-Response` HTTP header field"},{"refs":[{"id":"ref-for-concept-request\u2466"}],"title":"9.4. `Sec-Secure-Session-Id` HTTP header field"},{"refs":[{"id":"ref-for-concept-request\u2467"}],"title":"9.5. `Secure-Session-Skipped` HTTP header field"},{"refs":[{"id":"ref-for-concept-request\u2468"},{"id":"ref-for-concept-request\u2460\u24ea"}],"title":"9.6. JSON Session Instruction Format"},{"refs":[{"id":"ref-for-concept-request\u2460\u2460"}],"title":"10.1. Changes to the Fetch specification"}],"url":"https://fetch.spec.whatwg.org/#concept-request"},
"5c66de35": {"dfnID":"5c66de35","dfnText":"get a structured field value","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-header-list-get-structured-header"}],"title":"8.7. Cache challenge"},{"refs":[{"id":"ref-for-concept-header-list-get-structured-header\u2460"}],"title":"8.10. Process session registration"},{"refs":[{"id":"ref-for-concept-header-list-get-structured-header\u2461"}],"title":"8.12. Add debug header"}],"url":"https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header"},
"649608b9": {"dfnID":"649608b9","dfnText":"list","external":true,"refSections":[{"refs":[{"id":"ref-for-list"},{"id":"ref-for-list\u2460"}],"title":"7.3. Device bound session"},{"refs":[{"id":"ref-for-list\u2461"}],"title":"7.4. Session scope"},{"refs":[{"id":"ref-for-list\u2462"}],"title":"8.6. Identify if missing session credential"},{"refs":[{"id":"ref-for-list\u2463"}],"title":"8.11. Create session key pair"},{"refs":[{"id":"ref-for-list\u2467"},{"id":"ref-for-list\u2468"}],"title":"9.6. JSON Session Instruction Format"},{"refs":[{"id":"ref-for-list\u2460\u24ea"}],"title":"9.7. JSON Session Scope Instruction Format"},{"refs":[{"id":"ref-for-list\u2460\u2460"}],"title":"10.1. Changes to the Fetch specification"}],"url":"https://infra.spec.whatwg.org/#list"},
"64b62ea0": {"dfnID":"64b62ea0","dfnText":"redirect mode","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-redirect-mode"}],"title":"8.8. Send request"}],"url":"https://fetch.spec.whatwg.org/#concept-request-redirect-mode"},
"6ee0eab1": {"dfnID":"6ee0eab1","dfnText":"header list (for request)","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-header-list"}],"title":"8.6. Identify if missing session credential"},{"refs":[{"id":"ref-for-concept-request-header-list\u2460"},{"id":"ref-for-concept-request-header-list\u2461"},{"id":"ref-for-concept-request-header-list\u2462"}],"title":"8.8. Send request"},{"refs":[{"id":"ref-for-concept-request-header-list\u2463"},{"id":"ref-for-concept-request-header-list\u2464"}],"title":"8.12. Add debug header"}],"url":"https://fetch.spec.whatwg.org/#concept-request-header-list"},
"7393da89": {"dfnID":"7393da89","dfnText":"same origin","external":true,"refSections":[{"refs":[{"id":"ref-for-same-origin"}],"title":"8.2. Identify if a URL is in scope of a session"},{"refs":[{"id":"ref-for-same-origin\u2460"}],"title":"8.3. Identify if a request is allowed to refresh"},{"refs":[{"id":"ref-for-same-origin\u2461"}],"title":"8.11. Create session key pair"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#same-origin"},
"77a2ee6e": {"dfnID":"77a2ee6e","dfnText":"host","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-origin-host"}],"title":"8.3. Identify if a request is allowed to refresh"},{"refs":[{"id":"ref-for-concept-origin-host\u2460"}],"title":"8.9. Create session"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-host"},
"7b0d918d": {"dfnID":"7b0d918d","dfnText":"break","external":true,"refSections":[{"refs":[{"id":"ref-for-iteration-break"}],"title":"8.7. Cache challenge"},{"refs":[{"id":"ref-for-iteration-break\u2460"}],"title":"8.9. Create session"}],"url":"https://infra.spec.whatwg.org/#iteration-break"},
"81a76425": {"dfnID":"81a76425","dfnText":"body","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-response-body"}],"title":"8.8. Send request"},{"refs":[{"id":"ref-for-concept-response-body\u2460"},{"id":"ref-for-concept-response-body\u2461"},{"id":"ref-for-concept-response-body\u2462"}],"title":"8.9. Create session"},{"refs":[{"id":"ref-for-concept-response-body\u2463"},{"id":"ref-for-concept-response-body\u2464"},{"id":"ref-for-concept-response-body\u2465"},{"id":"ref-for-concept-response-body\u2466"},{"id":"ref-for-concept-response-body\u2467"},{"id":"ref-for-concept-response-body\u2468"}],"title":"8.11. Create session key pair"}],"url":"https://fetch.spec.whatwg.org/#concept-response-body"},
"84b454ff": {"dfnID":"84b454ff","dfnText":"ordered map","external":true,"refSections":[{"refs":[{"id":"ref-for-ordered-map"}],"title":"7.1. Session store"},{"refs":[{"id":"ref-for-ordered-map\u2460"}],"title":"7.2. Sessions by id"}],"url":"https://infra.spec.whatwg.org/#ordered-map"},
"86e83811": {"dfnID":"86e83811","dfnText":"sf-token","external":true,"refSections":[{"refs":[{"id":"ref-for-token"}],"title":"8.11. Create session key pair"},{"refs":[{"id":"ref-for-token\u2460"},{"id":"ref-for-token\u2461"}],"title":"8.12. Add debug header"},{"refs":[{"id":"ref-for-token\u2462"}],"title":"9.1. `Secure-Session-Registration` HTTP header field"},{"refs":[{"id":"ref-for-token\u2463"}],"title":"9.5. `Secure-Session-Skipped` HTTP header field"}],"url":"https://datatracker.ietf.org/doc/html/rfc9651#token"},
"902380f7": {"dfnID":"902380f7","dfnText":"credentials mode","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-credentials-mode"}],"title":"8.9. Create session"},{"refs":[{"id":"ref-for-concept-request-credentials-mode\u2460"},{"id":"ref-for-concept-request-credentials-mode\u2461"}],"title":"8.11. Create session key pair"}],"url":"https://fetch.spec.whatwg.org/#concept-request-credentials-mode"},
"959ad97b": {"dfnID":"959ad97b","dfnText":"origin","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-url-origin"},{"id":"ref-for-concept-url-origin\u2460"},{"id":"ref-for-concept-url-origin\u2461"}],"title":"8.11. Create session key pair"}],"url":"https://url.spec.whatwg.org/#concept-url-origin"},
"984221ca": {"dfnID":"984221ca","dfnText":"struct","external":true,"refSections":[{"refs":[{"id":"ref-for-struct"}],"title":"7.3. Device bound session"},{"refs":[{"id":"ref-for-struct\u2460"}],"title":"7.4. Session scope"},{"refs":[{"id":"ref-for-struct\u2461"}],"title":"7.5. Scope specification"},{"refs":[{"id":"ref-for-struct\u2462"}],"title":"7.6. Session credential"}],"url":"https://infra.spec.whatwg.org/#struct"},
"a1d47575": {"dfnID":"a1d47575","dfnText":"status","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-response-status"},{"id":"ref-for-concept-response-status\u2460"},{"id":"ref-for-concept-response-status\u2461"},{"id":"ref-for-concept-response-status\u2462"},{"id":"ref-for-concept-response-status\u2463"}],"title":"8.8. Send request"},{"refs":[{"id":"ref-for-concept-response-status\u2464"}],"title":"8.9. Create session"},{"refs":[{"id":"ref-for-concept-response-status\u2465"},{"id":"ref-for-concept-response-status\u2466"}],"title":"8.11. Create session key pair"},{"refs":[{"id":"ref-for-concept-response-status\u2467"}],"title":"9.2. `Secure-Session-Challenge` HTTP header field"}],"url":"https://fetch.spec.whatwg.org/#concept-response-status"},
"a326add7": {"dfnID":"a326add7","dfnText":"contain","external":true,"refSections":[{"refs":[{"id":"ref-for-map-exists"}],"title":"8.1. Identify session"},{"refs":[{"id":"ref-for-map-exists\u2460"}],"title":"8.5. Identify session needing refresh"}],"url":"https://infra.spec.whatwg.org/#map-exists"},
"a6a8ec88": {"dfnID":"a6a8ec88","dfnText":"append","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-header-list-append"},{"id":"ref-for-concept-header-list-append\u2460"},{"id":"ref-for-concept-header-list-append\u2461"}],"title":"8.8. Send request"}],"url":"https://fetch.spec.whatwg.org/#concept-header-list-append"},
"add-debug-header": {"dfnID":"add-debug-header","dfnText":"add the debug header","external":false,"refSections":[],"url":"#add-debug-header"},
"algorithms-determine-if-a-host-matches-a-pattern": {"dfnID":"algorithms-determine-if-a-host-matches-a-pattern","dfnText":"determine if\n  a host matches a pattern","external":false,"refSections":[],"url":"#algorithms-determine-if-a-host-matches-a-pattern"},
"algorithms-determine-if-a-request-is-allowed-to-trigger-refresh": {"dfnID":"algorithms-determine-if-a-request-is-allowed-to-trigger-refresh","dfnText":"determine if\n  a request is allowed to trigger refresh","external":false,"refSections":[],"url":"#algorithms-determine-if-a-request-is-allowed-to-trigger-refresh"},
"algorithms-determine-if-a-url-is-in-scope": {"dfnID":"algorithms-determine-if-a-url-is-in-scope","dfnText":"determine if a\n  URL is in scope","external":false,"refSections":[],"url":"#algorithms-determine-if-a-url-is-in-scope"},
"algorithms-identify-a-session": {"dfnID":"algorithms-identify-a-session","dfnText":"identify a session","external":false,"refSections":[],"url":"#algorithms-identify-a-session"},
"algorithms-identify-a-session-needing-refresh": {"dfnID":"algorithms-identify-a-session-needing-refresh","dfnText":"identify a session needing refresh","external":false,"refSections":[],"url":"#algorithms-identify-a-session-needing-refresh"},
"algorithms-identify-if-a-request-is-missing-a-session-credential": {"dfnID":"algorithms-identify-if-a-request-is-missing-a-session-credential","dfnText":"identify if a\n  request is missing a session credential","external":false,"refSections":[],"url":"#algorithms-identify-if-a-request-is-missing-a-session-credential"},
"algorithms-process-a-challenge": {"dfnID":"algorithms-process-a-challenge","dfnText":"process a challenge","external":false,"refSections":[],"url":"#algorithms-process-a-challenge"},
"algorithms-send-a-request": {"dfnID":"algorithms-send-a-request","dfnText":"send a\n  request","external":false,"refSections":[],"url":"#algorithms-send-a-request"},
"b6374348": {"dfnID":"b6374348","dfnText":"sf-inner-list","external":true,"refSections":[{"refs":[{"id":"ref-for-inner-list"}],"title":"8.10. Process session registration"}],"url":"https://datatracker.ietf.org/doc/html/rfc9651#inner-list"},
"b85ee3be": {"dfnID":"b85ee3be","dfnText":"host","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-url-host"}],"title":"8.1. Identify session"},{"refs":[{"id":"ref-for-concept-url-host\u2460"}],"title":"8.2. Identify if a URL is in scope of a session"},{"refs":[{"id":"ref-for-concept-url-host\u2461"}],"title":"8.4. Identify if a host matches a pattern"},{"refs":[{"id":"ref-for-concept-url-host\u2462"}],"title":"8.5. Identify session needing refresh"},{"refs":[{"id":"ref-for-concept-url-host\u2463"}],"title":"8.8. Send request"},{"refs":[{"id":"ref-for-concept-url-host\u2464"},{"id":"ref-for-concept-url-host\u2465"},{"id":"ref-for-concept-url-host\u2466"},{"id":"ref-for-concept-url-host\u2467"}],"title":"8.9. Create session"},{"refs":[{"id":"ref-for-concept-url-host\u2468"}],"title":"8.11. Create session key pair"}],"url":"https://url.spec.whatwg.org/#concept-url-host"},
"bc9d7803": {"dfnID":"bc9d7803","dfnText":"registrable domain","external":true,"refSections":[{"refs":[{"id":"ref-for-host-registrable-domain"}],"title":"7.1. Session store"},{"refs":[{"id":"ref-for-host-registrable-domain\u2460"}],"title":"7.2. Sessions by id"},{"refs":[{"id":"ref-for-host-registrable-domain\u2461"}],"title":"7.3. Device bound session"},{"refs":[{"id":"ref-for-host-registrable-domain\u2462"},{"id":"ref-for-host-registrable-domain\u2463"}],"title":"7.7. Registrable origin label"},{"refs":[{"id":"ref-for-host-registrable-domain\u2464"},{"id":"ref-for-host-registrable-domain\u2465"}],"title":"8.1. Identify session"},{"refs":[{"id":"ref-for-host-registrable-domain\u2466"}],"title":"8.5. Identify session needing refresh"},{"refs":[{"id":"ref-for-host-registrable-domain\u2467"}],"title":"8.8. Send request"},{"refs":[{"id":"ref-for-host-registrable-domain\u2468"},{"id":"ref-for-host-registrable-domain\u2460\u24ea"}],"title":"8.9. Create session"},{"refs":[{"id":"ref-for-host-registrable-domain\u2460\u2460"}],"title":"8.11. Create session key pair"},{"refs":[{"id":"ref-for-host-registrable-domain\u2460\u2461"}],"title":"10.1. Changes to the Fetch specification"}],"url":"https://url.spec.whatwg.org/#host-registrable-domain"},
"bcc085e3": {"dfnID":"bcc085e3","dfnText":"request permission to use","external":true,"refSections":[{"refs":[{"id":"ref-for-dfn-request-permission-to-use"}],"title":"8.11. Create session key pair"}],"url":"https://w3c.github.io/permissions/#dfn-request-permission-to-use"},
"bd6b32a4": {"dfnID":"bd6b32a4","dfnText":"public suffix","external":true,"refSections":[{"refs":[{"id":"ref-for-host-public-suffix"}],"title":"7.7. Registrable origin label"}],"url":"https://url.spec.whatwg.org/#host-public-suffix"},
"c0868016": {"dfnID":"c0868016","dfnText":"path","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-url-path"},{"id":"ref-for-concept-url-path\u2460"},{"id":"ref-for-concept-url-path\u2461"}],"title":"8.2. Identify if a URL is in scope of a session"},{"refs":[{"id":"ref-for-concept-url-path\u2462"}],"title":"8.9. Create session"},{"refs":[{"id":"ref-for-concept-url-path\u2463"},{"id":"ref-for-concept-url-path\u2464"}],"title":"8.11. Create session key pair"}],"url":"https://url.spec.whatwg.org/#concept-url-path"},
"c88f3887": {"dfnID":"c88f3887","dfnText":"item","external":true,"refSections":[{"refs":[{"id":"ref-for-struct-item"}],"title":"7.3. Device bound session"},{"refs":[{"id":"ref-for-struct-item\u2460"}],"title":"7.4. Session scope"},{"refs":[{"id":"ref-for-struct-item\u2461"}],"title":"7.5. Scope specification"},{"refs":[{"id":"ref-for-struct-item\u2462"}],"title":"7.6. Session credential"}],"url":"https://infra.spec.whatwg.org/#struct-item"},
"create-session": {"dfnID":"create-session","dfnText":"create a session","external":false,"refSections":[],"url":"#create-session"},
"create-session-key-pair": {"dfnID":"create-session-key-pair","dfnText":"create\na session key pair","external":false,"refSections":[],"url":"#create-session-key-pair"},
"dbsc-proof": {"dfnID":"dbsc-proof","dfnText":"DBSC proof","external":false,"refSections":[{"refs":[{"id":"ref-for-dbsc-proof"}],"title":"8.7. Cache challenge"},{"refs":[{"id":"ref-for-dbsc-proof\u2460"}],"title":"8.8. Send request"},{"refs":[{"id":"ref-for-dbsc-proof\u2461"},{"id":"ref-for-dbsc-proof\u2462"}],"title":"9.2. `Secure-Session-Challenge` HTTP header field"},{"refs":[{"id":"ref-for-dbsc-proof\u2463"},{"id":"ref-for-dbsc-proof\u2464"}],"title":"9.3. `Secure-Session-Response` HTTP header field"},{"refs":[{"id":"ref-for-dbsc-proof\u2465"},{"id":"ref-for-dbsc-proof\u2466"},{"id":"ref-for-dbsc-proof\u2467"},{"id":"ref-for-dbsc-proof\u2468"}],"title":"9.10. DBSC Proof JWT Syntax"}],"url":"#dbsc-proof"},
"dc1cd39b": {"dfnID":"dc1cd39b","dfnText":"URL (for request)","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-url"},{"id":"ref-for-concept-request-url\u2460"}],"title":"8.5. Identify session needing refresh"},{"refs":[{"id":"ref-for-concept-request-url\u2461"},{"id":"ref-for-concept-request-url\u2462"}],"title":"8.8. Send request"},{"refs":[{"id":"ref-for-concept-request-url\u2463"}],"title":"9.6. JSON Session Instruction Format"}],"url":"https://fetch.spec.whatwg.org/#concept-request-url"},
"dcffbccd": {"dfnID":"dcffbccd","dfnText":"URL","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-url"},{"id":"ref-for-concept-url\u2460"}],"title":"7.3. Device bound session"},{"refs":[{"id":"ref-for-concept-url\u2461"}],"title":"8.1. Identify session"},{"refs":[{"id":"ref-for-concept-url\u2462"}],"title":"8.2. Identify if a URL is in scope of a session"},{"refs":[{"id":"ref-for-concept-url\u2463"}],"title":"8.8. Send request"},{"refs":[{"id":"ref-for-concept-url\u2464"}],"title":"8.9. Create session"},{"refs":[{"id":"ref-for-concept-url\u2465"},{"id":"ref-for-concept-url\u2466"}],"title":"8.11. Create session key pair"},{"refs":[{"id":"ref-for-concept-url\u2467"},{"id":"ref-for-concept-url\u2468"}],"title":"9.1. `Secure-Session-Registration` HTTP header field"},{"refs":[{"id":"ref-for-concept-url\u2460\u24ea"},{"id":"ref-for-concept-url\u2460\u2460"}],"title":"9.6. JSON Session Instruction Format"}],"url":"https://url.spec.whatwg.org/#concept-url"},
"device-bound-session": {"dfnID":"device-bound-session","dfnText":"device bound session","external":false,"refSections":[{"refs":[{"id":"ref-for-device-bound-session"}],"title":"7.2. Sessions by id"},{"refs":[{"id":"ref-for-device-bound-session\u2460"}],"title":"8.1. Identify session"},{"refs":[{"id":"ref-for-device-bound-session\u2461"}],"title":"8.2. Identify if a URL is in scope of a session"},{"refs":[{"id":"ref-for-device-bound-session\u2462"}],"title":"8.3. Identify if a request is allowed to refresh"},{"refs":[{"id":"ref-for-device-bound-session\u2463"},{"id":"ref-for-device-bound-session\u2464"}],"title":"8.7. Cache challenge"},{"refs":[{"id":"ref-for-device-bound-session\u2465"}],"title":"9.1. `Secure-Session-Registration` HTTP header field"}],"url":"#device-bound-session"},
"device-bound-session-allowed-refresh-initiators": {"dfnID":"device-bound-session-allowed-refresh-initiators","dfnText":"allowed refresh initiators","external":false,"refSections":[{"refs":[{"id":"ref-for-device-bound-session-allowed-refresh-initiators"}],"title":"8.3. Identify if a request is allowed to refresh"},{"refs":[{"id":"ref-for-device-bound-session-allowed-refresh-initiators\u2460"}],"title":"8.9. Create session"}],"url":"#device-bound-session-allowed-refresh-initiators"},
"device-bound-session-cached-challenge": {"dfnID":"device-bound-session-cached-challenge","dfnText":"cached challenge","external":false,"refSections":[{"refs":[{"id":"ref-for-device-bound-session-cached-challenge"},{"id":"ref-for-device-bound-session-cached-challenge\u2460"}],"title":"8.7. Cache challenge"},{"refs":[{"id":"ref-for-device-bound-session-cached-challenge\u2461"}],"title":"8.8. Send request"},{"refs":[{"id":"ref-for-device-bound-session-cached-challenge\u2462"}],"title":"10.1. Changes to the Fetch specification"}],"url":"#device-bound-session-cached-challenge"},
"device-bound-session-expiration-timestamp": {"dfnID":"device-bound-session-expiration-timestamp","dfnText":"expiration timestamp","external":false,"refSections":[{"refs":[{"id":"ref-for-device-bound-session-expiration-timestamp"},{"id":"ref-for-device-bound-session-expiration-timestamp\u2460"}],"title":"8.5. Identify session needing refresh"},{"refs":[{"id":"ref-for-device-bound-session-expiration-timestamp\u2461"}],"title":"8.9. Create session"}],"url":"#device-bound-session-expiration-timestamp"},
"device-bound-session-refresh-url": {"dfnID":"device-bound-session-refresh-url","dfnText":"refresh URL","external":false,"refSections":[{"refs":[{"id":"ref-for-device-bound-session-refresh-url"}],"title":"8.2. Identify if a URL is in scope of a session"},{"refs":[{"id":"ref-for-device-bound-session-refresh-url\u2460"}],"title":"8.9. Create session"},{"refs":[{"id":"ref-for-device-bound-session-refresh-url\u2461"}],"title":"10.1. Changes to the Fetch specification"}],"url":"#device-bound-session-refresh-url"},
"device-bound-session-session-credentials": {"dfnID":"device-bound-session-session-credentials","dfnText":"session credentials","external":false,"refSections":[{"refs":[{"id":"ref-for-device-bound-session-session-credentials"}],"title":"8.5. Identify session needing refresh"},{"refs":[{"id":"ref-for-device-bound-session-session-credentials\u2460"}],"title":"8.7. Cache challenge"},{"refs":[{"id":"ref-for-device-bound-session-session-credentials\u2461"},{"id":"ref-for-device-bound-session-session-credentials\u2462"}],"title":"8.9. Create session"}],"url":"#device-bound-session-session-credentials"},
"device-bound-session-session-identifier": {"dfnID":"device-bound-session-session-identifier","dfnText":"session identifier","external":false,"refSections":[{"refs":[{"id":"ref-for-device-bound-session-session-identifier"}],"title":"7.2. Sessions by id"},{"refs":[{"id":"ref-for-device-bound-session-session-identifier\u2460"},{"id":"ref-for-device-bound-session-session-identifier\u2461"}],"title":"8.1. Identify session"},{"refs":[{"id":"ref-for-device-bound-session-session-identifier\u2462"}],"title":"8.5. Identify session needing refresh"},{"refs":[{"id":"ref-for-device-bound-session-session-identifier\u2463"}],"title":"8.9. Create session"},{"refs":[{"id":"ref-for-device-bound-session-session-identifier\u2464"}],"title":"9.2.1. `Secure-Session-Challenge` structured header serialization"},{"refs":[{"id":"ref-for-device-bound-session-session-identifier\u2465"}],"title":"9.6. JSON Session Instruction Format"},{"refs":[{"id":"ref-for-device-bound-session-session-identifier\u2466"}],"title":"10.1. Changes to the Fetch specification"}],"url":"#device-bound-session-session-identifier"},
"device-bound-session-session-key-pair": {"dfnID":"device-bound-session-session-key-pair","dfnText":"session key pair","external":false,"refSections":[{"refs":[{"id":"ref-for-device-bound-session-session-key-pair"}],"title":"8.9. Create session"},{"refs":[{"id":"ref-for-device-bound-session-session-key-pair\u2460"},{"id":"ref-for-device-bound-session-session-key-pair\u2461"},{"id":"ref-for-device-bound-session-session-key-pair\u2462"}],"title":"8.11. Create session key pair"},{"refs":[{"id":"ref-for-device-bound-session-session-key-pair\u2463"}],"title":"10.1. Changes to the Fetch specification"}],"url":"#device-bound-session-session-key-pair"},
"device-bound-session-session-scope": {"dfnID":"device-bound-session-session-scope","dfnText":"session scope","external":false,"refSections":[{"refs":[{"id":"ref-for-device-bound-session-session-scope"}],"title":"8.2. Identify if a URL is in scope of a session"},{"refs":[{"id":"ref-for-device-bound-session-session-scope\u2460"},{"id":"ref-for-device-bound-session-session-scope\u2461"},{"id":"ref-for-device-bound-session-session-scope\u2462"},{"id":"ref-for-device-bound-session-session-scope\u2463"}],"title":"8.3. Identify if a request is allowed to refresh"},{"refs":[{"id":"ref-for-device-bound-session-session-scope\u2464"},{"id":"ref-for-device-bound-session-session-scope\u2465"}],"title":"8.9. Create session"},{"refs":[{"id":"ref-for-device-bound-session-session-scope\u2466"}],"title":"8.11. Create session key pair"}],"url":"#device-bound-session-session-scope"},
"e25b5dcb": {"dfnID":"e25b5dcb","dfnText":"sf-parameter","external":true,"refSections":[{"refs":[{"id":"ref-for-name-parameters"}],"title":"8.12. Add debug header"},{"refs":[{"id":"ref-for-name-parameters\u2460"},{"id":"ref-for-name-parameters\u2461"},{"id":"ref-for-name-parameters\u2462"},{"id":"ref-for-name-parameters\u2463"},{"id":"ref-for-name-parameters\u2464"},{"id":"ref-for-name-parameters\u2465"},{"id":"ref-for-name-parameters\u2466"},{"id":"ref-for-name-parameters\u2467"}],"title":"9.1. `Secure-Session-Registration` HTTP header field"},{"refs":[{"id":"ref-for-name-parameters\u2468"},{"id":"ref-for-name-parameters\u2460\u24ea"}],"title":"9.2.1. `Secure-Session-Challenge` structured header serialization"},{"refs":[{"id":"ref-for-name-parameters\u2460\u2460"}],"title":"9.3. `Secure-Session-Response` HTTP header field"},{"refs":[{"id":"ref-for-name-parameters\u2460\u2461"},{"id":"ref-for-name-parameters\u2460\u2462"}],"title":"9.5. `Secure-Session-Skipped` HTTP header field"},{"refs":[{"id":"ref-for-name-parameters\u2460\u2463"}],"title":"9.10. DBSC Proof JWT Syntax"}],"url":"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters"},
"eb1b1af3": {"dfnID":"eb1b1af3","dfnText":"network error","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-network-error"}],"title":"8.8. Send request"}],"url":"https://fetch.spec.whatwg.org/#concept-network-error"},
"ee469dff": {"dfnID":"ee469dff","dfnText":"with default","external":true,"refSections":[{"refs":[{"id":"ref-for-map-with-default"}],"title":"8.1. Identify session"}],"url":"https://infra.spec.whatwg.org/#map-with-default"},
"ee7bba09": {"dfnID":"ee7bba09","dfnText":"response","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-response"}],"title":"8.7. Cache challenge"},{"refs":[{"id":"ref-for-concept-response\u2460"}],"title":"8.9. Create session"},{"refs":[{"id":"ref-for-concept-response\u2461"}],"title":"8.10. Process session registration"},{"refs":[{"id":"ref-for-concept-response\u2462"}],"title":"9.1. `Secure-Session-Registration` HTTP header field"},{"refs":[{"id":"ref-for-concept-response\u2463"}],"title":"9.2. `Secure-Session-Challenge` HTTP header field"}],"url":"https://fetch.spec.whatwg.org/#concept-response"},
"eea18c0d": {"dfnID":"eea18c0d","dfnText":"domain label","external":true,"refSections":[{"refs":[{"id":"ref-for-domain-label"}],"title":"7.7. Registrable origin label"}],"url":"https://url.spec.whatwg.org/#domain-label"},
"f78d5b5c": {"dfnID":"f78d5b5c","dfnText":"origin","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-origin"},{"id":"ref-for-concept-request-origin\u2460"},{"id":"ref-for-concept-request-origin\u2461"}],"title":"8.3. Identify if a request is allowed to refresh"},{"refs":[{"id":"ref-for-concept-request-origin\u2462"},{"id":"ref-for-concept-request-origin\u2463"}],"title":"8.8. Send request"}],"url":"https://fetch.spec.whatwg.org/#concept-request-origin"},
"f7b00a8b": {"dfnID":"f7b00a8b","dfnText":"header list (for response)","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-response-header-list"}],"title":"8.7. Cache challenge"},{"refs":[{"id":"ref-for-concept-response-header-list\u2460"}],"title":"8.10. Process session registration"}],"url":"https://fetch.spec.whatwg.org/#concept-response-header-list"},
"f937b7b6": {"dfnID":"f937b7b6","dfnText":"continue","external":true,"refSections":[{"refs":[{"id":"ref-for-iteration-continue"}],"title":"8.2. Identify if a URL is in scope of a session"},{"refs":[{"id":"ref-for-iteration-continue\u2460"},{"id":"ref-for-iteration-continue\u2461"},{"id":"ref-for-iteration-continue\u2462"},{"id":"ref-for-iteration-continue\u2463"},{"id":"ref-for-iteration-continue\u2464"}],"title":"8.5. Identify session needing refresh"},{"refs":[{"id":"ref-for-iteration-continue\u2465"},{"id":"ref-for-iteration-continue\u2466"}],"title":"8.6. Identify if missing session credential"},{"refs":[{"id":"ref-for-iteration-continue\u2467"},{"id":"ref-for-iteration-continue\u2468"},{"id":"ref-for-iteration-continue\u2460\u24ea"},{"id":"ref-for-iteration-continue\u2460\u2460"}],"title":"8.7. Cache challenge"},{"refs":[{"id":"ref-for-iteration-continue\u2460\u2461"}],"title":"8.9. Create session"},{"refs":[{"id":"ref-for-iteration-continue\u2460\u2462"},{"id":"ref-for-iteration-continue\u2460\u2463"},{"id":"ref-for-iteration-continue\u2460\u2464"}],"title":"8.10. Process session registration"},{"refs":[{"id":"ref-for-iteration-continue\u2460\u2465"}],"title":"8.11. Create session key pair"}],"url":"https://infra.spec.whatwg.org/#iteration-continue"},
"fa4ea124": {"dfnID":"fa4ea124","dfnText":"initiator","external":true,"refSections":[{"refs":[{"id":"ref-for-concept-request-initiator"},{"id":"ref-for-concept-request-initiator\u2460"}],"title":"8.8. Send request"}],"url":"https://fetch.spec.whatwg.org/#concept-request-initiator"},
"feac4ab3": {"dfnID":"feac4ab3","dfnText":"same site","external":true,"refSections":[{"refs":[{"id":"ref-for-same-site"}],"title":"8.2. Identify if a URL is in scope of a session"},{"refs":[{"id":"ref-for-same-site\u2460"}],"title":"8.3. Identify if a request is allowed to refresh"},{"refs":[{"id":"ref-for-same-site\u2461"}],"title":"8.8. Send request"},{"refs":[{"id":"ref-for-same-site\u2462"},{"id":"ref-for-same-site\u2463"}],"title":"8.9. Create session"}],"url":"https://html.spec.whatwg.org/multipage/browsers.html#same-site"},
"json-session-credential": {"dfnID":"json-session-credential","dfnText":"JSON session credential","external":false,"refSections":[{"refs":[{"id":"ref-for-json-session-credential"}],"title":"7.3. Device bound session"},{"refs":[{"id":"ref-for-json-session-credential\u2460"}],"title":"8.9. Create session"},{"refs":[{"id":"ref-for-json-session-credential\u2461"}],"title":"9.6. JSON Session Instruction Format"}],"url":"#json-session-credential"},
"json-session-credential-attributes": {"dfnID":"json-session-credential-attributes","dfnText":"attributes","external":false,"refSections":[{"refs":[{"id":"ref-for-json-session-credential-attributes"}],"title":"8.9. Create session"}],"url":"#json-session-credential-attributes"},
"json-session-credential-name": {"dfnID":"json-session-credential-name","dfnText":"name","external":false,"refSections":[{"refs":[{"id":"ref-for-json-session-credential-name"}],"title":"8.9. Create session"}],"url":"#json-session-credential-name"},
"json-session-credential-type": {"dfnID":"json-session-credential-type","dfnText":"type","external":false,"refSections":[{"refs":[{"id":"ref-for-json-session-credential-type"}],"title":"8.9. Create session"}],"url":"#json-session-credential-type"},
"json-session-instructions": {"dfnID":"json-session-instructions","dfnText":"JSON session instructions","external":false,"refSections":[{"refs":[{"id":"ref-for-json-session-instructions"}],"title":"8.9. Create session"},{"refs":[{"id":"ref-for-json-session-instructions\u2460"}],"title":"9.7. JSON Session Scope Instruction Format"},{"refs":[{"id":"ref-for-json-session-instructions\u2461"}],"title":"9.9. JSON Session Credentials Format"}],"url":"#json-session-instructions"},
"json-session-instructions-allowed_refresh_initiators": {"dfnID":"json-session-instructions-allowed_refresh_initiators","dfnText":"allowed_refresh_initiators","external":false,"refSections":[{"refs":[{"id":"ref-for-json-session-instructions-allowed_refresh_initiators"}],"title":"8.9. Create session"}],"url":"#json-session-instructions-allowed_refresh_initiators"},
"json-session-instructions-continue": {"dfnID":"json-session-instructions-continue","dfnText":"continue","external":false,"refSections":[{"refs":[{"id":"ref-for-json-session-instructions-continue"}],"title":"8.9. Create session"},{"refs":[{"id":"ref-for-json-session-instructions-continue\u2460"},{"id":"ref-for-json-session-instructions-continue\u2461"},{"id":"ref-for-json-session-instructions-continue\u2462"}],"title":"9.6. JSON Session Instruction Format"}],"url":"#json-session-instructions-continue"},
"json-session-instructions-credentials": {"dfnID":"json-session-instructions-credentials","dfnText":"credentials","external":false,"refSections":[{"refs":[{"id":"ref-for-json-session-instructions-credentials"}],"title":"8.9. Create session"}],"url":"#json-session-instructions-credentials"},
"json-session-instructions-refresh_url": {"dfnID":"json-session-instructions-refresh_url","dfnText":"refresh_url","external":false,"refSections":[{"refs":[{"id":"ref-for-json-session-instructions-refresh_url"},{"id":"ref-for-json-session-instructions-refresh_url\u2460"}],"title":"8.9. Create session"}],"url":"#json-session-instructions-refresh_url"},
"json-session-instructions-scope": {"dfnID":"json-session-instructions-scope","dfnText":"scope","external":false,"refSections":[{"refs":[{"id":"ref-for-json-session-instructions-scope"}],"title":"8.9. Create session"}],"url":"#json-session-instructions-scope"},
"json-session-instructions-session_identifier": {"dfnID":"json-session-instructions-session_identifier","dfnText":"session_identifier","external":false,"refSections":[{"refs":[{"id":"ref-for-json-session-instructions-session_identifier"}],"title":"8.9. Create session"}],"url":"#json-session-instructions-session_identifier"},
"json-session-scope": {"dfnID":"json-session-scope","dfnText":"JSON session scope","external":false,"refSections":[{"refs":[{"id":"ref-for-json-session-scope"}],"title":"9.6. JSON Session Instruction Format"},{"refs":[{"id":"ref-for-json-session-scope\u2460"}],"title":"9.8. JSON Session Scope Rule Format"}],"url":"#json-session-scope"},
"json-session-scope-include_site": {"dfnID":"json-session-scope-include_site","dfnText":"include_site","external":false,"refSections":[{"refs":[{"id":"ref-for-json-session-scope-include_site"},{"id":"ref-for-json-session-scope-include_site\u2460"}],"title":"8.9. Create session"}],"url":"#json-session-scope-include_site"},
"json-session-scope-origin": {"dfnID":"json-session-scope-origin","dfnText":"origin","external":false,"refSections":[{"refs":[{"id":"ref-for-json-session-scope-origin"}],"title":"8.9. Create session"}],"url":"#json-session-scope-origin"},
"json-session-scope-rule": {"dfnID":"json-session-scope-rule","dfnText":"JSON session scope rule","external":false,"refSections":[{"refs":[{"id":"ref-for-json-session-scope-rule"},{"id":"ref-for-json-session-scope-rule\u2460"}],"title":"9.7. JSON Session Scope Instruction Format"},{"refs":[{"id":"ref-for-json-session-scope-rule\u2461"}],"title":"9.8. JSON Session Scope Rule Format"}],"url":"#json-session-scope-rule"},
"json-session-scope-rule-domain": {"dfnID":"json-session-scope-rule-domain","dfnText":"domain","external":false,"refSections":[{"refs":[{"id":"ref-for-json-session-scope-rule-domain"}],"title":"8.9. Create session"}],"url":"#json-session-scope-rule-domain"},
"json-session-scope-rule-path": {"dfnID":"json-session-scope-rule-path","dfnText":"path","external":false,"refSections":[{"refs":[{"id":"ref-for-json-session-scope-rule-path"}],"title":"8.9. Create session"}],"url":"#json-session-scope-rule-path"},
"json-session-scope-rule-type": {"dfnID":"json-session-scope-rule-type","dfnText":"type","external":false,"refSections":[{"refs":[{"id":"ref-for-json-session-scope-rule-type"}],"title":"8.9. Create session"}],"url":"#json-session-scope-rule-type"},
"json-session-scope-scope_specification": {"dfnID":"json-session-scope-scope_specification","dfnText":"scope_specification","external":false,"refSections":[{"refs":[{"id":"ref-for-json-session-scope-scope_specification"}],"title":"8.9. Create session"}],"url":"#json-session-scope-scope_specification"},
"process-session-registration": {"dfnID":"process-session-registration","dfnText":"process a session\nregistration","external":false,"refSections":[],"url":"#process-session-registration"},
"registrable-origin-label": {"dfnID":"registrable-origin-label","dfnText":"registrable origin label","external":false,"refSections":[{"refs":[{"id":"ref-for-registrable-origin-label"}],"title":"7.7. Registrable origin label"},{"refs":[{"id":"ref-for-registrable-origin-label\u2460"}],"title":"8.11. Create session key pair"}],"url":"#registrable-origin-label"},
"request-deferred-device-bound-session-ids": {"dfnID":"request-deferred-device-bound-session-ids","dfnText":"deferred device\nbound session ids","external":false,"refSections":[{"refs":[{"id":"ref-for-request-deferred-device-bound-session-ids"},{"id":"ref-for-request-deferred-device-bound-session-ids\u2460"}],"title":"8.5. Identify session needing refresh"}],"url":"#request-deferred-device-bound-session-ids"},
"scope-specification": {"dfnID":"scope-specification","dfnText":"scope specification","external":false,"refSections":[{"refs":[{"id":"ref-for-scope-specification"}],"title":"7.4. Session scope"},{"refs":[{"id":"ref-for-scope-specification\u2460"}],"title":"8.9. Create session"}],"url":"#scope-specification"},
"scope-specification-domain": {"dfnID":"scope-specification-domain","dfnText":"domain","external":false,"refSections":[{"refs":[{"id":"ref-for-scope-specification-domain"}],"title":"8.2. Identify if a URL is in scope of a session"},{"refs":[{"id":"ref-for-scope-specification-domain\u2460"}],"title":"8.9. Create session"}],"url":"#scope-specification-domain"},
"scope-specification-path": {"dfnID":"scope-specification-path","dfnText":"path","external":false,"refSections":[{"refs":[{"id":"ref-for-scope-specification-path"}],"title":"8.2. Identify if a URL is in scope of a session"},{"refs":[{"id":"ref-for-scope-specification-path\u2460"}],"title":"8.9. Create session"}],"url":"#scope-specification-path"},
"scope-specification-type": {"dfnID":"scope-specification-type","dfnText":"type","external":false,"refSections":[{"refs":[{"id":"ref-for-scope-specification-type"}],"title":"8.2. Identify if a URL is in scope of a session"},{"refs":[{"id":"ref-for-scope-specification-type\u2460"}],"title":"8.9. Create session"}],"url":"#scope-specification-type"},
"sec-secure-session-id-header": {"dfnID":"sec-secure-session-id-header","dfnText":"\nSec-Secure-Session-Id","external":false,"refSections":[{"refs":[{"id":"ref-for-sec-secure-session-id-header"}],"title":"5. Server considerations"},{"refs":[{"id":"ref-for-sec-secure-session-id-header\u2460"},{"id":"ref-for-sec-secure-session-id-header\u2461"}],"title":"9.4. `Sec-Secure-Session-Id` HTTP header field"}],"url":"#sec-secure-session-id-header"},
"secure-session-challenge-header": {"dfnID":"secure-session-challenge-header","dfnText":"\nSecure-Session-Challenge","external":false,"refSections":[{"refs":[{"id":"ref-for-secure-session-challenge-header"},{"id":"ref-for-secure-session-challenge-header\u2460"}],"title":"9.2. `Secure-Session-Challenge` HTTP header field"},{"refs":[{"id":"ref-for-secure-session-challenge-header\u2461"},{"id":"ref-for-secure-session-challenge-header\u2462"},{"id":"ref-for-secure-session-challenge-header\u2463"}],"title":"9.2.1. `Secure-Session-Challenge` structured header serialization"}],"url":"#secure-session-challenge-header"},
"secure-session-registration-header": {"dfnID":"secure-session-registration-header","dfnText":"\nSecure-Session-Registration","external":false,"refSections":[{"refs":[{"id":"ref-for-secure-session-registration-header"},{"id":"ref-for-secure-session-registration-header\u2460"},{"id":"ref-for-secure-session-registration-header\u2461"}],"title":"3.3. Federated sessions"},{"refs":[{"id":"ref-for-secure-session-registration-header\u2462"}],"title":"5. Server considerations"},{"refs":[{"id":"ref-for-secure-session-registration-header\u2463"},{"id":"ref-for-secure-session-registration-header\u2464"}],"title":"8.11. Create session key pair"},{"refs":[{"id":"ref-for-secure-session-registration-header\u2465"},{"id":"ref-for-secure-session-registration-header\u2466"},{"id":"ref-for-secure-session-registration-header\u2467"}],"title":"9.1. `Secure-Session-Registration` HTTP header field"},{"refs":[{"id":"ref-for-secure-session-registration-header\u2468"},{"id":"ref-for-secure-session-registration-header\u2460\u24ea"}],"title":"9.10. DBSC Proof JWT Syntax"}],"url":"#secure-session-registration-header"},
"secure-session-response-header": {"dfnID":"secure-session-response-header","dfnText":"\nSecure-Session-Response","external":false,"refSections":[{"refs":[{"id":"ref-for-secure-session-response-header"}],"title":"5. Server considerations"},{"refs":[{"id":"ref-for-secure-session-response-header\u2460"}],"title":"9.2. `Secure-Session-Challenge` HTTP header field"},{"refs":[{"id":"ref-for-secure-session-response-header\u2461"},{"id":"ref-for-secure-session-response-header\u2462"}],"title":"9.3. `Secure-Session-Response` HTTP header field"}],"url":"#secure-session-response-header"},
"secure-session-skipped-header": {"dfnID":"secure-session-skipped-header","dfnText":"\nSecure-Session-Skipped","external":false,"refSections":[{"refs":[{"id":"ref-for-secure-session-skipped-header"},{"id":"ref-for-secure-session-skipped-header\u2460"}],"title":"9.5. `Secure-Session-Skipped` HTTP header field"}],"url":"#secure-session-skipped-header"},
"session-credential": {"dfnID":"session-credential","dfnText":"session credential","external":false,"refSections":[{"refs":[{"id":"ref-for-session-credential"}],"title":"7.3. Device bound session"},{"refs":[{"id":"ref-for-session-credential\u2460"}],"title":"8.6. Identify if missing session credential"},{"refs":[{"id":"ref-for-session-credential\u2461"}],"title":"8.9. Create session"}],"url":"#session-credential"},
"session-credential-attributes": {"dfnID":"session-credential-attributes","dfnText":"attributes","external":false,"refSections":[{"refs":[{"id":"ref-for-session-credential-attributes"},{"id":"ref-for-session-credential-attributes\u2460"}],"title":"8.6. Identify if missing session credential"},{"refs":[{"id":"ref-for-session-credential-attributes\u2461"}],"title":"8.7. Cache challenge"},{"refs":[{"id":"ref-for-session-credential-attributes\u2462"},{"id":"ref-for-session-credential-attributes\u2463"}],"title":"8.9. Create session"}],"url":"#session-credential-attributes"},
"session-credential-name": {"dfnID":"session-credential-name","dfnText":"name","external":false,"refSections":[{"refs":[{"id":"ref-for-session-credential-name"}],"title":"8.6. Identify if missing session credential"},{"refs":[{"id":"ref-for-session-credential-name\u2460"}],"title":"8.9. Create session"}],"url":"#session-credential-name"},
"session-scope": {"dfnID":"session-scope","dfnText":"session scope","external":false,"refSections":[{"refs":[{"id":"ref-for-session-scope"}],"title":"7.3. Device bound session"}],"url":"#session-scope"},
"session-scope-include-site": {"dfnID":"session-scope-include-site","dfnText":"include site","external":false,"refSections":[{"refs":[{"id":"ref-for-session-scope-include-site"},{"id":"ref-for-session-scope-include-site\u2460"}],"title":"8.2. Identify if a URL is in scope of a session"},{"refs":[{"id":"ref-for-session-scope-include-site\u2461"},{"id":"ref-for-session-scope-include-site\u2462"}],"title":"8.3. Identify if a request is allowed to refresh"},{"refs":[{"id":"ref-for-session-scope-include-site\u2463"}],"title":"8.9. Create session"}],"url":"#session-scope-include-site"},
"session-scope-origin": {"dfnID":"session-scope-origin","dfnText":"origin","external":false,"refSections":[{"refs":[{"id":"ref-for-session-scope-origin"},{"id":"ref-for-session-scope-origin\u2460"}],"title":"8.2. Identify if a URL is in scope of a session"},{"refs":[{"id":"ref-for-session-scope-origin\u2461"},{"id":"ref-for-session-scope-origin\u2462"}],"title":"8.3. Identify if a request is allowed to refresh"},{"refs":[{"id":"ref-for-session-scope-origin\u2463"}],"title":"8.9. Create session"},{"refs":[{"id":"ref-for-session-scope-origin\u2464"}],"title":"8.11. Create session key pair"}],"url":"#session-scope-origin"},
"session-scope-scope-specifications": {"dfnID":"session-scope-scope-specifications","dfnText":"scope specifications","external":false,"refSections":[{"refs":[{"id":"ref-for-session-scope-scope-specifications"}],"title":"8.2. Identify if a URL is in scope of a session"},{"refs":[{"id":"ref-for-session-scope-scope-specifications\u2460"}],"title":"8.9. Create session"}],"url":"#session-scope-scope-specifications"},
"session-store": {"dfnID":"session-store","dfnText":"session store","external":false,"refSections":[{"refs":[{"id":"ref-for-session-store"},{"id":"ref-for-session-store\u2460"}],"title":"8.1. Identify session"},{"refs":[{"id":"ref-for-session-store\u2461"},{"id":"ref-for-session-store\u2462"}],"title":"8.5. Identify session needing refresh"},{"refs":[{"id":"ref-for-session-store\u2463"}],"title":"8.8. Send request"},{"refs":[{"id":"ref-for-session-store\u2464"},{"id":"ref-for-session-store\u2465"}],"title":"8.9. Create session"},{"refs":[{"id":"ref-for-session-store\u2466"}],"title":"8.11. Create session key pair"}],"url":"#session-store"},
"sessions-by-id-map": {"dfnID":"sessions-by-id-map","dfnText":"sessions by id map","external":false,"refSections":[{"refs":[{"id":"ref-for-sessions-by-id-map"}],"title":"7.1. Session store"},{"refs":[{"id":"ref-for-sessions-by-id-map\u2460"}],"title":"8.1. Identify session"},{"refs":[{"id":"ref-for-sessions-by-id-map\u2461"}],"title":"8.5. Identify session needing refresh"}],"url":"#sessions-by-id-map"},
};

document.addEventListener("DOMContentLoaded", ()=>{
    genAllDfnPanels();

    document.body.addEventListener("click", (e) => {
        // If not handled already, just hide all dfn panels.
        hideAllDfnPanels();
    });
});

window.addEventListener("resize", () => {
    // Pin any visible dfn panel
    queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>positionDfnPanel(el));
});

function genAllDfnPanels() {
    for(const panelData of Object.values(dfnPanelData)) {
        const dfnID = panelData.dfnID;
        const dfn = document.getElementById(dfnID);
        if(!dfn) {
            console.log(`Can't find dfn#${dfnID}.`, panelData);
            continue;
        }
        dfn.panelData = panelData;
        insertDfnPopupAction(dfn);
    }
}

function genDfnPanel(dfn, { dfnID, url, dfnText, refSections, external }) {
    const dfnPanel = mk.aside({
        class: "dfn-panel on",
        id: `infopanel-for-${dfnID}`,
        "data-for": dfnID,
        "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
        },
        mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
            `Info about the '${dfnText}' ${external?"external":""} reference.`),
        mk.a({href:url, class:"dfn-link"}, url),
        refSections.length == 0 ? [] :
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({ href: `#${ref.id}` },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        genLinkingSyntaxes(dfn),
    );

    dfnPanel.addEventListener('click', (event) => {
        if (event.target.nodeName == 'A') {
            scrollToTargetAndHighlight(event);
            pinDfnPanel(dfnPanel);
        }
        event.stopPropagation();
        refocusOnTarget(event);
    });
    dfnPanel.addEventListener('keydown', (event) => {
        if(event.keyCode == 27) { // Escape key
            hideDfnPanel({dfnPanel});
            event.stopPropagation();
            event.preventDefault();
        }
    });

    dfnPanel.dfn = dfn;
    dfn.dfnPanel = dfnPanel;
    return dfnPanel;
}



function hideAllDfnPanels() {
    // Delete the currently-active dfn panel.
    queryAll(".dfn-panel").forEach(dfnPanel=>hideDfnPanel({dfnPanel}));
}

function showDfnPanel(dfn) {
    hideAllDfnPanels(); // Only display one at a time.

    dfn.setAttribute("aria-expanded", "true");

    const dfnPanel = genDfnPanel(dfn, dfn.panelData);

    // Give the dfn a unique tabindex, and then
    // give all the tabbable panel bits successive indexes.
    let tabIndex = 100;
    dfn.tabIndex = tabIndex++;
    const tabbable = dfnPanel.querySelectorAll(":is(a, button)");
    for (const el of tabbable) {
        el.tabIndex = tabIndex++;
    }

    append(document.body, dfnPanel);
    positionDfnPanel(dfnPanel);
}

function positionDfnPanel(dfnPanel) {
    const dfn = dfnPanel.dfn;
    const dfnPos = getBounds(dfn);
    dfnPanel.style.top = dfnPos.bottom + "px";
    dfnPanel.style.left = dfnPos.left + "px";

    const panelPos = dfnPanel.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, dfnPos.left - overflowAmount);
        dfnPanel.style.left = newLeft + "px";
    }
}

function pinDfnPanel(dfnPanel) {
    // Switch it to "activated" state, which pins it.
    dfnPanel.classList.add("activated");
    dfnPanel.style.position = "fixed";
    dfnPanel.style.left = null;
    dfnPanel.style.top = null;
}

function hideDfnPanel({dfn, dfnPanel}) {
    if(!dfnPanel) dfnPanel = dfn.dfnPanel;
    if(!dfn) dfn = dfnPanel.dfn;
    dfn.dfnPanel = undefined;
    dfnPanel.dfn = undefined;
    dfn.setAttribute("aria-expanded", "false");
    dfn.tabIndex = undefined;
    dfnPanel.remove()
}

function toggleDfnPanel(dfn) {
    if(dfn.dfnPanel) {
        hideDfnPanel(dfn);
    } else {
        showDfnPanel(dfn);
    }
}

function insertDfnPopupAction(dfn) {
    dfn.setAttribute('role', 'button');
    dfn.setAttribute('aria-expanded', 'false')
    dfn.tabIndex = 0;
    dfn.classList.add('has-dfn-panel');
    dfn.addEventListener('click', (event) => {
        toggleDfnPanel(dfn);
        event.stopPropagation();
    });
    dfn.addEventListener('keypress', (event) => {
        const kc = event.keyCode;
        // 32->Space, 13->Enter
        if(kc == 32 || kc == 13) {
            toggleDfnPanel(dfn);
            event.stopPropagation();
            event.preventDefault();
        }
    });
}

function refocusOnTarget(event) {
    const target = event.target;
    setTimeout(() => {
        // Refocus on the event.target element.
        // This is needed after browser scrolls to the destination.
        target.focus();
    });
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function scrollToTargetAndHighlight(event) {
    let hash = event.target.hash;
    if (hash) {
        hash = decodeURIComponent(hash.substring(1));
        const dest = document.getElementById(hash);
        if (dest) {
            dest.classList.add('highlighted');
            setTimeout(() => dest.classList.remove('highlighted'), 1000);
        }
    }
}

// Functions, divided by link type, that wrap an autolink's
// contents with the appropriate outer syntax.
// Alternately, a string naming another type they format
// the same as.
function needsFor(type) {
    switch(type) {
        case "descriptor":
        case "value":
        case "element-attr":
        case "attr-value":
        case "element-state":
        case "method":
        case "constructor":
        case "argument":
        case "attribute":
        case "const":
        case "dict-member":
        case "event":
        case "enum-value":
        case "stringifier":
        case "serializer":
        case "iterator":
        case "maplike":
        case "setlike":
        case "state":
        case "mode":
        case "context":
        case "facet": return true;

        default: return false;
    }
}
function refusesFor(type) {
    switch(type) {
        case "property":
        case "element":
        case "interface":
        case "namespace":
        case "callback":
        case "dictionary":
        case "enum":
        case "exception":
        case "typedef":
        case "http-header":
        case "permission": return true;

        default: return false;
    }
}
function linkFormatterFromType(type) {
    switch(type) {
        case 'scheme':
        case 'permission':
        case 'dfn': return (text) => `[=${text}=]`;

        case 'abstract-op': return (text) => `[\$${text}\$]`;

        case 'function':
        case 'at-rule':
        case 'selector':
        case 'value': return (text) => `''${text}''`;

        case 'http-header': return (text) => `[:${text}:]`;

        case 'interface':
        case 'constructor':
        case 'method':
        case 'argument':
        case 'attribute':
        case 'callback':
        case 'dictionary':
        case 'dict-member':
        case 'enum':
        case 'enum-value':
        case 'exception':
        case 'const':
        case 'typedef':
        case 'stringifier':
        case 'serializer':
        case 'iterator':
        case 'maplike':
        case 'setlike':
        case 'extended-attribute':
        case 'event':
        case 'idl': return (text) => `{{${text}}}`;

        case 'element-state':
        case 'element-attr':
        case 'attr-value':
        case 'element': return (element) => `<{${element}}>`;

        case 'grammar': return (text) => `${text} (within a <pre class=prod>)`;

        case 'type': return (text)=> `<<${text}>>`;

        case 'descriptor':
        case 'property': return (text) => `'${text}'`;

        default: return;
    };
};

function genLinkingSyntaxes(dfn) {
    if(dfn.tagName != "DFN") return;

    const type = dfn.getAttribute('data-dfn-type');
    if(!type) {
        console.log(`<dfn> doesn't have a data-dfn-type:`, dfn);
        return [];
    }

    // Return a function that wraps link text based on the type
    const linkFormatter = linkFormatterFromType(type);
    if(!linkFormatter) {
        console.log(`<dfn> has an unknown data-dfn-type:`, dfn);
        return [];
    }

    let ltAlts;
    if(dfn.hasAttribute('data-lt')) {
        ltAlts = dfn.getAttribute('data-lt')
            .split("|")
            .map(x=>x.trim());
    } else {
        ltAlts = [dfn.textContent.trim()];
    }
    if(type == "type") {
        // lt of "<foo>", but "foo" is the interior;
        // <<foo/bar>> is how you write it with a for,
        // not <foo/<bar>> or whatever.
        for(var i = 0; i < ltAlts.length; i++) {
            const lt = ltAlts[i];
            const match = /<(.*)>/.exec(lt);
            if(match) { ltAlts[i] = match[1]; }
        }
    }

    let forAlts;
    if(dfn.hasAttribute('data-dfn-for')) {
        forAlts = dfn.getAttribute('data-dfn-for')
            .split(",")
            .map(x=>x.trim());
    } else {
        forAlts = [''];
    }

    let linkingSyntaxes = [];
    if(!needsFor(type)) {
        for(const lt of ltAlts) {
            linkingSyntaxes.push(linkFormatter(lt));
        }
    }
    if(!refusesFor(type)) {
        for(const f of forAlts) {
            linkingSyntaxes.push(linkFormatter(`${f}/${ltAlts[0]}`))
        }
    }
    return [
        mk.b({}, 'Possible linking syntaxes:'),
        mk.ul({},
            ...linkingSyntaxes.map(link => {
                const copyLink = async () =>
                    await navigator.clipboard.writeText(link);
                return mk.li({},
                    mk.div({ class: 'link-item' },
                        mk.button({
                            class: 'copy-icon', title: 'Copy',
                            type: 'button',
                            _onclick: copyLink,
                            tabindex: 0,
                        }, mk.span({ class: 'icon' }) ),
                        mk.span({}, link)
                    )
                );
            })
        )
    ];
}
}
</script>
<script>/* Boilerplate: script-ref-hints */
"use strict";
{
let refsData = {
"#dbsc-proof": {"displayText":"dbsc proof","export":true,"for_":[],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"dbsc proof","type":"dfn","url":"#dbsc-proof"},
"#device-bound-session": {"displayText":"device bound session","export":true,"for_":[],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"device bound session","type":"dfn","url":"#device-bound-session"},
"#device-bound-session-allowed-refresh-initiators": {"displayText":"allowed refresh initiators","export":true,"for_":["device bound session"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"allowed refresh initiators","type":"dfn","url":"#device-bound-session-allowed-refresh-initiators"},
"#device-bound-session-cached-challenge": {"displayText":"cached challenge","export":true,"for_":["device bound session"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"cached challenge","type":"dfn","url":"#device-bound-session-cached-challenge"},
"#device-bound-session-expiration-timestamp": {"displayText":"expiration timestamp","export":true,"for_":["device bound session"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"expiration timestamp","type":"dfn","url":"#device-bound-session-expiration-timestamp"},
"#device-bound-session-refresh-url": {"displayText":"refresh url","export":true,"for_":["device bound session"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"refresh url","type":"dfn","url":"#device-bound-session-refresh-url"},
"#device-bound-session-session-credentials": {"displayText":"session credentials","export":true,"for_":["device bound session"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"session credentials","type":"dfn","url":"#device-bound-session-session-credentials"},
"#device-bound-session-session-identifier": {"displayText":"session identifier","export":true,"for_":["device bound session"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"session identifier","type":"dfn","url":"#device-bound-session-session-identifier"},
"#device-bound-session-session-key-pair": {"displayText":"session key pair","export":true,"for_":["device bound session"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"session key pair","type":"dfn","url":"#device-bound-session-session-key-pair"},
"#device-bound-session-session-scope": {"displayText":"session scope","export":true,"for_":["device bound session"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"session scope","type":"dfn","url":"#device-bound-session-session-scope"},
"#json-session-credential": {"displayText":"json session credential","export":true,"for_":[],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"json session credential","type":"dfn","url":"#json-session-credential"},
"#json-session-credential-attributes": {"displayText":"attributes","export":true,"for_":["JSON session credential"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"attributes","type":"dfn","url":"#json-session-credential-attributes"},
"#json-session-credential-name": {"displayText":"name","export":true,"for_":["JSON session credential"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"name","type":"dfn","url":"#json-session-credential-name"},
"#json-session-credential-type": {"displayText":"type","export":true,"for_":["JSON session credential"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"type","type":"dfn","url":"#json-session-credential-type"},
"#json-session-instructions": {"displayText":"json session instructions","export":true,"for_":[],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"json session instructions","type":"dfn","url":"#json-session-instructions"},
"#json-session-instructions-allowed_refresh_initiators": {"displayText":"allowed_refresh_initiators","export":true,"for_":["JSON session instructions"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"allowed_refresh_initiators","type":"dfn","url":"#json-session-instructions-allowed_refresh_initiators"},
"#json-session-instructions-continue": {"displayText":"continue","export":true,"for_":["JSON session instructions"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"continue","type":"dfn","url":"#json-session-instructions-continue"},
"#json-session-instructions-credentials": {"displayText":"credentials","export":true,"for_":["JSON session instructions"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"credentials","type":"dfn","url":"#json-session-instructions-credentials"},
"#json-session-instructions-refresh_url": {"displayText":"refresh_url","export":true,"for_":["JSON session instructions"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"refresh_url","type":"dfn","url":"#json-session-instructions-refresh_url"},
"#json-session-instructions-scope": {"displayText":"scope","export":true,"for_":["JSON session instructions"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"scope","type":"dfn","url":"#json-session-instructions-scope"},
"#json-session-instructions-session_identifier": {"displayText":"session_identifier","export":true,"for_":["JSON session instructions"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"session_identifier","type":"dfn","url":"#json-session-instructions-session_identifier"},
"#json-session-scope": {"displayText":"json session scope","export":true,"for_":[],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"json session scope","type":"dfn","url":"#json-session-scope"},
"#json-session-scope-include_site": {"displayText":"include_site","export":true,"for_":["JSON session scope"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"include_site","type":"dfn","url":"#json-session-scope-include_site"},
"#json-session-scope-origin": {"displayText":"origin","export":true,"for_":["JSON session scope"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"origin","type":"dfn","url":"#json-session-scope-origin"},
"#json-session-scope-rule": {"displayText":"json session scope rule","export":true,"for_":[],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"json session scope rule","type":"dfn","url":"#json-session-scope-rule"},
"#json-session-scope-rule-domain": {"displayText":"domain","export":true,"for_":["JSON session scope rule"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"domain","type":"dfn","url":"#json-session-scope-rule-domain"},
"#json-session-scope-rule-path": {"displayText":"path","export":true,"for_":["JSON session scope rule"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"path","type":"dfn","url":"#json-session-scope-rule-path"},
"#json-session-scope-rule-type": {"displayText":"type","export":true,"for_":["JSON session scope rule"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"type","type":"dfn","url":"#json-session-scope-rule-type"},
"#json-session-scope-scope_specification": {"displayText":"scope_specification","export":true,"for_":["JSON session scope"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"scope_specification","type":"dfn","url":"#json-session-scope-scope_specification"},
"#registrable-origin-label": {"displayText":"registrable origin label","export":true,"for_":[],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"registrable origin label","type":"dfn","url":"#registrable-origin-label"},
"#request-deferred-device-bound-session-ids": {"displayText":"deferred device bound session ids","export":true,"for_":["request"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"deferred device bound session ids","type":"dfn","url":"#request-deferred-device-bound-session-ids"},
"#scope-specification": {"displayText":"scope specification","export":true,"for_":[],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"scope specification","type":"dfn","url":"#scope-specification"},
"#scope-specification-domain": {"displayText":"domain","export":true,"for_":["scope specification"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"domain","type":"dfn","url":"#scope-specification-domain"},
"#scope-specification-path": {"displayText":"path","export":true,"for_":["scope specification"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"path","type":"dfn","url":"#scope-specification-path"},
"#scope-specification-type": {"displayText":"type","export":true,"for_":["scope specification"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"type","type":"dfn","url":"#scope-specification-type"},
"#sec-secure-session-id-header": {"displayText":"sec-secure-session-id","export":true,"for_":[],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"sec-secure-session-id","type":"http-header","url":"#sec-secure-session-id-header"},
"#secure-session-challenge-header": {"displayText":"secure-session-challenge","export":true,"for_":[],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"secure-session-challenge","type":"http-header","url":"#secure-session-challenge-header"},
"#secure-session-registration-header": {"displayText":"secure-session-registration","export":true,"for_":[],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"secure-session-registration","type":"http-header","url":"#secure-session-registration-header"},
"#secure-session-response-header": {"displayText":"secure-session-response","export":true,"for_":[],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"secure-session-response","type":"http-header","url":"#secure-session-response-header"},
"#secure-session-skipped-header": {"displayText":"secure-session-skipped","export":true,"for_":[],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"secure-session-skipped","type":"http-header","url":"#secure-session-skipped-header"},
"#session-credential": {"displayText":"session credential","export":true,"for_":[],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"session credential","type":"dfn","url":"#session-credential"},
"#session-credential-attributes": {"displayText":"attributes","export":true,"for_":["session credential"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"attributes","type":"dfn","url":"#session-credential-attributes"},
"#session-credential-name": {"displayText":"name","export":true,"for_":["session credential"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"name","type":"dfn","url":"#session-credential-name"},
"#session-scope": {"displayText":"session scope","export":true,"for_":[],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"session scope","type":"dfn","url":"#session-scope"},
"#session-scope-include-site": {"displayText":"include site","export":true,"for_":["session scope"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"include site","type":"dfn","url":"#session-scope-include-site"},
"#session-scope-origin": {"displayText":"origin","export":true,"for_":["session scope"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"origin","type":"dfn","url":"#session-scope-origin"},
"#session-scope-scope-specifications": {"displayText":"scope specifications","export":true,"for_":["session scope"],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"scope specifications","type":"dfn","url":"#session-scope-scope-specifications"},
"#session-store": {"displayText":"session store","export":true,"for_":[],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"session store","type":"dfn","url":"#session-store"},
"#sessions-by-id-map": {"displayText":"sessions by id map","export":true,"for_":[],"level":"1","normative":true,"shortname":"dbsc","spec":"dbsc-1","status":"local","text":"sessions by id map","type":"dfn","url":"#sessions-by-id-map"},
"https://datatracker.ietf.org/doc/html/rfc9651#inner-list": {"displayText":"sf-inner-list","export":true,"for_":[],"level":"","normative":true,"shortname":"rfc9651","spec":"rfc9651","status":"anchor-block","text":"sf-inner-list","type":"dfn","url":"https://datatracker.ietf.org/doc/html/rfc9651#inner-list"},
"https://datatracker.ietf.org/doc/html/rfc9651#list": {"displayText":"sf-list","export":true,"for_":[],"level":"","normative":true,"shortname":"rfc9651","spec":"rfc9651","status":"anchor-block","text":"sf-list","type":"dfn","url":"https://datatracker.ietf.org/doc/html/rfc9651#list"},
"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters": {"displayText":"sf-parameter","export":true,"for_":[],"level":"","normative":true,"shortname":"rfc9651","spec":"rfc9651","status":"anchor-block","text":"sf-parameter","type":"dfn","url":"https://datatracker.ietf.org/doc/html/rfc9651#name-parameters"},
"https://datatracker.ietf.org/doc/html/rfc9651#string": {"displayText":"sf-string","export":true,"for_":[],"level":"","normative":true,"shortname":"rfc9651","spec":"rfc9651","status":"anchor-block","text":"sf-string","type":"dfn","url":"https://datatracker.ietf.org/doc/html/rfc9651#string"},
"https://datatracker.ietf.org/doc/html/rfc9651#token": {"displayText":"sf-token","export":true,"for_":[],"level":"","normative":true,"shortname":"rfc9651","spec":"rfc9651","status":"anchor-block","text":"sf-token","type":"dfn","url":"https://datatracker.ietf.org/doc/html/rfc9651#token"},
"https://fetch.spec.whatwg.org/#concept-header-list-append": {"displayText":"append","export":true,"for_":["header list"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"append","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-header-list-append"},
"https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header": {"displayText":"get a structured field value","export":true,"for_":["header list"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"get a structured field value","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-header-list-get-structured-header"},
"https://fetch.spec.whatwg.org/#concept-header-list-set-structured-header": {"displayText":"set a structured field value","export":true,"for_":["header list"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"set a structured field value","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-header-list-set-structured-header"},
"https://fetch.spec.whatwg.org/#concept-network-error": {"displayText":"network error","export":true,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"network error","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-network-error"},
"https://fetch.spec.whatwg.org/#concept-request": {"displayText":"request","export":true,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"request","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request"},
"https://fetch.spec.whatwg.org/#concept-request-credentials-mode": {"displayText":"credentials mode","export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"credentials mode","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-credentials-mode"},
"https://fetch.spec.whatwg.org/#concept-request-header-list": {"displayText":"header list","export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"header list","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-header-list"},
"https://fetch.spec.whatwg.org/#concept-request-initiator": {"displayText":"initiator","export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"initiator","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-initiator"},
"https://fetch.spec.whatwg.org/#concept-request-method": {"displayText":"method","export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"method","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-method"},
"https://fetch.spec.whatwg.org/#concept-request-origin": {"displayText":"origin","export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"origin","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-origin"},
"https://fetch.spec.whatwg.org/#concept-request-redirect-mode": {"displayText":"redirect mode","export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"redirect mode","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-redirect-mode"},
"https://fetch.spec.whatwg.org/#concept-request-url": {"displayText":"URL","export":true,"for_":["request"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"url","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-request-url"},
"https://fetch.spec.whatwg.org/#concept-response": {"displayText":"response","export":true,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"response","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-response"},
"https://fetch.spec.whatwg.org/#concept-response-body": {"displayText":"body","export":true,"for_":["response"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"body","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-response-body"},
"https://fetch.spec.whatwg.org/#concept-response-header-list": {"displayText":"header list","export":true,"for_":["response"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"header list","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-response-header-list"},
"https://fetch.spec.whatwg.org/#concept-response-status": {"displayText":"status","export":true,"for_":["response"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"status","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-response-status"},
"https://fetch.spec.whatwg.org/#concept-response-url": {"displayText":"URL","export":true,"for_":["response"],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"url","type":"dfn","url":"https://fetch.spec.whatwg.org/#concept-response-url"},
"https://fetch.spec.whatwg.org/#header-name": {"displayText":"header name","export":true,"for_":[],"level":"1","normative":true,"shortname":"fetch","spec":"fetch","status":"current","text":"header name","type":"dfn","url":"https://fetch.spec.whatwg.org/#header-name"},
"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin": {"displayText":"origin","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"origin","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin"},
"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-host": {"displayText":"host","export":true,"for_":["origin"],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"host","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-host"},
"https://html.spec.whatwg.org/multipage/browsers.html#same-origin": {"displayText":"same origin","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"same origin","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#same-origin"},
"https://html.spec.whatwg.org/multipage/browsers.html#same-site": {"displayText":"same site","export":true,"for_":[],"level":"1","normative":true,"shortname":"html","spec":"html","status":"current","text":"same site","type":"dfn","url":"https://html.spec.whatwg.org/multipage/browsers.html#same-site"},
"https://infra.spec.whatwg.org/#boolean": {"displayText":"boolean","export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"boolean","type":"dfn","url":"https://infra.spec.whatwg.org/#boolean"},
"https://infra.spec.whatwg.org/#iteration-break": {"displayText":"break","export":true,"for_":["iteration"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"break","type":"dfn","url":"https://infra.spec.whatwg.org/#iteration-break"},
"https://infra.spec.whatwg.org/#iteration-continue": {"displayText":"continue","export":true,"for_":["iteration"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"continue","type":"dfn","url":"https://infra.spec.whatwg.org/#iteration-continue"},
"https://infra.spec.whatwg.org/#list": {"displayText":"list","export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"list","type":"dfn","url":"https://infra.spec.whatwg.org/#list"},
"https://infra.spec.whatwg.org/#list-iterate": {"displayText":"for each","export":true,"for_":["list","set"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"for each","type":"dfn","url":"https://infra.spec.whatwg.org/#list-iterate"},
"https://infra.spec.whatwg.org/#map-exists": {"displayText":"contain","export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"contain","type":"dfn","url":"https://infra.spec.whatwg.org/#map-exists"},
"https://infra.spec.whatwg.org/#map-with-default": {"displayText":"with default","export":true,"for_":["map"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"with default","type":"dfn","url":"https://infra.spec.whatwg.org/#map-with-default"},
"https://infra.spec.whatwg.org/#ordered-map": {"displayText":"ordered map","export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"ordered map","type":"dfn","url":"https://infra.spec.whatwg.org/#ordered-map"},
"https://infra.spec.whatwg.org/#string": {"displayText":"string","export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"string","type":"dfn","url":"https://infra.spec.whatwg.org/#string"},
"https://infra.spec.whatwg.org/#struct": {"displayText":"struct","export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"struct","type":"dfn","url":"https://infra.spec.whatwg.org/#struct"},
"https://infra.spec.whatwg.org/#struct-item": {"displayText":"item","export":true,"for_":["struct","tuple"],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"item","type":"dfn","url":"https://infra.spec.whatwg.org/#struct-item"},
"https://infra.spec.whatwg.org/#tuple": {"displayText":"tuple","export":true,"for_":[],"level":"1","normative":true,"shortname":"infra","spec":"infra","status":"current","text":"tuple","type":"dfn","url":"https://infra.spec.whatwg.org/#tuple"},
"https://url.spec.whatwg.org/#concept-domain": {"displayText":"domain","export":true,"for_":[],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"domain","type":"dfn","url":"https://url.spec.whatwg.org/#concept-domain"},
"https://url.spec.whatwg.org/#concept-url": {"displayText":"URL","export":true,"for_":[],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"url","type":"dfn","url":"https://url.spec.whatwg.org/#concept-url"},
"https://url.spec.whatwg.org/#concept-url-host": {"displayText":"host","export":true,"for_":["url"],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"host","type":"dfn","url":"https://url.spec.whatwg.org/#concept-url-host"},
"https://url.spec.whatwg.org/#concept-url-origin": {"displayText":"origin","export":true,"for_":["url"],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"origin","type":"dfn","url":"https://url.spec.whatwg.org/#concept-url-origin"},
"https://url.spec.whatwg.org/#concept-url-path": {"displayText":"path","export":true,"for_":["url"],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"path","type":"dfn","url":"https://url.spec.whatwg.org/#concept-url-path"},
"https://url.spec.whatwg.org/#domain-label": {"displayText":"domain label","export":true,"for_":[],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"domain label","type":"dfn","url":"https://url.spec.whatwg.org/#domain-label"},
"https://url.spec.whatwg.org/#host-public-suffix": {"displayText":"public suffix","export":true,"for_":["host"],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"public suffix","type":"dfn","url":"https://url.spec.whatwg.org/#host-public-suffix"},
"https://url.spec.whatwg.org/#host-registrable-domain": {"displayText":"registrable domain","export":true,"for_":["host"],"level":"1","normative":true,"shortname":"url","spec":"url","status":"current","text":"registrable domain","type":"dfn","url":"https://url.spec.whatwg.org/#host-registrable-domain"},
"https://w3c.github.io/hr-time/#dfn-moment": {"displayText":"moment","export":true,"for_":[],"level":"3","normative":true,"shortname":"hr-time","spec":"hr-time-3","status":"current","text":"moment","type":"dfn","url":"https://w3c.github.io/hr-time/#dfn-moment"},
"https://w3c.github.io/permissions/#dfn-request-permission-to-use": {"displayText":"request permission to use","export":true,"for_":[],"level":"1","normative":true,"shortname":"permissions","spec":"permissions","status":"current","text":"request permission to use","type":"dfn","url":"https://w3c.github.io/permissions/#dfn-request-permission-to-use"},
"https://w3c.github.io/permissions/#dom-permissionstate-denied": {"displayText":"denied","export":true,"for_":["PermissionState"],"level":"1","normative":true,"shortname":"permissions","spec":"permissions","status":"current","text":"denied","type":"enum-value","url":"https://w3c.github.io/permissions/#dom-permissionstate-denied"},
};

function mkRefHint(link, ref) {
    const linkText = link.textContent;
    let dfnTextElements = '';
    if (ref.displayText.toLowerCase() != linkText.toLowerCase()) {
        // Give the original term if it's being displayed in a different way.
        // But allow casing differences, they're insignificant.
        dfnTextElements =
            mk.li({},
                mk.b({}, "Term: "),
                mk.span({}, ref.displayText)
            );
    }
    const forList = ref.for_;
    let forListElements;
    if(forList.length == 0) {
        forListElements = [];
    } else if(forList.length == 1) {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.span({}, forList[0]),
        );
    } else {
        forListElements = mk.li({},
            mk.b({}, "For: "),
            mk.ul({},
                ...forList.map(forItem =>
                    mk.li({},
                        mk.span({}, forItem)
                    ),
                ),
            ),
        );
    }
    const url = ref.url;
    const safeUrl = encodeURIComponent(url);
    const hintPanel = mk.aside({
        class: "ref-hint",
        id: `ref-hint-for-${safeUrl}`,
        "data-for": url,
        "aria-labelled-by": `ref-hint-for-${safeUrl}`,
    },
        mk.ul({},
            dfnTextElements,
            mk.li({},
                mk.b({}, "URL: "),
                mk.a({ href: url, class: "ref" }, url),
            ),
            mk.li({},
                mk.b({}, "Type: "),
                mk.span({}, `${ref.type}`),
            ),
            mk.li({},
                mk.b({}, "Spec: "),
                mk.span({}, `${ref.spec ? ref.spec : ''}`),
            ),
            forListElements
        ),
    );
    hintPanel.forLink = link;
    setupRefHintEventListeners(link, hintPanel);
    return hintPanel;
}

function hideAllRefHints() {
    queryAll(".ref-hint").forEach(el=>hideRefHint(el));
}

function hideRefHint(refHint) {
    const link = refHint.forLink;
    link.setAttribute("aria-expanded", "false");
    if(refHint.teardownEventListeners) {
        refHint.teardownEventListeners();
    }
    refHint.remove();
}

function showRefHint(link) {
    if(link.classList.contains("dfn-link")) return;
    const url = link.getAttribute("href");
    const refHintKey = link.getAttribute("data-refhint-key");
    let key = url;
    if(refHintKey) {
        key = refHintKey + "_" + url;
    }
    const ref = refsData[key];
    if(!ref) return;

    hideAllRefHints(); // Only display one at this time.

    const refHint = mkRefHint(link, ref);
    append(document.body, refHint);
    link.setAttribute("aria-expanded", "true");
    positionRefHint(refHint);
}

function setupRefHintEventListeners(link, refHint) {
    if (refHint.teardownEventListeners) return;
    // Add event handlers to hide the refHint after the user moves away
    // from both the link and refHint, if not hovering either within one second.
    let timeout = null;
    const startHidingRefHint = (event) => {
        if (timeout) {
            clearTimeout(timeout);
        }
        timeout = setTimeout(() => {
            hideRefHint(refHint);
        }, 1000);
    }
    const resetHidingRefHint = (event) => {
        if (timeout) clearTimeout(timeout);
        timeout = null;
    };
    link.addEventListener("mouseleave", startHidingRefHint);
    link.addEventListener("mouseenter", resetHidingRefHint);
    link.addEventListener("blur", startHidingRefHint);
    link.addEventListener("focus", resetHidingRefHint);
    refHint.addEventListener("mouseleave", startHidingRefHint);
    refHint.addEventListener("mouseenter", resetHidingRefHint);
    refHint.addEventListener("blur", startHidingRefHint);
    refHint.addEventListener("focus", resetHidingRefHint);

    refHint.teardownEventListeners = () => {
        // remove event listeners
        resetHidingRefHint();
        link.removeEventListener("mouseleave", startHidingRefHint);
        link.removeEventListener("mouseenter", resetHidingRefHint);
        link.removeEventListener("blur", startHidingRefHint);
        link.removeEventListener("focus", resetHidingRefHint);
        refHint.removeEventListener("mouseleave", startHidingRefHint);
        refHint.removeEventListener("mouseenter", resetHidingRefHint);
        refHint.removeEventListener("blur", startHidingRefHint);
        refHint.removeEventListener("focus", resetHidingRefHint);
    };
}

function positionRefHint(refHint) {
    const link = refHint.forLink;
    const linkPos = getBounds(link);
    refHint.style.top = linkPos.bottom + "px";
    refHint.style.left = linkPos.left + "px";

    const panelPos = refHint.getBoundingClientRect();
    const panelMargin = 8;
    const maxRight = document.body.parentNode.clientWidth - panelMargin;
    if (panelPos.right > maxRight) {
        const overflowAmount = panelPos.right - maxRight;
        const newLeft = Math.max(panelMargin, linkPos.left - overflowAmount);
        refHint.style.left = newLeft + "px";
    }
}

// TODO: shared util
// Returns the root-level absolute position {left and top} of element.
function getBounds(el, relativeTo=document.body) {
    const relativeRect = relativeTo.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const top = elRect.top - relativeRect.top;
    const left = elRect.left - relativeRect.left;
    return {
        top,
        left,
        bottom: top + elRect.height,
        right: left + elRect.width,
    }
}

function showRefHintListener(e) {
    // If the target isn't in a link (or is a link),
    // just ignore it.
    let link = e.target.closest("a");
    if(!link) return;

    // If the target is in a ref-hint panel
    // (aka a link in the already-open one),
    // also just ignore it.
    if(link.closest(".ref-hint")) return;

    // Otherwise, show the panel for the link.
    showRefHint(link);
}

function hideAllHintsListener(e) {
    // If the click is inside a ref-hint panel, ignore it.
    if(e.target.closest(".ref-hint")) return;
    // Otherwise, close all the current panels.
    hideAllRefHints();
}

document.addEventListener("DOMContentLoaded", () => {
    document.body.addEventListener("mousedown", showRefHintListener);
    document.body.addEventListener("focus", showRefHintListener);

    document.body.addEventListener("click", hideAllHintsListener);
});

window.addEventListener("resize", () => {
    // Hide any open ref hint.
    hideAllRefHints();
});
}
</script>
<script>/* Boilerplate: script-var-click-highlighting */
"use strict";
{
/*
Color-choosing design:

* Colors are ordered by goodness.
* On clicking a var, give it the earliest color
    with the lowest usage in the algorithm.
* On re-clicking, re-use the var's most recent color
    if that's not currently being used elsewhere.
*/

const COLOR_COUNT = 7;

document.addEventListener("click", e=>{
    if(e.target.nodeName == "VAR") {
        highlightSameAlgoVars(e.target);
    }
});

function highlightSameAlgoVars(v) {
    // Find the algorithm container.
    let algoContainer = findAlgoContainer(v);

    // Not highlighting document-global vars,
    // too likely to be unrelated.
    if(algoContainer == null) return;

    const varName = nameFromVar(v);
    if(!v.hasAttribute("data-var-color")) {
        const newColor = chooseHighlightColor(algoContainer, v);
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.setAttribute("data-var-color", newColor);
                el.setAttribute("data-var-last-color", newColor);
            }
        }
    } else {
        for(const el of algoContainer.querySelectorAll("var")) {
            if(nameFromVar(el) == varName) {
                el.removeAttribute("data-var-color");
            }
        }
    }
}
function findAlgoContainer(el) {
    while(el != document.body) {
        if(el.hasAttribute("data-algorithm")) return el;
        el = el.parentNode;
    }
    return null;
}
function nameFromVar(el) {
    return el.textContent.replace(/(\s|\xa0)+/g, " ").trim();
}
function colorCountsFromContainer(container) {
    const namesFromColor = Array.from({length:COLOR_COUNT}, x=>new Set());
    for(let v of container.querySelectorAll("var[data-var-color]")) {
        let color = +v.getAttribute("data-var-color");
        namesFromColor[color].add(nameFromVar(v));
    }

    return namesFromColor.map(x=>x.size);
}
function leastUsedColor(colors) {
    // Find the earliest color with the lowest count.
    let minCount = Infinity;
    let minColor = null;
    for(var i = 0; i < colors.length; i++) {
        if(colors[i] < minCount) {
            minColor = i;
            minCount = colors[i];
        }
    }
    return minColor;
}
function chooseHighlightColor(container, v) {
    const colorCounts = colorCountsFromContainer(container);
    if(v.hasAttribute("data-var-last-color")) {
        let color = +v.getAttribute("data-var-last-color");
        if(colorCounts[color] == 0) return color;
    }
    return leastUsedColor(colorCounts);
}
}
</script>